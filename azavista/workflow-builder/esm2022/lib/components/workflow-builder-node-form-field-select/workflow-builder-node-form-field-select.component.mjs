import { Component, Input, ViewChild } from '@angular/core';
import { FormArray, FormControl } from '@angular/forms';
import { WorkflowBuilderNodeFormFieldBaseComponent } from '../workflow-builder-node-form-field-text/workflow-builder-node-form-field-text.component';
import { trackByAttributeTranslations } from '../../utils';
import * as i0 from "@angular/core";
import * as i1 from "../../services/workflow-builder.form-field.service";
import * as i2 from "../../workflow-builder.controller";
import * as i3 from "@ngx-translate/core";
import * as i4 from "@angular/common";
import * as i5 from "@angular/material/form-field";
import * as i6 from "@angular/material/icon";
import * as i7 from "@angular/material/expansion";
import * as i8 from "@angular/material/select";
import * as i9 from "@angular/material/core";
import * as i10 from "@angular/material/list";
export class WorkflowBuilderNodeFormFieldSelectComponent extends WorkflowBuilderNodeFormFieldBaseComponent {
    constructor(fieldSvc, controller, translateSvc, ngZone) {
        super();
        this.fieldSvc = fieldSvc;
        this.controller = controller;
        this.translateSvc = translateSvc;
        this.ngZone = ngZone;
        this.currentLang = this.translateSvc.currentLang;
        this.trackByAttributeTranslations = trackByAttributeTranslations;
        this.isExpanded = false;
        this.dataSourceIcon = {
            Page: 'language',
            Email: 'email',
            Form: 'web',
            CrmStatus: 'event_available',
            ProfilePage: 'account_circle',
            Workflow: 'dataset_outline',
        };
        this.dataSourceColor = {
            Page: '#4C83FF',
            Email: '#FF786A',
            Form: '#FEB002',
            CrmStatus: '#98CA71',
            ProfilePage: '#0F1A43',
            Workflow: '#5D5FEF',
        };
    }
    async ngOnInit() {
        if (this.property &&
            this.controller.dataProvider &&
            this.eventId &&
            this.workflowId) {
            this.attributeTranslations =
                await this.fieldSvc.getFieldDataSourceTranslations(this.property.datasource, this.controller.dataProvider, {
                    eventId: this.eventId,
                    workflowId: this.workflowId,
                });
        }
    }
    async onSelectOpen() {
        this.isExpanded = !this.isExpanded;
        this.selectElement?.close();
    }
    onItemSelected(itemTranslation) {
        if (this.control) {
            this.control.markAsDirty();
            if (this.control instanceof FormArray) {
                const arrayValues = this.control.value;
                const shouldAdd = !arrayValues.includes(itemTranslation.value);
                if (shouldAdd) {
                    this.control.push(new FormControl(itemTranslation.value));
                }
                else {
                    const index = arrayValues.findIndex((value) => value === itemTranslation.value);
                    this.control.removeAt(index);
                }
            }
            else {
                // single select
                this.control.setValue(itemTranslation.value);
                this.isExpanded = false;
            }
        }
    }
    isValueEmpty(controlValue) {
        return !(this.property?.type === 'multiselect' &&
            controlValue instanceof Array
            ? controlValue.length > 0
            : controlValue);
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.10", ngImport: i0, type: WorkflowBuilderNodeFormFieldSelectComponent, deps: [{ token: i1.AzavistaWorkflowBuilderFormFieldService }, { token: i2.AzavistaWorkflowBuilderController }, { token: i3.TranslateService }, { token: i0.NgZone }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.2.10", type: WorkflowBuilderNodeFormFieldSelectComponent, selector: "azavista-workflow-builder-node-form-field-select", inputs: { property: "property" }, viewQueries: [{ propertyName: "selectElement", first: true, predicate: ["selectElement"], descendants: true }], usesInheritance: true, ngImport: i0, template: "<mat-expansion-panel\r\n  *ngIf=\"control && property\"\r\n  [(expanded)]=\"isExpanded\"\r\n  [class.mat-expansion-panel-field-not-empty]=\"\r\n    property.type === 'multiselect'\r\n      ? $any(control.value).length > 0\r\n      : control.value\r\n  \"\r\n  [class.mat-expansion-panel-field-valid]=\"control.valid\"\r\n>\r\n  <mat-expansion-panel-header>\r\n    <mat-panel-title>\r\n      <mat-form-field *ngIf=\"attributeTranslations\"\r\n        appearance=\"outline\"\r\n        [hideRequiredMarker]=\"false\"\r\n        [class.mat-form-field-mandatory]=\"property.mandatory\"\r\n        [class.mat-form-field-not-empty]=\"\r\n          property.type === 'multiselect'\r\n            ? $any(control.value).length > 0\r\n            : control.value\r\n        \"\r\n      >\r\n        <mat-label>{{ property.label | translate }}</mat-label>\r\n        <mat-icon\r\n          *ngIf=\"\r\n            property.type === 'multiselect'\r\n              ? $any(control.value).length > 0\r\n              : control.value\r\n          \"\r\n          matPrefix\r\n          [style.color]=\"dataSourceColor[property.datasource] + ' !important'\"\r\n          >{{ dataSourceIcon[property.datasource] }}</mat-icon\r\n        >\r\n\r\n        <mat-select\r\n          [required]=\"property.mandatory\"\r\n          #selectElement\r\n          (opened)=\"onSelectOpen()\"\r\n          [value]=\"control.value\"\r\n          [multiple]=\"property.type === 'multiselect'\"\r\n          [panelClass]=\"'panel-select-' + property.attribute\"\r\n          placeholder=\"{{ property.label | translate }}\"\r\n        >\r\n          <mat-option\r\n            *ngFor=\"\r\n              let item of attributeTranslations;\r\n              trackBy: trackByAttributeTranslations\r\n            \"\r\n            [value]=\"item.value\"\r\n            >{{ item.trans[currentLang] }}</mat-option\r\n          >\r\n        </mat-select>\r\n        <mat-error *ngIf=\"!control.valid\"></mat-error>\r\n      </mat-form-field>\r\n    </mat-panel-title>\r\n  </mat-expansion-panel-header>\r\n\r\n  <mat-selection-list\r\n    [multiple]=\"property.type === 'multiselect'\"\r\n    color=\"primary\"\r\n  >\r\n    <mat-list-option\r\n      *ngFor=\"\r\n        let item of attributeTranslations;\r\n        trackBy: trackByAttributeTranslations\r\n      \"\r\n      (click)=\"onItemSelected(item)\"\r\n      [value]=\"item.value\"\r\n      [selected]=\"$any(control.value)?.includes?.(item.value)\"\r\n    >\r\n      {{ item.trans[currentLang] }}\r\n    </mat-list-option>\r\n  </mat-selection-list>\r\n</mat-expansion-panel>\r\n", styles: [":host{display:block;--mat-expansion-header-collapsed-state-height: 2em;--mat-expansion-header-expanded-state-height: 2em}mat-expansion-panel.mat-expansion-panel{box-shadow:none}mat-expansion-panel.mat-expansion-panel ::ng-deep .mat-expansion-panel-body{padding:0}mat-expansion-panel.mat-expansion-panel ::ng-deep .mat-mdc-list-base.mat-mdc-selection-list{--mdc-list-list-item-label-text-font: inherit;--mdc-list-list-item-label-text-line-height: 2em;--mdc-list-list-item-label-text-size: 1em;--mdc-list-list-item-one-line-container-height: 3em;--mdc-list-list-item-two-line-container-height: 5em;--mdc-list-list-item-three-line-container-height: 7em}mat-expansion-panel.mat-expansion-panel ::ng-deep .mat-mdc-list-base.mat-mdc-selection-list .mat-mdc-list-item{border-radius:0;border-top:1px solid #ccc;margin-bottom:0!important}mat-expansion-panel.mat-expansion-panel.mat-expansion-panel-field-not-empty.mat-expansion-panel-field-valid{--mdc-outlined-text-field-outline-color: #4caf50;border:1px solid var(--mdc-outlined-text-field-outline-color)!important}mat-expansion-panel-header{padding:0;background-color:#fff!important;height:min-content}mat-expansion-panel-header ::ng-deep .mdc-text-field--outlined{--mdc-outlined-text-field-outline-width: 0px}mat-expansion-panel-header ::ng-deep .mat-expansion-indicator{padding:4px 1em}mat-expansion-panel-header ::ng-deep .mdc-notched-outline__notch{display:flex}mat-expansion-panel-header mat-select,mat-expansion-panel-header mat-form-field{pointer-events:none}.mat-icon{font-size:14px;line-height:1em;width:1em;height:1em;padding:.5em}\n"], dependencies: [{ kind: "directive", type: i4.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i4.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i5.MatFormField, selector: "mat-form-field", inputs: ["hideRequiredMarker", "color", "floatLabel", "appearance", "subscriptSizing", "hintLabel"], exportAs: ["matFormField"] }, { kind: "directive", type: i5.MatLabel, selector: "mat-label" }, { kind: "directive", type: i5.MatError, selector: "mat-error, [matError]", inputs: ["id"] }, { kind: "directive", type: i5.MatPrefix, selector: "[matPrefix], [matIconPrefix], [matTextPrefix]", inputs: ["matTextPrefix"] }, { kind: "component", type: i6.MatIcon, selector: "mat-icon", inputs: ["color", "inline", "svgIcon", "fontSet", "fontIcon"], exportAs: ["matIcon"] }, { kind: "component", type: i7.MatExpansionPanel, selector: "mat-expansion-panel", inputs: ["disabled", "expanded", "hideToggle", "togglePosition"], outputs: ["opened", "closed", "expandedChange", "afterExpand", "afterCollapse"], exportAs: ["matExpansionPanel"] }, { kind: "component", type: i7.MatExpansionPanelHeader, selector: "mat-expansion-panel-header", inputs: ["tabIndex", "expandedHeight", "collapsedHeight"] }, { kind: "directive", type: i7.MatExpansionPanelTitle, selector: "mat-panel-title" }, { kind: "component", type: i8.MatSelect, selector: "mat-select", inputs: ["disabled", "disableRipple", "tabIndex", "panelWidth", "hideSingleSelectionIndicator"], exportAs: ["matSelect"] }, { kind: "component", type: i9.MatOption, selector: "mat-option", exportAs: ["matOption"] }, { kind: "component", type: i10.MatSelectionList, selector: "mat-selection-list", inputs: ["color", "compareWith", "multiple", "hideSingleSelectionIndicator", "disabled"], outputs: ["selectionChange"], exportAs: ["matSelectionList"] }, { kind: "component", type: i10.MatListOption, selector: "mat-list-option", inputs: ["togglePosition", "checkboxPosition", "color", "value", "selected"], outputs: ["selectedChange"], exportAs: ["matListOption"] }, { kind: "pipe", type: i3.TranslatePipe, name: "translate" }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.10", ngImport: i0, type: WorkflowBuilderNodeFormFieldSelectComponent, decorators: [{
            type: Component,
            args: [{ selector: 'azavista-workflow-builder-node-form-field-select', template: "<mat-expansion-panel\r\n  *ngIf=\"control && property\"\r\n  [(expanded)]=\"isExpanded\"\r\n  [class.mat-expansion-panel-field-not-empty]=\"\r\n    property.type === 'multiselect'\r\n      ? $any(control.value).length > 0\r\n      : control.value\r\n  \"\r\n  [class.mat-expansion-panel-field-valid]=\"control.valid\"\r\n>\r\n  <mat-expansion-panel-header>\r\n    <mat-panel-title>\r\n      <mat-form-field *ngIf=\"attributeTranslations\"\r\n        appearance=\"outline\"\r\n        [hideRequiredMarker]=\"false\"\r\n        [class.mat-form-field-mandatory]=\"property.mandatory\"\r\n        [class.mat-form-field-not-empty]=\"\r\n          property.type === 'multiselect'\r\n            ? $any(control.value).length > 0\r\n            : control.value\r\n        \"\r\n      >\r\n        <mat-label>{{ property.label | translate }}</mat-label>\r\n        <mat-icon\r\n          *ngIf=\"\r\n            property.type === 'multiselect'\r\n              ? $any(control.value).length > 0\r\n              : control.value\r\n          \"\r\n          matPrefix\r\n          [style.color]=\"dataSourceColor[property.datasource] + ' !important'\"\r\n          >{{ dataSourceIcon[property.datasource] }}</mat-icon\r\n        >\r\n\r\n        <mat-select\r\n          [required]=\"property.mandatory\"\r\n          #selectElement\r\n          (opened)=\"onSelectOpen()\"\r\n          [value]=\"control.value\"\r\n          [multiple]=\"property.type === 'multiselect'\"\r\n          [panelClass]=\"'panel-select-' + property.attribute\"\r\n          placeholder=\"{{ property.label | translate }}\"\r\n        >\r\n          <mat-option\r\n            *ngFor=\"\r\n              let item of attributeTranslations;\r\n              trackBy: trackByAttributeTranslations\r\n            \"\r\n            [value]=\"item.value\"\r\n            >{{ item.trans[currentLang] }}</mat-option\r\n          >\r\n        </mat-select>\r\n        <mat-error *ngIf=\"!control.valid\"></mat-error>\r\n      </mat-form-field>\r\n    </mat-panel-title>\r\n  </mat-expansion-panel-header>\r\n\r\n  <mat-selection-list\r\n    [multiple]=\"property.type === 'multiselect'\"\r\n    color=\"primary\"\r\n  >\r\n    <mat-list-option\r\n      *ngFor=\"\r\n        let item of attributeTranslations;\r\n        trackBy: trackByAttributeTranslations\r\n      \"\r\n      (click)=\"onItemSelected(item)\"\r\n      [value]=\"item.value\"\r\n      [selected]=\"$any(control.value)?.includes?.(item.value)\"\r\n    >\r\n      {{ item.trans[currentLang] }}\r\n    </mat-list-option>\r\n  </mat-selection-list>\r\n</mat-expansion-panel>\r\n", styles: [":host{display:block;--mat-expansion-header-collapsed-state-height: 2em;--mat-expansion-header-expanded-state-height: 2em}mat-expansion-panel.mat-expansion-panel{box-shadow:none}mat-expansion-panel.mat-expansion-panel ::ng-deep .mat-expansion-panel-body{padding:0}mat-expansion-panel.mat-expansion-panel ::ng-deep .mat-mdc-list-base.mat-mdc-selection-list{--mdc-list-list-item-label-text-font: inherit;--mdc-list-list-item-label-text-line-height: 2em;--mdc-list-list-item-label-text-size: 1em;--mdc-list-list-item-one-line-container-height: 3em;--mdc-list-list-item-two-line-container-height: 5em;--mdc-list-list-item-three-line-container-height: 7em}mat-expansion-panel.mat-expansion-panel ::ng-deep .mat-mdc-list-base.mat-mdc-selection-list .mat-mdc-list-item{border-radius:0;border-top:1px solid #ccc;margin-bottom:0!important}mat-expansion-panel.mat-expansion-panel.mat-expansion-panel-field-not-empty.mat-expansion-panel-field-valid{--mdc-outlined-text-field-outline-color: #4caf50;border:1px solid var(--mdc-outlined-text-field-outline-color)!important}mat-expansion-panel-header{padding:0;background-color:#fff!important;height:min-content}mat-expansion-panel-header ::ng-deep .mdc-text-field--outlined{--mdc-outlined-text-field-outline-width: 0px}mat-expansion-panel-header ::ng-deep .mat-expansion-indicator{padding:4px 1em}mat-expansion-panel-header ::ng-deep .mdc-notched-outline__notch{display:flex}mat-expansion-panel-header mat-select,mat-expansion-panel-header mat-form-field{pointer-events:none}.mat-icon{font-size:14px;line-height:1em;width:1em;height:1em;padding:.5em}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.AzavistaWorkflowBuilderFormFieldService }, { type: i2.AzavistaWorkflowBuilderController }, { type: i3.TranslateService }, { type: i0.NgZone }]; }, propDecorators: { property: [{
                type: Input
            }], selectElement: [{
                type: ViewChild,
                args: ['selectElement']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid29ya2Zsb3ctYnVpbGRlci1ub2RlLWZvcm0tZmllbGQtc2VsZWN0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2F6YXZpc3RhL3dvcmtmbG93LWJ1aWxkZXIvc3JjL2xpYi9jb21wb25lbnRzL3dvcmtmbG93LWJ1aWxkZXItbm9kZS1mb3JtLWZpZWxkLXNlbGVjdC93b3JrZmxvdy1idWlsZGVyLW5vZGUtZm9ybS1maWVsZC1zZWxlY3QuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvYXphdmlzdGEvd29ya2Zsb3ctYnVpbGRlci9zcmMvbGliL2NvbXBvbmVudHMvd29ya2Zsb3ctYnVpbGRlci1ub2RlLWZvcm0tZmllbGQtc2VsZWN0L3dvcmtmbG93LWJ1aWxkZXItbm9kZS1mb3JtLWZpZWxkLXNlbGVjdC5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBa0IsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBSzVFLE9BQU8sRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDeEQsT0FBTyxFQUFFLHlDQUF5QyxFQUFFLE1BQU0sMEZBQTBGLENBQUM7QUFHckosT0FBTyxFQUFFLDRCQUE0QixFQUFFLE1BQU0sYUFBYSxDQUFDOzs7Ozs7Ozs7Ozs7QUFPM0QsTUFBTSxPQUFPLDJDQUNULFNBQVEseUNBQTRDO0lBa0NwRCxZQUNZLFFBQWlELEVBQ2pELFVBQTZDLEVBQzdDLFlBQThCLEVBQzlCLE1BQWM7UUFFdEIsS0FBSyxFQUFFLENBQUM7UUFMQSxhQUFRLEdBQVIsUUFBUSxDQUF5QztRQUNqRCxlQUFVLEdBQVYsVUFBVSxDQUFtQztRQUM3QyxpQkFBWSxHQUFaLFlBQVksQ0FBa0I7UUFDOUIsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQS9C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MkNBQTJDO2tCQUx2RCxTQUFTOytCQUNJLGtEQUFrRDtrT0FRMUMsUUFBUTtzQkFBekIsS0FBSztnQkFXTixhQUFhO3NCQURaLFNBQVM7dUJBQUMsZUFBZSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIE5nWm9uZSwgT25Jbml0LCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE1hdFNlbGVjdCB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL3NlbGVjdCc7XG5pbXBvcnQgeyBXb3JrZmxvd1Byb3BlcnR5U2VsZWN0IH0gZnJvbSAnQGF6YXZpc3RhL3dvcmtmbG93LWJ1aWxkZXItc2hhcmVkJztcbmltcG9ydCB7IElBdHRyaWJ1dGVUcmFuc2xhdGlvbiB9IGZyb20gJ0BhemF2aXN0YS9jb21wb25lbnRzL3NoYXJlZCc7XG5pbXBvcnQgeyBUcmFuc2xhdGVTZXJ2aWNlIH0gZnJvbSAnQG5neC10cmFuc2xhdGUvY29yZSc7XG5pbXBvcnQgeyBGb3JtQXJyYXksIEZvcm1Db250cm9sIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgV29ya2Zsb3dCdWlsZGVyTm9kZUZvcm1GaWVsZEJhc2VDb21wb25lbnQgfSBmcm9tICcuLi93b3JrZmxvdy1idWlsZGVyLW5vZGUtZm9ybS1maWVsZC10ZXh0L3dvcmtmbG93LWJ1aWxkZXItbm9kZS1mb3JtLWZpZWxkLXRleHQuY29tcG9uZW50JztcbmltcG9ydCB7IEF6YXZpc3RhV29ya2Zsb3dCdWlsZGVyRm9ybUZpZWxkU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3dvcmtmbG93LWJ1aWxkZXIuZm9ybS1maWVsZC5zZXJ2aWNlJztcbmltcG9ydCB7IEF6YXZpc3RhV29ya2Zsb3dCdWlsZGVyQ29udHJvbGxlciB9IGZyb20gJy4uLy4uL3dvcmtmbG93LWJ1aWxkZXIuY29udHJvbGxlcic7XG5pbXBvcnQgeyB0cmFja0J5QXR0cmlidXRlVHJhbnNsYXRpb25zIH0gZnJvbSAnLi4vLi4vdXRpbHMnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2F6YXZpc3RhLXdvcmtmbG93LWJ1aWxkZXItbm9kZS1mb3JtLWZpZWxkLXNlbGVjdCcsXG4gICAgdGVtcGxhdGVVcmw6IGAuL3dvcmtmbG93LWJ1aWxkZXItbm9kZS1mb3JtLWZpZWxkLXNlbGVjdC5jb21wb25lbnQuaHRtbGAsXG4gICAgc3R5bGVVcmxzOiBbJy4vd29ya2Zsb3ctYnVpbGRlci1ub2RlLWZvcm0tZmllbGQtc2VsZWN0LmNvbXBvbmVudC5zY3NzJ10sXG59KVxuZXhwb3J0IGNsYXNzIFdvcmtmbG93QnVpbGRlck5vZGVGb3JtRmllbGRTZWxlY3RDb21wb25lbnQ8VD5cbiAgICBleHRlbmRzIFdvcmtmbG93QnVpbGRlck5vZGVGb3JtRmllbGRCYXNlQ29tcG9uZW50PFQ+XG4gICAgaW1wbGVtZW50cyBPbkluaXRcbntcbiAgICBASW5wdXQoKSBvdmVycmlkZSBwcm9wZXJ0eT86IFdvcmtmbG93UHJvcGVydHlTZWxlY3Q7XG5cbiAgICBhdHRyaWJ1dGVUcmFuc2xhdGlvbnM/OiBJQXR0cmlidXRlVHJhbnNsYXRpb25bXTtcblxuICAgIGN1cnJlbnRMYW5nID0gdGhpcy50cmFuc2xhdGVTdmMuY3VycmVudExhbmc7XG5cbiAgICB0cmFja0J5QXR0cmlidXRlVHJhbnNsYXRpb25zID0gdHJhY2tCeUF0dHJpYnV0ZVRyYW5zbGF0aW9ucztcblxuICAgIGlzRXhwYW5kZWQgPSBmYWxzZTtcblxuICAgIEBWaWV3Q2hpbGQoJ3NlbGVjdEVsZW1lbnQnKVxuICAgIHNlbGVjdEVsZW1lbnQ/OiBNYXRTZWxlY3Q7XG5cbiAgICBkYXRhU291cmNlSWNvbjogUmVjb3JkPFdvcmtmbG93UHJvcGVydHlTZWxlY3RbJ2RhdGFzb3VyY2UnXSwgc3RyaW5nPiA9IHtcbiAgICAgICAgUGFnZTogJ2xhbmd1YWdlJyxcbiAgICAgICAgRW1haWw6ICdlbWFpbCcsXG4gICAgICAgIEZvcm06ICd3ZWInLFxuICAgICAgICBDcm1TdGF0dXM6ICdldmVudF9hdmFpbGFibGUnLFxuICAgICAgICBQcm9maWxlUGFnZTogJ2FjY291bnRfY2lyY2xlJyxcbiAgICAgICAgV29ya2Zsb3c6ICdkYXRhc2V0X291dGxpbmUnLFxuICAgIH07XG5cbiAgICBkYXRhU291cmNlQ29sb3I6IFJlY29yZDxXb3JrZmxvd1Byb3BlcnR5U2VsZWN0WydkYXRhc291cmNlJ10sIHN0cmluZz4gPSB7XG4gICAgICAgIFBhZ2U6ICcjNEM4M0ZGJyxcbiAgICAgICAgRW1haWw6ICcjRkY3ODZBJyxcbiAgICAgICAgRm9ybTogJyNGRUIwMDInLFxuICAgICAgICBDcm1TdGF0dXM6ICcjOThDQTcxJyxcbiAgICAgICAgUHJvZmlsZVBhZ2U6ICcjMEYxQTQzJyxcbiAgICAgICAgV29ya2Zsb3c6ICcjNUQ1RkVGJyxcbiAgICB9O1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgZmllbGRTdmM6IEF6YXZpc3RhV29ya2Zsb3dCdWlsZGVyRm9ybUZpZWxkU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSBjb250cm9sbGVyOiBBemF2aXN0YVdvcmtmbG93QnVpbGRlckNvbnRyb2xsZXIsXG4gICAgICAgIHByaXZhdGUgdHJhbnNsYXRlU3ZjOiBUcmFuc2xhdGVTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIG5nWm9uZTogTmdab25lLFxuICAgICkge1xuICAgICAgICBzdXBlcigpO1xuICAgIH1cblxuICAgIGFzeW5jIG5nT25Jbml0KCkge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgICB0aGlzLnByb3BlcnR5ICYmXG4gICAgICAgICAgICB0aGlzLmNvbnRyb2xsZXIuZGF0YVByb3ZpZGVyICYmXG4gICAgICAgICAgICB0aGlzLmV2ZW50SWQgJiZcbiAgICAgICAgICAgIHRoaXMud29ya2Zsb3dJZFxuICAgICAgICApIHtcbiAgICAgICAgICAgIHRoaXMuYXR0cmlidXRlVHJhbnNsYXRpb25zID1cbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmZpZWxkU3ZjLmdldEZpZWxkRGF0YVNvdXJjZVRyYW5zbGF0aW9ucyhcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9wZXJ0eS5kYXRhc291cmNlLFxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xsZXIuZGF0YVByb3ZpZGVyLFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudElkOiB0aGlzLmV2ZW50SWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB3b3JrZmxvd0lkOiB0aGlzLndvcmtmbG93SWQsXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIG9uU2VsZWN0T3BlbigpIHtcbiAgICAgICAgdGhpcy5pc0V4cGFuZGVkID0gIXRoaXMuaXNFeHBhbmRlZDtcbiAgICAgICAgdGhpcy5zZWxlY3RFbGVtZW50Py5jbG9zZSgpO1xuICAgIH1cblxuICAgIG9uSXRlbVNlbGVjdGVkKGl0ZW1UcmFuc2xhdGlvbjogSUF0dHJpYnV0ZVRyYW5zbGF0aW9uKSB7XG4gICAgICAgIGlmICh0aGlzLmNvbnRyb2wpIHtcbiAgICAgICAgICAgIHRoaXMuY29udHJvbC5tYXJrQXNEaXJ0eSgpO1xuICAgICAgICAgICAgaWYgKHRoaXMuY29udHJvbCBpbnN0YW5jZW9mIEZvcm1BcnJheSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGFycmF5VmFsdWVzID0gdGhpcy5jb250cm9sLnZhbHVlIGFzIGFueVtdO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNob3VsZEFkZCA9ICFhcnJheVZhbHVlcy5pbmNsdWRlcyhpdGVtVHJhbnNsYXRpb24udmFsdWUpO1xuICAgICAgICAgICAgICAgIGlmIChzaG91bGRBZGQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250cm9sLnB1c2gobmV3IEZvcm1Db250cm9sKGl0ZW1UcmFuc2xhdGlvbi52YWx1ZSkpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gYXJyYXlWYWx1ZXMuZmluZEluZGV4KFxuICAgICAgICAgICAgICAgICAgICAgICAgKHZhbHVlKSA9PiB2YWx1ZSA9PT0gaXRlbVRyYW5zbGF0aW9uLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2wucmVtb3ZlQXQoaW5kZXgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gc2luZ2xlIHNlbGVjdFxuICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbC5zZXRWYWx1ZShpdGVtVHJhbnNsYXRpb24udmFsdWUgYXMgYW55KTtcbiAgICAgICAgICAgICAgICB0aGlzLmlzRXhwYW5kZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlzVmFsdWVFbXB0eShjb250cm9sVmFsdWU6IGFueSB8IGFueVtdKSB7XG4gICAgICAgIHJldHVybiAhKHRoaXMucHJvcGVydHk/LnR5cGUgPT09ICdtdWx0aXNlbGVjdCcgJiZcbiAgICAgICAgY29udHJvbFZhbHVlIGluc3RhbmNlb2YgQXJyYXlcbiAgICAgICAgICAgID8gY29udHJvbFZhbHVlLmxlbmd0aCA+IDBcbiAgICAgICAgICAgIDogY29udHJvbFZhbHVlKTtcbiAgICB9XG59XG4iLCI8bWF0LWV4cGFuc2lvbi1wYW5lbFxyXG4gICpuZ0lmPVwiY29udHJvbCAmJiBwcm9wZXJ0eVwiXHJcbiAgWyhleHBhbmRlZCldPVwiaXNFeHBhbmRlZFwiXHJcbiAgW2NsYXNzLm1hdC1leHBhbnNpb24tcGFuZWwtZmllbGQtbm90LWVtcHR5XT1cIlxyXG4gICAgcHJvcGVydHkudHlwZSA9PT0gJ211bHRpc2VsZWN0J1xyXG4gICAgICA/ICRhbnkoY29udHJvbC52YWx1ZSkubGVuZ3RoID4gMFxyXG4gICAgICA6IGNvbnRyb2wudmFsdWVcclxuICBcIlxyXG4gIFtjbGFzcy5tYXQtZXhwYW5zaW9uLXBhbmVsLWZpZWxkLXZhbGlkXT1cImNvbnRyb2wudmFsaWRcIlxyXG4+XHJcbiAgPG1hdC1leHBhbnNpb24tcGFuZWwtaGVhZGVyPlxyXG4gICAgPG1hdC1wYW5lbC10aXRsZT5cclxuICAgICAgPG1hdC1mb3JtLWZpZWxkICpuZ0lmPVwiYXR0cmlidXRlVHJhbnNsYXRpb25zXCJcclxuICAgICAgICBhcHBlYXJhbmNlPVwib3V0bGluZVwiXHJcbiAgICAgICAgW2hpZGVSZXF1aXJlZE1hcmtlcl09XCJmYWxzZVwiXHJcbiAgICAgICAgW2NsYXNzLm1hdC1mb3JtLWZpZWxkLW1hbmRhdG9yeV09XCJwcm9wZXJ0eS5tYW5kYXRvcnlcIlxyXG4gICAgICAgIFtjbGFzcy5tYXQtZm9ybS1maWVsZC1ub3QtZW1wdHldPVwiXHJcbiAgICAgICAgICBwcm9wZXJ0eS50eXBlID09PSAnbXVsdGlzZWxlY3QnXHJcbiAgICAgICAgICAgID8gJGFueShjb250cm9sLnZhbHVlKS5sZW5ndGggPiAwXHJcbiAgICAgICAgICAgIDogY29udHJvbC52YWx1ZVxyXG4gICAgICAgIFwiXHJcbiAgICAgID5cclxuICAgICAgICA8bWF0LWxhYmVsPnt7IHByb3BlcnR5LmxhYmVsIHwgdHJhbnNsYXRlIH19PC9tYXQtbGFiZWw+XHJcbiAgICAgICAgPG1hdC1pY29uXHJcbiAgICAgICAgICAqbmdJZj1cIlxyXG4gICAgICAgICAgICBwcm9wZXJ0eS50eXBlID09PSAnbXVsdGlzZWxlY3QnXHJcbiAgICAgICAgICAgICAgPyAkYW55KGNvbnRyb2wudmFsdWUpLmxlbmd0aCA+IDBcclxuICAgICAgICAgICAgICA6IGNvbnRyb2wudmFsdWVcclxuICAgICAgICAgIFwiXHJcbiAgICAgICAgICBtYXRQcmVmaXhcclxuICAgICAgICAgIFtzdHlsZS5jb2xvcl09XCJkYXRhU291cmNlQ29sb3JbcHJvcGVydHkuZGF0YXNvdXJjZV0gKyAnICFpbXBvcnRhbnQnXCJcclxuICAgICAgICAgID57eyBkYXRhU291cmNlSWNvbltwcm9wZXJ0eS5kYXRhc291cmNlXSB9fTwvbWF0LWljb25cclxuICAgICAgICA+XHJcblxyXG4gICAgICAgIDxtYXQtc2VsZWN0XHJcbiAgICAgICAgICBbcmVxdWlyZWRdPVwicHJvcGVydHkubWFuZGF0b3J5XCJcclxuICAgICAgICAgICNzZWxlY3RFbGVtZW50XHJcbiAgICAgICAgICAob3BlbmVkKT1cIm9uU2VsZWN0T3BlbigpXCJcclxuICAgICAgICAgIFt2YWx1ZV09XCJjb250cm9sLnZhbHVlXCJcclxuICAgICAgICAgIFttdWx0aXBsZV09XCJwcm9wZXJ0eS50eXBlID09PSAnbXVsdGlzZWxlY3QnXCJcclxuICAgICAgICAgIFtwYW5lbENsYXNzXT1cIidwYW5lbC1zZWxlY3QtJyArIHByb3BlcnR5LmF0dHJpYnV0ZVwiXHJcbiAgICAgICAgICBwbGFjZWhvbGRlcj1cInt7IHByb3BlcnR5LmxhYmVsIHwgdHJhbnNsYXRlIH19XCJcclxuICAgICAgICA+XHJcbiAgICAgICAgICA8bWF0LW9wdGlvblxyXG4gICAgICAgICAgICAqbmdGb3I9XCJcclxuICAgICAgICAgICAgICBsZXQgaXRlbSBvZiBhdHRyaWJ1dGVUcmFuc2xhdGlvbnM7XHJcbiAgICAgICAgICAgICAgdHJhY2tCeTogdHJhY2tCeUF0dHJpYnV0ZVRyYW5zbGF0aW9uc1xyXG4gICAgICAgICAgICBcIlxyXG4gICAgICAgICAgICBbdmFsdWVdPVwiaXRlbS52YWx1ZVwiXHJcbiAgICAgICAgICAgID57eyBpdGVtLnRyYW5zW2N1cnJlbnRMYW5nXSB9fTwvbWF0LW9wdGlvblxyXG4gICAgICAgICAgPlxyXG4gICAgICAgIDwvbWF0LXNlbGVjdD5cclxuICAgICAgICA8bWF0LWVycm9yICpuZ0lmPVwiIWNvbnRyb2wudmFsaWRcIj48L21hdC1lcnJvcj5cclxuICAgICAgPC9tYXQtZm9ybS1maWVsZD5cclxuICAgIDwvbWF0LXBhbmVsLXRpdGxlPlxyXG4gIDwvbWF0LWV4cGFuc2lvbi1wYW5lbC1oZWFkZXI+XHJcblxyXG4gIDxtYXQtc2VsZWN0aW9uLWxpc3RcclxuICAgIFttdWx0aXBsZV09XCJwcm9wZXJ0eS50eXBlID09PSAnbXVsdGlzZWxlY3QnXCJcclxuICAgIGNvbG9yPVwicHJpbWFyeVwiXHJcbiAgPlxyXG4gICAgPG1hdC1saXN0LW9wdGlvblxyXG4gICAgICAqbmdGb3I9XCJcclxuICAgICAgICBsZXQgaXRlbSBvZiBhdHRyaWJ1dGVUcmFuc2xhdGlvbnM7XHJcbiAgICAgICAgdHJhY2tCeTogdHJhY2tCeUF0dHJpYnV0ZVRyYW5zbGF0aW9uc1xyXG4gICAgICBcIlxyXG4gICAgICAoY2xpY2spPVwib25JdGVtU2VsZWN0ZWQoaXRlbSlcIlxyXG4gICAgICBbdmFsdWVdPVwiaXRlbS52YWx1ZVwiXHJcbiAgICAgIFtzZWxlY3RlZF09XCIkYW55KGNvbnRyb2wudmFsdWUpPy5pbmNsdWRlcz8uKGl0ZW0udmFsdWUpXCJcclxuICAgID5cclxuICAgICAge3sgaXRlbS50cmFuc1tjdXJyZW50TGFuZ10gfX1cclxuICAgIDwvbWF0LWxpc3Qtb3B0aW9uPlxyXG4gIDwvbWF0LXNlbGVjdGlvbi1saXN0PlxyXG48L21hdC1leHBhbnNpb24tcGFuZWw+XHJcbiJdfQ==