import { ChangeDetectionStrategy, Component, EventEmitter, HostBinding, HostListener, Input, Output, ViewChild, } from '@angular/core';
import { omit, } from '@azavista/components/shared';
import { ngResizeObserverProviders, } from 'ng-resize-observer';
import { AzavistaGroupedFieldsComponent } from '@azavista/components/grouped-fields';
import { debounceTime, firstValueFrom } from 'rxjs';
import { getFormDirtyValues, getWorkflowIdFromNodeId, objectKeys, trackByWorkflowProperty, } from '../../utils';
import { WORKFLOW_EXPLANATION_TRANSLATIONS, WORKFLOW_NAME_TRANSLATIONS, } from '../../types';
import * as i0 from "@angular/core";
import * as i1 from "@azavista/components/shared";
import * as i2 from "../../workflow-builder.controller";
import * as i3 from "ng-resize-observer";
import * as i4 from "../../services/workflow-builder.form-field.service";
import * as i5 from "@angular/common";
import * as i6 from "@angular/material/button";
import * as i7 from "@angular/material/icon";
import * as i8 from "@azavista/components/button";
import * as i9 from "../workflow-builder-node-form-header/workflow-builder-node-form-header.component";
import * as i10 from "../workflow-builder-node-form-field-text/workflow-builder-node-form-field-text.component";
import * as i11 from "../workflow-builder-node-form-field-select/workflow-builder-node-form-field-select.component";
import * as i12 from "../workflow-builder-node-form-field-toggle/workflow-builder-node-form-field-toggle.component";
import * as i13 from "../workflow-builder-node-form-field-process/workflow-builder-node-form-field-process.component";
import * as i14 from "@ngx-translate/core";
export class WorkflowBuilderNodeFormComponent {
    get workflowId() {
        return getWorkflowIdFromNodeId(this.node.id);
    }
    get controllerData() {
        return this.controller.dataMap[this.workflowId];
    }
    get isWorkflowValid() {
        return this.controller.validityMap[this.workflowId];
    }
    constructor(sharedSvc, host, controller, resize$, ngZone, formFieldService) {
        this.sharedSvc = sharedSvc;
        this.host = host;
        this.controller = controller;
        this.resize$ = resize$;
        this.ngZone = ngZone;
        this.formFieldService = formFieldService;
        this.attrNodeId = '';
        this.workflowSettingsChanges = new EventEmitter();
        this.canvasChanges = new EventEmitter();
        this.removeNode = new EventEmitter();
        this.properties = [];
        this.fields = [];
        this.trackByWorkflowProperty = trackByWorkflowProperty;
    }
    async ngOnInit() {
        this.attrNodeId = this.node.id;
        const { controllerData } = this;
        if (!controllerData) {
            return;
        }
        this.workflowSettingsGroupedFieldData =
            await this.createWorkflowSettingsGroupFieldData(controllerData);
        this.initFormGroup(controllerData);
        this.canvasGroupFieldData =
            this.createCanvasGroupedFieldsData(controllerData);
        await firstValueFrom(this.ngZone.onStable);
        this.loadFieldsCssClass();
        this.resize$.pipe(debounceTime(50)).subscribe(async () => {
            const rect = this.host.nativeElement.getBoundingClientRect();
            const nodeInstance = this.getNodeInstance();
            if (nodeInstance) {
                nodeInstance.height = rect?.height;
            }
        });
    }
    onKeyDown(event) {
        // prevent when typing on form get treated as moving or deleting workflow item
        event.stopPropagation();
    }
    initFormGroup(controllerData) {
        const { factory } = controllerData;
        this.properties = factory.getProperties();
        this.formGroup = this.formFieldService.getFormGroupFromWorkflowFactory(this.properties, factory);
        this.formGroup.valueChanges.pipe(debounceTime(200)).subscribe(() => {
            this.controller.updateWorkflowSettings(this.workflowId, getFormDirtyValues(this.formGroup));
        });
    }
    async createWorkflowSettingsGroupedFieldFields(factory) {
        const { dataProvider } = this.controller;
        if (!dataProvider) {
            return [];
        }
        return Promise.all(factory.getPropertiesWithSchema().map((property) => {
            return this.formFieldService.getFieldFromWorkflowProperty(property, dataProvider, {
                eventId: this.eventId,
                workflowId: this.workflowId,
            });
        }));
    }
    // eslint-disable-next-line max-len
    async createWorkflowSettingsGroupFieldData(controllerData) {
        const { factory } = controllerData;
        this.properties = factory.getProperties();
        const fields = await this.createWorkflowSettingsGroupedFieldFields(factory);
        this.fields = fields;
        this.workflowItem = factory.getWorkflow();
        return {
            singleColumn: true,
            editModeForAllFields: true,
            disableAutoOrdering: true,
            fieldsOptions: [
                {
                    fieldId: 'sad',
                    options: {},
                },
            ],
            fieldsWithEntity: {
                entity: factory.getWorkflow().settings,
                fields,
            },
            expandPanels: false,
        };
    }
    async toggleExpandPanels() {
        if (this.workflowSettingsGroupedFieldData) {
            this.workflowSettingsGroupedFieldData.expandPanels =
                !this.workflowSettingsGroupedFieldData.expandPanels;
        }
    }
    createCanvasGroupedFieldsData(controllerData) {
        const { name, description, factory: { type }, } = controllerData;
        return {
            expandPanels: true,
            editModeForAllFields: true,
            singleColumn: true,
            disableAutoOrdering: true,
            fieldsWithEntity: {
                fields: this.formFieldService.getCanvasDataFields(type),
                entity: {
                    name: name ??
                        this.sharedSvc.translate(WORKFLOW_NAME_TRANSLATIONS[type]),
                    description: description ??
                        this.sharedSvc.translate(WORKFLOW_EXPLANATION_TRANSLATIONS[type]),
                },
            },
        };
    }
    onUpdateCanvasFields(data) {
        this.canvasChanges.emit(data);
        if (this.canvasGroupFieldData?.fieldsWithEntity.entity) {
            this.canvasGroupFieldData.fieldsWithEntity.entity = {
                ...this.canvasGroupFieldData?.fieldsWithEntity.entity,
                ...data,
            };
        }
    }
    onUpdateWorkflowSettingsFields(data) {
        if (this.workflowSettingsGroupedFieldEl?.invalidFieldsWithValues
            ?.length > 0 ||
            data.obj == null ||
            objectKeys(data.obj).length === 0) {
            return;
        }
        /**
         * We hack the way to display the process button by creating a checkbox as a button.
         * Therefore, we intercept the changes from the process-field and use the checkbox to open a popup
         */
        const workflowProcessProperties = this.controllerData?.factory
            .getProperties()
            .filter(({ type }) => type === 'process') ?? [];
        const isProcessField = workflowProcessProperties.some(({ attribute }) => attribute === data.changedFieldWithValue?.field.id);
        if (isProcessField) {
            this.openProcessPopup();
            return;
        }
        this.workflowSettingsChanges.emit({
            ...data,
            obj: data.obj
                ? omit(data.obj, workflowProcessProperties.map(({ attribute }) => attribute))
                : data.obj,
        });
    }
    loadFieldsCssClass() {
        this.controllerData?.factory.getProperties().forEach((properties) => {
            const { attribute, datasource } = properties;
            if (datasource) {
                this.host.nativeElement
                    .querySelector(`azavista-input-field[field-id=${attribute}]`)
                    ?.classList.add(`datasource-${datasource}`);
            }
        });
    }
    openProcessPopup() {
        alert('Opening Process Popup');
    }
    getNodeInstance() {
        return this.diagramEl.nodes.find(({ id }) => id === this.node.id);
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.10", ngImport: i0, type: WorkflowBuilderNodeFormComponent, deps: [{ token: i1.AzavistaSharedService }, { token: i0.ElementRef }, { token: i2.AzavistaWorkflowBuilderController }, { token: i3.NgResizeObserver }, { token: i0.NgZone }, { token: i4.AzavistaWorkflowBuilderFormFieldService }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.2.10", type: WorkflowBuilderNodeFormComponent, selector: "azavista-workflow-builder-node-form", inputs: { node: "node", eventId: "eventId", diagramEl: "diagramEl" }, outputs: { workflowSettingsChanges: "workflowSettingsChanges", canvasChanges: "canvasChanges", removeNode: "removeNode" }, host: { listeners: { "keydown": "onKeyDown($event)" }, properties: { "attr.nodeId": "this.attrNodeId" } }, providers: [...ngResizeObserverProviders], viewQueries: [{ propertyName: "workflowSettingsGroupedFieldEl", first: true, predicate: ["workflowSettingsGroupedField"], descendants: true, read: AzavistaGroupedFieldsComponent }, { propertyName: "formHeader", first: true, predicate: ["formHeader"], descendants: true }], ngImport: i0, template: "<div\r\n  class=\"workflow-builder-node-item\"\r\n  *ngIf=\"workflowSettingsGroupedFieldData && canvasGroupFieldData\"\r\n>\r\n  <azavista-workflow-builder-node-form-header\r\n    #formHeader\r\n    [controllerData]=\"controllerData\"\r\n    (canvasChanges)=\"onUpdateCanvasFields($event)\"\r\n  ></azavista-workflow-builder-node-form-header>\r\n\r\n  <div class=\"workflow-builder-node-item__fields\">\r\n    <ng-container *ngIf=\"workflowSettingsGroupedFieldData.expandPanels\">\r\n      <ng-container\r\n        *ngFor=\"let property of properties; trackBy: trackByWorkflowProperty\"\r\n      >\r\n        <ng-container\r\n          *ngIf=\"formGroup?.controls?.[property.attribute] as formControl\"\r\n        >\r\n          <azavista-workflow-builder-node-form-field-select\r\n            *ngIf=\"\r\n              property.type === 'select' || property.type === 'multiselect'\r\n            \"\r\n            [eventId]=\"eventId\"\r\n            [workflowId]=\"workflowId\"\r\n            [property]=\"property\"\r\n            [control]=\"$any(formControl)\"\r\n          >\r\n          </azavista-workflow-builder-node-form-field-select>\r\n          <azavista-workflow-builder-node-form-field-text\r\n            *ngIf=\"property.type === 'text' || property.type === 'number'\"\r\n            [eventId]=\"eventId\"\r\n            [workflowId]=\"workflowId\"\r\n            [property]=\"$any(property)\"\r\n            [control]=\"$any(formControl)\"\r\n          >\r\n          </azavista-workflow-builder-node-form-field-text>\r\n          <azavista-workflow-builder-node-form-field-toggle\r\n            *ngIf=\"property.type === 'boolean'\"\r\n            [eventId]=\"eventId\"\r\n            [workflowId]=\"workflowId\"\r\n            [property]=\"$any(property)\"\r\n            [control]=\"$any(formControl)\"\r\n          >\r\n          </azavista-workflow-builder-node-form-field-toggle>\r\n          <azavista-workflow-builder-node-form-field-process\r\n            *ngIf=\"property.type === 'process'\"\r\n            [eventId]=\"eventId\"\r\n            [workflowId]=\"workflowId\"\r\n            [property]=\"$any(property)\"\r\n            [control]=\"$any(formControl)\"\r\n          >\r\n          </azavista-workflow-builder-node-form-field-process>\r\n        </ng-container>\r\n      </ng-container>\r\n    </ng-container>\r\n  </div>\r\n  <div\r\n    class=\"workflow-builder-node-item__footer\"\r\n    *ngIf=\"workflowSettingsGroupedFieldData.fieldsWithEntity.fields.length > 0\"\r\n  >\r\n    <azavista-button (click)=\"toggleExpandPanels()\" color=\"primary\">{{\r\n      (workflowSettingsGroupedFieldData.expandPanels\r\n        ? \"CLOSE\"\r\n        : isWorkflowValid\r\n          ? \"OPEN\"\r\n          : \"SETUP\"\r\n      ) | translate\r\n    }}</azavista-button>\r\n  </div>\r\n  <div\r\n    class=\"workflow-builder-node-item__absolute-elements\">\r\n    <button *ngIf=\"!formHeader.editMode\" class=\"workflow-builder-node-item__absolute-elements__button-delete\" mat-icon-button (click)=\"removeNode.emit()\">\r\n      <mat-icon>close</mat-icon>\r\n    </button>\r\n  </div>\r\n</div>\r\n\r\n", styles: [":host{font-size:12px;display:flex;position:relative;width:100%;height:min-content;border:1px solid #ccc;background-color:#f5f4f5;border-radius:4px;padding:1em;box-sizing:border-box}:host ::ng-deep *,:host ::ng-deep .mat-mdc-slide-toggle .mdc-label{font-size:12px;font-family:var(--azavista-font)}:host ::ng-deep .mat-mdc-form-field-infix{min-height:36px}:host ::ng-deep .mat-mdc-text-field-wrapper .mat-mdc-form-field-flex .mat-mdc-floating-label{top:18px}:host ::ng-deep .mat-mdc-text-field-wrapper.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{--mat-mdc-form-field-label-transform: translateY( -24.75px) scale(var(--mat-mdc-form-field-floating-label-scale, .75));transform:var(--mat-mdc-form-field-label-transform)}:host ::ng-deep .mat-mdc-text-field-wrapper.mdc-text-field--outlined .mat-mdc-form-field-infix{padding-top:6px;padding-bottom:6px}:host ::ng-deep .mat-mdc-text-field-wrapper:not(.mdc-text-field--outlined) .mat-mdc-form-field-infix{padding-top:6px;padding-bottom:6px}:host ::ng-deep .mdc-text-field--no-label:not(.mdc-text-field--outlined):not(.mdc-text-field--textarea) .mat-mdc-form-field-infix{padding-top:6px;padding-bottom:6px}:host ::ng-deep .mat-mdc-text-field-wrapper:not(.mdc-text-field--outlined) .mat-mdc-floating-label{display:none}:host ::ng-deep .mat-form-field-appearance-fill .mat-mdc-select-arrow-wrapper{transform:none}:host ::ng-deep .mat-mdc-form-field{background-color:#fff}:host ::ng-deep .mat-mdc-form-field .mat-mdc-form-field-flex{height:auto!important;max-height:unset!important}:host ::ng-deep .mat-mdc-form-field .mat-mdc-select-arrow-wrapper{display:none}:host ::ng-deep .mat-mdc-form-field .mat-mdc-text-field-wrapper.mdc-text-field--outlined{height:auto!important;max-height:unset!important}:host ::ng-deep .mat-mdc-form-field .mat-mdc-text-field-wrapper.mdc-text-field--outlined:hover{background-color:transparent}:host ::ng-deep .mat-mdc-form-field .mat-mdc-text-field-wrapper.mdc-text-field--outlined .mat-mdc-form-field-infix{padding:4px 0!important;min-height:auto}:host ::ng-deep .mat-mdc-form-field .mat-mdc-form-field-required-marker{color:var(--palette-warn-500)!important}:host ::ng-deep .mat-mdc-form-field.mat-form-field-not-empty label,:host ::ng-deep .mat-mdc-form-field.mat-focused label{display:none}:host ::ng-deep .mat-mdc-form-field.mat-form-field-not-empty .mdc-notched-outline__notch,:host ::ng-deep .mat-mdc-form-field.mat-focused .mdc-notched-outline__notch{width:0px!important;padding:0}:host ::ng-deep .mat-mdc-form-field.mat-form-field-not-empty:not(.mat-form-field-invalid){--mdc-outlined-text-field-outline-color: #4caf50}.hidden.hidden[class]{display:none}.workflow-builder-node-item{display:flex;flex-direction:column;max-width:100%;width:100%;height:min-content;gap:.8em}.workflow-builder-node-item__fields{display:flex;flex-direction:column;flex:1;gap:.8em}.workflow-builder-node-item__fields ::ng-deep mat-form-field{width:100%}.workflow-builder-node-item__footer{display:flex;flex-direction:column}.workflow-builder-node-item__footer ::ng-deep .azavista-button-component.button-container{width:100%}.workflow-builder-node-item__footer ::ng-deep .azavista-button-component.button-container button{width:inherit;background-color:#98ca71}.workflow-builder-node-item__footer ::ng-deep .azavista-button-component.button-container .mdc-button__label{text-transform:uppercase}.workflow-builder-node-item__absolute-elements>*{position:absolute}.workflow-builder-node-item__absolute-elements__button-delete{--mdc-icon-button-icon-size: 16px;--mdc-icon-button-state-layer-size: 32px;overflow:hidden;top:0;right:0;padding:8px}.workflow-builder-node-item__absolute-elements__button-delete mat-icon{height:1em;width:1em;font-weight:600}\n"], dependencies: [{ kind: "directive", type: i5.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i5.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i6.MatIconButton, selector: "button[mat-icon-button]", inputs: ["disabled", "disableRipple", "color"], exportAs: ["matButton"] }, { kind: "component", type: i7.MatIcon, selector: "mat-icon", inputs: ["color", "inline", "svgIcon", "fontSet", "fontIcon"], exportAs: ["matIcon"] }, { kind: "component", type: i8.AzavistaButtonComponent, selector: "azavista-button", inputs: ["acl", "disabled", "cssClasses", "containerCssClasses"] }, { kind: "component", type: i9.WorkflowBuilderNodeFormHeaderComponent, selector: "azavista-workflow-builder-node-form-header", inputs: ["editMode", "controllerData"], outputs: ["canvasChanges"] }, { kind: "component", type: i10.WorkflowBuilderNodeFormFieldTextComponent, selector: "azavista-workflow-builder-node-form-field-text", inputs: ["property"] }, { kind: "component", type: i11.WorkflowBuilderNodeFormFieldSelectComponent, selector: "azavista-workflow-builder-node-form-field-select", inputs: ["property"] }, { kind: "component", type: i12.WorkflowBuilderNodeFormFieldToggleComponent, selector: "azavista-workflow-builder-node-form-field-toggle" }, { kind: "component", type: i13.WorkflowBuilderNodeFormFieldProcessComponent, selector: "azavista-workflow-builder-node-form-field-process", inputs: ["property"] }, { kind: "pipe", type: i14.TranslatePipe, name: "translate" }], changeDetection: i0.ChangeDetectionStrategy.Default }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.10", ngImport: i0, type: WorkflowBuilderNodeFormComponent, decorators: [{
            type: Component,
            args: [{ selector: 'azavista-workflow-builder-node-form', providers: [...ngResizeObserverProviders], changeDetection: ChangeDetectionStrategy.Default, template: "<div\r\n  class=\"workflow-builder-node-item\"\r\n  *ngIf=\"workflowSettingsGroupedFieldData && canvasGroupFieldData\"\r\n>\r\n  <azavista-workflow-builder-node-form-header\r\n    #formHeader\r\n    [controllerData]=\"controllerData\"\r\n    (canvasChanges)=\"onUpdateCanvasFields($event)\"\r\n  ></azavista-workflow-builder-node-form-header>\r\n\r\n  <div class=\"workflow-builder-node-item__fields\">\r\n    <ng-container *ngIf=\"workflowSettingsGroupedFieldData.expandPanels\">\r\n      <ng-container\r\n        *ngFor=\"let property of properties; trackBy: trackByWorkflowProperty\"\r\n      >\r\n        <ng-container\r\n          *ngIf=\"formGroup?.controls?.[property.attribute] as formControl\"\r\n        >\r\n          <azavista-workflow-builder-node-form-field-select\r\n            *ngIf=\"\r\n              property.type === 'select' || property.type === 'multiselect'\r\n            \"\r\n            [eventId]=\"eventId\"\r\n            [workflowId]=\"workflowId\"\r\n            [property]=\"property\"\r\n            [control]=\"$any(formControl)\"\r\n          >\r\n          </azavista-workflow-builder-node-form-field-select>\r\n          <azavista-workflow-builder-node-form-field-text\r\n            *ngIf=\"property.type === 'text' || property.type === 'number'\"\r\n            [eventId]=\"eventId\"\r\n            [workflowId]=\"workflowId\"\r\n            [property]=\"$any(property)\"\r\n            [control]=\"$any(formControl)\"\r\n          >\r\n          </azavista-workflow-builder-node-form-field-text>\r\n          <azavista-workflow-builder-node-form-field-toggle\r\n            *ngIf=\"property.type === 'boolean'\"\r\n            [eventId]=\"eventId\"\r\n            [workflowId]=\"workflowId\"\r\n            [property]=\"$any(property)\"\r\n            [control]=\"$any(formControl)\"\r\n          >\r\n          </azavista-workflow-builder-node-form-field-toggle>\r\n          <azavista-workflow-builder-node-form-field-process\r\n            *ngIf=\"property.type === 'process'\"\r\n            [eventId]=\"eventId\"\r\n            [workflowId]=\"workflowId\"\r\n            [property]=\"$any(property)\"\r\n            [control]=\"$any(formControl)\"\r\n          >\r\n          </azavista-workflow-builder-node-form-field-process>\r\n        </ng-container>\r\n      </ng-container>\r\n    </ng-container>\r\n  </div>\r\n  <div\r\n    class=\"workflow-builder-node-item__footer\"\r\n    *ngIf=\"workflowSettingsGroupedFieldData.fieldsWithEntity.fields.length > 0\"\r\n  >\r\n    <azavista-button (click)=\"toggleExpandPanels()\" color=\"primary\">{{\r\n      (workflowSettingsGroupedFieldData.expandPanels\r\n        ? \"CLOSE\"\r\n        : isWorkflowValid\r\n          ? \"OPEN\"\r\n          : \"SETUP\"\r\n      ) | translate\r\n    }}</azavista-button>\r\n  </div>\r\n  <div\r\n    class=\"workflow-builder-node-item__absolute-elements\">\r\n    <button *ngIf=\"!formHeader.editMode\" class=\"workflow-builder-node-item__absolute-elements__button-delete\" mat-icon-button (click)=\"removeNode.emit()\">\r\n      <mat-icon>close</mat-icon>\r\n    </button>\r\n  </div>\r\n</div>\r\n\r\n", styles: [":host{font-size:12px;display:flex;position:relative;width:100%;height:min-content;border:1px solid #ccc;background-color:#f5f4f5;border-radius:4px;padding:1em;box-sizing:border-box}:host ::ng-deep *,:host ::ng-deep .mat-mdc-slide-toggle .mdc-label{font-size:12px;font-family:var(--azavista-font)}:host ::ng-deep .mat-mdc-form-field-infix{min-height:36px}:host ::ng-deep .mat-mdc-text-field-wrapper .mat-mdc-form-field-flex .mat-mdc-floating-label{top:18px}:host ::ng-deep .mat-mdc-text-field-wrapper.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{--mat-mdc-form-field-label-transform: translateY( -24.75px) scale(var(--mat-mdc-form-field-floating-label-scale, .75));transform:var(--mat-mdc-form-field-label-transform)}:host ::ng-deep .mat-mdc-text-field-wrapper.mdc-text-field--outlined .mat-mdc-form-field-infix{padding-top:6px;padding-bottom:6px}:host ::ng-deep .mat-mdc-text-field-wrapper:not(.mdc-text-field--outlined) .mat-mdc-form-field-infix{padding-top:6px;padding-bottom:6px}:host ::ng-deep .mdc-text-field--no-label:not(.mdc-text-field--outlined):not(.mdc-text-field--textarea) .mat-mdc-form-field-infix{padding-top:6px;padding-bottom:6px}:host ::ng-deep .mat-mdc-text-field-wrapper:not(.mdc-text-field--outlined) .mat-mdc-floating-label{display:none}:host ::ng-deep .mat-form-field-appearance-fill .mat-mdc-select-arrow-wrapper{transform:none}:host ::ng-deep .mat-mdc-form-field{background-color:#fff}:host ::ng-deep .mat-mdc-form-field .mat-mdc-form-field-flex{height:auto!important;max-height:unset!important}:host ::ng-deep .mat-mdc-form-field .mat-mdc-select-arrow-wrapper{display:none}:host ::ng-deep .mat-mdc-form-field .mat-mdc-text-field-wrapper.mdc-text-field--outlined{height:auto!important;max-height:unset!important}:host ::ng-deep .mat-mdc-form-field .mat-mdc-text-field-wrapper.mdc-text-field--outlined:hover{background-color:transparent}:host ::ng-deep .mat-mdc-form-field .mat-mdc-text-field-wrapper.mdc-text-field--outlined .mat-mdc-form-field-infix{padding:4px 0!important;min-height:auto}:host ::ng-deep .mat-mdc-form-field .mat-mdc-form-field-required-marker{color:var(--palette-warn-500)!important}:host ::ng-deep .mat-mdc-form-field.mat-form-field-not-empty label,:host ::ng-deep .mat-mdc-form-field.mat-focused label{display:none}:host ::ng-deep .mat-mdc-form-field.mat-form-field-not-empty .mdc-notched-outline__notch,:host ::ng-deep .mat-mdc-form-field.mat-focused .mdc-notched-outline__notch{width:0px!important;padding:0}:host ::ng-deep .mat-mdc-form-field.mat-form-field-not-empty:not(.mat-form-field-invalid){--mdc-outlined-text-field-outline-color: #4caf50}.hidden.hidden[class]{display:none}.workflow-builder-node-item{display:flex;flex-direction:column;max-width:100%;width:100%;height:min-content;gap:.8em}.workflow-builder-node-item__fields{display:flex;flex-direction:column;flex:1;gap:.8em}.workflow-builder-node-item__fields ::ng-deep mat-form-field{width:100%}.workflow-builder-node-item__footer{display:flex;flex-direction:column}.workflow-builder-node-item__footer ::ng-deep .azavista-button-component.button-container{width:100%}.workflow-builder-node-item__footer ::ng-deep .azavista-button-component.button-container button{width:inherit;background-color:#98ca71}.workflow-builder-node-item__footer ::ng-deep .azavista-button-component.button-container .mdc-button__label{text-transform:uppercase}.workflow-builder-node-item__absolute-elements>*{position:absolute}.workflow-builder-node-item__absolute-elements__button-delete{--mdc-icon-button-icon-size: 16px;--mdc-icon-button-state-layer-size: 32px;overflow:hidden;top:0;right:0;padding:8px}.workflow-builder-node-item__absolute-elements__button-delete mat-icon{height:1em;width:1em;font-weight:600}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.AzavistaSharedService }, { type: i0.ElementRef }, { type: i2.AzavistaWorkflowBuilderController }, { type: i3.NgResizeObserver }, { type: i0.NgZone }, { type: i4.AzavistaWorkflowBuilderFormFieldService }]; }, propDecorators: { node: [{
                type: Input
            }], eventId: [{
                type: Input
            }], diagramEl: [{
                type: Input
            }], attrNodeId: [{
                type: HostBinding,
                args: ['attr.nodeId']
            }], workflowSettingsChanges: [{
                type: Output
            }], canvasChanges: [{
                type: Output
            }], removeNode: [{
                type: Output
            }], workflowSettingsGroupedFieldEl: [{
                type: ViewChild,
                args: ['workflowSettingsGroupedField', {
                        read: AzavistaGroupedFieldsComponent,
                    }]
            }], formHeader: [{
                type: ViewChild,
                args: ['formHeader']
            }], onKeyDown: [{
                type: HostListener,
                args: ['keydown', ['$event']]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid29ya2Zsb3ctYnVpbGRlci1ub2RlLWZvcm0uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvYXphdmlzdGEvd29ya2Zsb3ctYnVpbGRlci9zcmMvbGliL2NvbXBvbmVudHMvd29ya2Zsb3ctYnVpbGRlci1ub2RlLWZvcm0vd29ya2Zsb3ctYnVpbGRlci1ub2RlLWZvcm0uY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvYXphdmlzdGEvd29ya2Zsb3ctYnVpbGRlci9zcmMvbGliL2NvbXBvbmVudHMvd29ya2Zsb3ctYnVpbGRlci1ub2RlLWZvcm0vd29ya2Zsb3ctYnVpbGRlci1ub2RlLWZvcm0uY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNILHVCQUF1QixFQUN2QixTQUFTLEVBRVQsWUFBWSxFQUNaLFdBQVcsRUFDWCxZQUFZLEVBQ1osS0FBSyxFQUdMLE1BQU0sRUFDTixTQUFTLEdBQ1osTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUtILElBQUksR0FDUCxNQUFNLDZCQUE2QixDQUFDO0FBT3JDLE9BQU8sRUFFSCx5QkFBeUIsR0FDNUIsTUFBTSxvQkFBb0IsQ0FBQztBQUM1QixPQUFPLEVBQUUsOEJBQThCLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQUNyRixPQUFPLEVBQUUsWUFBWSxFQUFFLGNBQWMsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUVwRCxPQUFPLEVBQ0gsa0JBQWtCLEVBQ2xCLHVCQUF1QixFQUN2QixVQUFVLEVBQ1YsdUJBQXVCLEdBQzFCLE1BQU0sYUFBYSxDQUFDO0FBRXJCLE9BQU8sRUFHSCxpQ0FBaUMsRUFDakMsMEJBQTBCLEdBQzdCLE1BQU0sYUFBYSxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7O0FBV3JCLE1BQU0sT0FBTyxnQ0FBZ0M7SUF3Q3pDLElBQUksVUFBVTtRQUNWLE9BQU8sdUJBQXVCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUNqRCxDQUFDO0lBRUQsSUFBSSxjQUFjO1FBQ2QsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDcEQsQ0FBQztJQUVELElBQUksZUFBZTtRQUNmLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ3hELENBQUM7SUFFRCxZQUNZLFNBQWdDLEVBQ2hDLElBQTZCLEVBQzlCLFVBQTZDLEVBQzVDLE9BQXlCLEVBQ3pCLE1BQWMsRUFDZCxnQkFBeUQ7UUFMekQsY0FBUyxHQUFULFNBQVMsQ0FBdUI7UUFDaEMsU0FBSSxHQUFKLElBQUksQ0FBeUI7UUFDOUIsZUFBVSxHQUFWLFVBQVUsQ0FBbUM7UUFDNUMsWUFBTyxHQUFQLE9BQU8sQ0FBa0I7UUFDekIsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUNkLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBeUM7UUFuRHpDLGVBQVUsR0FBRyxFQUFFLENBQUM7UUFFbEMsNEJBQXVCLEdBQzdCLElBQUksWUFBWSxFQUEyQixDQUFDO1FBRXRDLGtCQUFhLEdBQUcsSUFBSSxZQUFZLEVBQW1CLENBQUM7UUFFcEQsZUFBVSxHQUFHLElBQUksWUFBWSxFQUFRLENBQUM7UUFrQmhELGVBQVUsR0FBdUIsRUFBRSxDQUFDO1FBRXBDLFdBQU0sR0FBYSxFQUFFLENBQUM7UUFFdEIsNEJBQXVCLEdBQUcsdUJBQXVCLENBQUM7SUF1Qi9DLENBQUM7SUFFSixLQUFLLENBQUMsUUFBUTtRQUNWLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7UUFDL0IsTUFBTSxFQUFFLGNBQWMsRUFBRSxHQUFHLElBQUksQ0FBQztRQUNoQyxJQUFJLENBQUMsY0FBYyxFQUFFO1lBQ2pCLE9BQU87U0FDVjtRQUNELElBQUksQ0FBQyxnQ0FBZ0M7WUFDakMsTUFBTSxJQUFJLENBQUMsb0NBQW9DLENBQUMsY0FBYyxDQUFDLENBQUM7UUFFcEUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUNuQyxJQUFJLENBQUMsb0JBQW9CO1lBQ3JCLElBQUksQ0FBQyw2QkFBNkIsQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUV2RCxNQUFNLGNBQWMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzNDLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO1FBRTFCLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxLQUFLLElBQUksRUFBRTtZQUNyRCxNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO1lBQzdELE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztZQUM1QyxJQUFJLFlBQVksRUFBRTtnQkFDZCxZQUFZLENBQUMsTUFBTSxHQUFHLElBQUksRUFBRSxNQUFNLENBQUM7YUFDdEM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFHRCxTQUFTLENBQUMsS0FBb0I7UUFDMUIsOEVBQThFO1FBQzlFLEtBQUssQ0FBQyxlQUFlLEVBQUUsQ0FBQztJQUM1QixDQUFDO0lBRU8sYUFBYSxDQUFDLGNBQWtEO1FBQ3BFLE1BQU0sRUFBRSxPQUFPLEVBQUUsR0FBRyxjQUFjLENBQUM7UUFDbkMsSUFBSSxDQUFDLFVBQVUsR0FBRyxPQUFPLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDMUMsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsK0JBQStCLENBQ2xFLElBQUksQ0FBQyxVQUFVLEVBQ2YsT0FBTyxDQUNWLENBQUM7UUFDRixJQUFJLENBQUMsU0FBUyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLEdBQUcsRUFBRTtZQUMvRCxJQUFJLENBQUMsVUFBVSxDQUFDLHNCQUFzQixDQUNsQyxJQUFJLENBQUMsVUFBVSxFQUNmLGtCQUFrQixDQUFDLElBQUksQ0FBQyxTQUFVLENBQVEsQ0FDN0MsQ0FBQztRQUNOLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUVELEtBQUssQ0FBQyx3Q0FBd0MsQ0FDMUMsT0FBNEM7UUFFNUMsTUFBTSxFQUFFLFlBQVksRUFBRSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUM7UUFDekMsSUFBSSxDQUFDLFlBQVksRUFBRTtZQUNmLE9BQU8sRUFBRSxDQUFDO1NBQ2I7UUFDRCxPQUFPLE9BQU8sQ0FBQyxHQUFHLENBQ2QsT0FBTyxDQUFDLHVCQUF1QixFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsUUFBUSxFQUFFLEVBQUU7WUFDL0MsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsNEJBQTRCLENBQ3JELFFBQVEsRUFDUixZQUFZLEVBQ1o7Z0JBQ0ksT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPO2dCQUNyQixVQUFVLEVBQUUsSUFBSSxDQUFDLFVBQVU7YUFDOUIsQ0FDSixDQUFDO1FBQ04sQ0FBQyxDQUFDLENBQ0wsQ0FBQztJQUNOLENBQUM7SUFFRCxtQ0FBbUM7SUFDbkMsS0FBSyxDQUFDLG9DQUFvQyxDQUN0QyxjQUF1QztRQUV2QyxNQUFNLEVBQUUsT0FBTyxFQUFFLEdBQUcsY0FBYyxDQUFDO1FBQ25DLElBQUksQ0FBQyxVQUFVLEdBQUcsT0FBTyxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQzFDLE1BQU0sTUFBTSxHQUNSLE1BQU0sSUFBSSxDQUFDLHdDQUF3QyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ2pFLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxZQUFZLEdBQUcsT0FBTyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQzFDLE9BQU87WUFDSCxZQUFZLEVBQUUsSUFBSTtZQUNsQixvQkFBb0IsRUFBRSxJQUFJO1lBQzFCLG1CQUFtQixFQUFFLElBQUk7WUFDekIsYUFBYSxFQUFFO2dCQUNYO29CQUNJLE9BQU8sRUFBRSxLQUFLO29CQUNkLE9BQU8sRUFBRSxFQUFFO2lCQUNkO2FBQ0o7WUFDRCxnQkFBZ0IsRUFBRTtnQkFDZCxNQUFNLEVBQUUsT0FBTyxDQUFDLFdBQVcsRUFBRSxDQUFDLFFBQVE7Z0JBQ3RDLE1BQU07YUFDVDtZQUNELFlBQVksRUFBRSxLQUFLO1NBQ3RCLENBQUM7SUFDTixDQUFDO0lBRUQsS0FBSyxDQUFDLGtCQUFrQjtRQUNwQixJQUFJLElBQUksQ0FBQyxnQ0FBZ0MsRUFBRTtZQUN2QyxJQUFJLENBQUMsZ0NBQWdDLENBQUMsWUFBWTtnQkFDOUMsQ0FBQyxJQUFJLENBQUMsZ0NBQWdDLENBQUMsWUFBWSxDQUFDO1NBQzNEO0lBQ0wsQ0FBQztJQUVELDZCQUE2QixDQUN6QixjQUF1QztRQUV2QyxNQUFNLEVBQ0YsSUFBSSxFQUNKLFdBQVcsRUFDWCxPQUFPLEVBQUUsRUFBRSxJQUFJLEVBQUUsR0FDcEIsR0FBRyxjQUFjLENBQUM7UUFDbkIsT0FBTztZQUNILFlBQVksRUFBRSxJQUFJO1lBQ2xCLG9CQUFvQixFQUFFLElBQUk7WUFDMUIsWUFBWSxFQUFFLElBQUk7WUFDbEIsbUJBQW1CLEVBQUUsSUFBSTtZQUN6QixnQkFBZ0IsRUFBRTtnQkFDZCxNQUFNLEVBQUUsSUFBSSxDQUFDLGdCQUFnQixDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQztnQkFDdkQsTUFBTSxFQUFFO29CQUNKLElBQUksRUFDQSxJQUFJO3dCQUNKLElBQUksQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUNwQiwwQkFBMEIsQ0FBQyxJQUFJLENBQUMsQ0FDbkM7b0JBQ0wsV0FBVyxFQUNQLFdBQVc7d0JBQ1gsSUFBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQ3BCLGlDQUFpQyxDQUFDLElBQUksQ0FBQyxDQUMxQztpQkFDUjthQUNKO1NBQ0osQ0FBQztJQUNOLENBQUM7SUFFRCxvQkFBb0IsQ0FBQyxJQUFxQjtRQUN0QyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM5QixJQUFJLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUU7WUFDcEQsSUFBSSxDQUFDLG9CQUFvQixDQUFDLGdCQUFnQixDQUFDLE1BQU0sR0FBRztnQkFDaEQsR0FBRyxJQUFJLENBQUMsb0JBQW9CLEVBQUUsZ0JBQWdCLENBQUMsTUFBTTtnQkFDckQsR0FBRyxJQUFJO2FBQ1YsQ0FBQztTQUNMO0lBQ0wsQ0FBQztJQUVELDhCQUE4QixDQUFDLElBQTZCO1FBQ3hELElBQ0ksSUFBSSxDQUFDLDhCQUE4QixFQUFFLHVCQUF1QjtZQUN4RCxFQUFFLE1BQU0sR0FBRyxDQUFDO1lBQ2hCLElBQUksQ0FBQyxHQUFHLElBQUksSUFBSTtZQUNoQixVQUFVLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQ25DO1lBQ0UsT0FBTztTQUNWO1FBQ0Q7OztXQUdHO1FBQ0gsTUFBTSx5QkFBeUIsR0FDM0IsSUFBSSxDQUFDLGNBQWMsRUFBRSxPQUFPO2FBQ3ZCLGFBQWEsRUFBRTthQUNmLE1BQU0sQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxDQUFDLElBQUksS0FBSyxTQUFTLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDeEQsTUFBTSxjQUFjLEdBQUcseUJBQXlCLENBQUMsSUFBSSxDQUNqRCxDQUFDLEVBQUUsU0FBUyxFQUFFLEVBQUUsRUFBRSxDQUNkLFNBQVMsS0FBSyxJQUFJLENBQUMscUJBQXFCLEVBQUUsS0FBSyxDQUFDLEVBQUUsQ0FDekQsQ0FBQztRQUNGLElBQUksY0FBYyxFQUFFO1lBQ2hCLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1lBQ3hCLE9BQU87U0FDVjtRQUNELElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxJQUFJLENBQUM7WUFDOUIsR0FBRyxJQUFJO1lBQ1AsR0FBRyxFQUFFLElBQUksQ0FBQyxHQUFHO2dCQUNULENBQUMsQ0FBQyxJQUFJLENBQ0EsSUFBSSxDQUFDLEdBQUcsRUFDUix5QkFBeUIsQ0FBQyxHQUFHLENBQ3pCLENBQUMsRUFBRSxTQUFTLEVBQUUsRUFBRSxFQUFFLENBQUMsU0FBUyxDQUMvQixDQUNKO2dCQUNILENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRztTQUNqQixDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQsa0JBQWtCO1FBQ2QsSUFBSSxDQUFDLGNBQWMsRUFBRSxPQUFPLENBQUMsYUFBYSxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUMsVUFBVSxFQUFFLEVBQUU7WUFDaEUsTUFBTSxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsR0FBRyxVQUFVLENBQUM7WUFDN0MsSUFBSSxVQUFVLEVBQUU7Z0JBQ1osSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhO3FCQUNsQixhQUFhLENBQ1YsaUNBQWlDLFNBQVMsR0FBRyxDQUNoRDtvQkFDRCxFQUFFLFNBQVMsQ0FBQyxHQUFHLENBQUMsY0FBYyxVQUFVLEVBQUUsQ0FBQyxDQUFDO2FBQ25EO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQsZ0JBQWdCO1FBQ1osS0FBSyxDQUFDLHVCQUF1QixDQUFDLENBQUM7SUFDbkMsQ0FBQztJQUVPLGVBQWU7UUFDbkIsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLEtBQUssSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUN0RSxDQUFDOytHQXJRUSxnQ0FBZ0M7bUdBQWhDLGdDQUFnQywwV0FIOUIsQ0FBQyxHQUFHLHlCQUF5QixDQUFDLHFKQW9CL0IsOEJBQThCLHdIQ3pFNUMsZ2tHQTZFQTs7NEZEckJhLGdDQUFnQztrQkFQNUMsU0FBUzsrQkFDSSxxQ0FBcUMsYUFHcEMsQ0FBQyxHQUFHLHlCQUF5QixDQUFDLG1CQUN4Qix1QkFBdUIsQ0FBQyxPQUFPOytSQUd2QyxJQUFJO3NCQUFaLEtBQUs7Z0JBRUcsT0FBTztzQkFBZixLQUFLO2dCQUVHLFNBQVM7c0JBQWpCLEtBQUs7Z0JBRXNCLFVBQVU7c0JBQXJDLFdBQVc7dUJBQUMsYUFBYTtnQkFFaEIsdUJBQXVCO3NCQUFoQyxNQUFNO2dCQUdHLGFBQWE7c0JBQXRCLE1BQU07Z0JBRUcsVUFBVTtzQkFBbkIsTUFBTTtnQkFLUCw4QkFBOEI7c0JBSDdCLFNBQVM7dUJBQUMsOEJBQThCLEVBQUU7d0JBQ3ZDLElBQUksRUFBRSw4QkFBOEI7cUJBQ3ZDO2dCQUlELFVBQVU7c0JBRFQsU0FBUzt1QkFBQyxZQUFZO2dCQWtFdkIsU0FBUztzQkFEUixZQUFZO3VCQUFDLFNBQVMsRUFBRSxDQUFDLFFBQVEsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcclxuICAgIENvbXBvbmVudCxcclxuICAgIEVsZW1lbnRSZWYsXHJcbiAgICBFdmVudEVtaXR0ZXIsXHJcbiAgICBIb3N0QmluZGluZyxcclxuICAgIEhvc3RMaXN0ZW5lcixcclxuICAgIElucHV0LFxyXG4gICAgTmdab25lLFxyXG4gICAgT25Jbml0LFxyXG4gICAgT3V0cHV0LFxyXG4gICAgVmlld0NoaWxkLFxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQge1xyXG4gICAgQXphdmlzdGFTaGFyZWRTZXJ2aWNlLFxyXG4gICAgSUF6YXZpc3RhR3JvdXBlZEZpZWxkc0NvbXBvbmVudERhdGEsXHJcbiAgICBJRmllbGQsXHJcbiAgICBJVmFsdWVDaGFuZ2VzV2l0aE9iamVjdCxcclxuICAgIG9taXQsXHJcbn0gZnJvbSAnQGF6YXZpc3RhL2NvbXBvbmVudHMvc2hhcmVkJztcclxuaW1wb3J0IHtcclxuICAgIENhbnZhcyxcclxuICAgIENhbnZhc1dvcmtmbG93SXRlbSxcclxuICAgIFdvcmtmbG93UHJvcGVydHksXHJcbiAgICBXb3JrZmxvd1R5cGUsXHJcbn0gZnJvbSAnQGF6YXZpc3RhL3dvcmtmbG93LWJ1aWxkZXItc2hhcmVkJztcclxuaW1wb3J0IHtcclxuICAgIE5nUmVzaXplT2JzZXJ2ZXIsXHJcbiAgICBuZ1Jlc2l6ZU9ic2VydmVyUHJvdmlkZXJzLFxyXG59IGZyb20gJ25nLXJlc2l6ZS1vYnNlcnZlcic7XHJcbmltcG9ydCB7IEF6YXZpc3RhR3JvdXBlZEZpZWxkc0NvbXBvbmVudCB9IGZyb20gJ0BhemF2aXN0YS9jb21wb25lbnRzL2dyb3VwZWQtZmllbGRzJztcclxuaW1wb3J0IHsgZGVib3VuY2VUaW1lLCBmaXJzdFZhbHVlRnJvbSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBGb3JtR3JvdXAgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7XHJcbiAgICBnZXRGb3JtRGlydHlWYWx1ZXMsXHJcbiAgICBnZXRXb3JrZmxvd0lkRnJvbU5vZGVJZCxcclxuICAgIG9iamVjdEtleXMsXHJcbiAgICB0cmFja0J5V29ya2Zsb3dQcm9wZXJ0eSxcclxufSBmcm9tICcuLi8uLi91dGlscyc7XHJcbmltcG9ydCB7IEF6YXZpc3RhV29ya2Zsb3dCdWlsZGVyQ29udHJvbGxlciB9IGZyb20gJy4uLy4uL3dvcmtmbG93LWJ1aWxkZXIuY29udHJvbGxlcic7XHJcbmltcG9ydCB7XHJcbiAgICBDYW52YXNDb250cm9sbGVyRGF0YSxcclxuICAgIENhbnZhc1dvcmtmbG93RmFjdG9yeSxcclxuICAgIFdPUktGTE9XX0VYUExBTkFUSU9OX1RSQU5TTEFUSU9OUyxcclxuICAgIFdPUktGTE9XX05BTUVfVFJBTlNMQVRJT05TLFxyXG59IGZyb20gJy4uLy4uL3R5cGVzJztcclxuaW1wb3J0IHsgQXphdmlzdGFXb3JrZmxvd0J1aWxkZXJGb3JtRmllbGRTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvd29ya2Zsb3ctYnVpbGRlci5mb3JtLWZpZWxkLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBXb3JrZmxvd0J1aWxkZXJOb2RlRm9ybUhlYWRlckNvbXBvbmVudCB9IGZyb20gJy4uL3dvcmtmbG93LWJ1aWxkZXItbm9kZS1mb3JtLWhlYWRlci93b3JrZmxvdy1idWlsZGVyLW5vZGUtZm9ybS1oZWFkZXIuY29tcG9uZW50JztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdhemF2aXN0YS13b3JrZmxvdy1idWlsZGVyLW5vZGUtZm9ybScsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vd29ya2Zsb3ctYnVpbGRlci1ub2RlLWZvcm0uY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgc3R5bGVVcmxzOiBbJy4vd29ya2Zsb3ctYnVpbGRlci1ub2RlLWZvcm0uY29tcG9uZW50LnNjc3MnXSxcclxuICAgIHByb3ZpZGVyczogWy4uLm5nUmVzaXplT2JzZXJ2ZXJQcm92aWRlcnNdLFxyXG4gICAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5EZWZhdWx0LFxyXG59KVxyXG5leHBvcnQgY2xhc3MgV29ya2Zsb3dCdWlsZGVyTm9kZUZvcm1Db21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG4gICAgQElucHV0KCkgbm9kZSE6IE5vZGVNb2RlbDxzdHJpbmc+O1xyXG5cclxuICAgIEBJbnB1dCgpIGV2ZW50SWQhOiBzdHJpbmc7XHJcblxyXG4gICAgQElucHV0KCkgZGlhZ3JhbUVsITogRGlhZ3JhbTtcclxuXHJcbiAgICBASG9zdEJpbmRpbmcoJ2F0dHIubm9kZUlkJykgYXR0ck5vZGVJZCA9ICcnO1xyXG5cclxuICAgIEBPdXRwdXQoKSB3b3JrZmxvd1NldHRpbmdzQ2hhbmdlcyA9XHJcbiAgICAgICAgbmV3IEV2ZW50RW1pdHRlcjxJVmFsdWVDaGFuZ2VzV2l0aE9iamVjdD4oKTtcclxuXHJcbiAgICBAT3V0cHV0KCkgY2FudmFzQ2hhbmdlcyA9IG5ldyBFdmVudEVtaXR0ZXI8UGFydGlhbDxDYW52YXM+PigpO1xyXG5cclxuICAgIEBPdXRwdXQoKSByZW1vdmVOb2RlID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xyXG5cclxuICAgIEBWaWV3Q2hpbGQoJ3dvcmtmbG93U2V0dGluZ3NHcm91cGVkRmllbGQnLCB7XHJcbiAgICAgICAgcmVhZDogQXphdmlzdGFHcm91cGVkRmllbGRzQ29tcG9uZW50LFxyXG4gICAgfSlcclxuICAgIHdvcmtmbG93U2V0dGluZ3NHcm91cGVkRmllbGRFbCE6IEF6YXZpc3RhR3JvdXBlZEZpZWxkc0NvbXBvbmVudDtcclxuXHJcbiAgICBAVmlld0NoaWxkKCdmb3JtSGVhZGVyJylcclxuICAgIGZvcm1IZWFkZXI/OiBXb3JrZmxvd0J1aWxkZXJOb2RlRm9ybUhlYWRlckNvbXBvbmVudDtcclxuXHJcbiAgICB3b3JrZmxvd1NldHRpbmdzR3JvdXBlZEZpZWxkRGF0YT86XHJcbiAgICAgICAgfCBJQXphdmlzdGFHcm91cGVkRmllbGRzQ29tcG9uZW50RGF0YVxyXG4gICAgICAgIHwgdW5kZWZpbmVkO1xyXG5cclxuICAgIGNhbnZhc0dyb3VwRmllbGREYXRhPzogSUF6YXZpc3RhR3JvdXBlZEZpZWxkc0NvbXBvbmVudERhdGEgfCB1bmRlZmluZWQ7XHJcblxyXG4gICAgd29ya2Zsb3dJdGVtPzogQ2FudmFzV29ya2Zsb3dJdGVtO1xyXG5cclxuICAgIHByb3BlcnRpZXM6IFdvcmtmbG93UHJvcGVydHlbXSA9IFtdO1xyXG5cclxuICAgIGZpZWxkczogSUZpZWxkW10gPSBbXTtcclxuXHJcbiAgICB0cmFja0J5V29ya2Zsb3dQcm9wZXJ0eSA9IHRyYWNrQnlXb3JrZmxvd1Byb3BlcnR5O1xyXG5cclxuICAgIGZvcm1Hcm91cD86IEZvcm1Hcm91cDtcclxuXHJcbiAgICBnZXQgd29ya2Zsb3dJZCgpIHtcclxuICAgICAgICByZXR1cm4gZ2V0V29ya2Zsb3dJZEZyb21Ob2RlSWQodGhpcy5ub2RlLmlkKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgY29udHJvbGxlckRhdGEoKTogQ2FudmFzQ29udHJvbGxlckRhdGE8V29ya2Zsb3dUeXBlPiB8IHVuZGVmaW5lZCB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY29udHJvbGxlci5kYXRhTWFwW3RoaXMud29ya2Zsb3dJZF07XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGlzV29ya2Zsb3dWYWxpZCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jb250cm9sbGVyLnZhbGlkaXR5TWFwW3RoaXMud29ya2Zsb3dJZF07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHJpdmF0ZSBzaGFyZWRTdmM6IEF6YXZpc3RhU2hhcmVkU2VydmljZSxcclxuICAgICAgICBwcml2YXRlIGhvc3Q6IEVsZW1lbnRSZWY8SFRNTEVsZW1lbnQ+LFxyXG4gICAgICAgIHB1YmxpYyBjb250cm9sbGVyOiBBemF2aXN0YVdvcmtmbG93QnVpbGRlckNvbnRyb2xsZXIsXHJcbiAgICAgICAgcHJpdmF0ZSByZXNpemUkOiBOZ1Jlc2l6ZU9ic2VydmVyLFxyXG4gICAgICAgIHByaXZhdGUgbmdab25lOiBOZ1pvbmUsXHJcbiAgICAgICAgcHJpdmF0ZSBmb3JtRmllbGRTZXJ2aWNlOiBBemF2aXN0YVdvcmtmbG93QnVpbGRlckZvcm1GaWVsZFNlcnZpY2UsXHJcbiAgICApIHt9XHJcblxyXG4gICAgYXN5bmMgbmdPbkluaXQoKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICAgICAgdGhpcy5hdHRyTm9kZUlkID0gdGhpcy5ub2RlLmlkO1xyXG4gICAgICAgIGNvbnN0IHsgY29udHJvbGxlckRhdGEgfSA9IHRoaXM7XHJcbiAgICAgICAgaWYgKCFjb250cm9sbGVyRGF0YSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMud29ya2Zsb3dTZXR0aW5nc0dyb3VwZWRGaWVsZERhdGEgPVxyXG4gICAgICAgICAgICBhd2FpdCB0aGlzLmNyZWF0ZVdvcmtmbG93U2V0dGluZ3NHcm91cEZpZWxkRGF0YShjb250cm9sbGVyRGF0YSk7XHJcblxyXG4gICAgICAgIHRoaXMuaW5pdEZvcm1Hcm91cChjb250cm9sbGVyRGF0YSk7XHJcbiAgICAgICAgdGhpcy5jYW52YXNHcm91cEZpZWxkRGF0YSA9XHJcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlQ2FudmFzR3JvdXBlZEZpZWxkc0RhdGEoY29udHJvbGxlckRhdGEpO1xyXG5cclxuICAgICAgICBhd2FpdCBmaXJzdFZhbHVlRnJvbSh0aGlzLm5nWm9uZS5vblN0YWJsZSk7XHJcbiAgICAgICAgdGhpcy5sb2FkRmllbGRzQ3NzQ2xhc3MoKTtcclxuXHJcbiAgICAgICAgdGhpcy5yZXNpemUkLnBpcGUoZGVib3VuY2VUaW1lKDUwKSkuc3Vic2NyaWJlKGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcmVjdCA9IHRoaXMuaG9zdC5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgICAgICBjb25zdCBub2RlSW5zdGFuY2UgPSB0aGlzLmdldE5vZGVJbnN0YW5jZSgpO1xyXG4gICAgICAgICAgICBpZiAobm9kZUluc3RhbmNlKSB7XHJcbiAgICAgICAgICAgICAgICBub2RlSW5zdGFuY2UuaGVpZ2h0ID0gcmVjdD8uaGVpZ2h0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgQEhvc3RMaXN0ZW5lcigna2V5ZG93bicsIFsnJGV2ZW50J10pXHJcbiAgICBvbktleURvd24oZXZlbnQ6IEtleWJvYXJkRXZlbnQpIHtcclxuICAgICAgICAvLyBwcmV2ZW50IHdoZW4gdHlwaW5nIG9uIGZvcm0gZ2V0IHRyZWF0ZWQgYXMgbW92aW5nIG9yIGRlbGV0aW5nIHdvcmtmbG93IGl0ZW1cclxuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGluaXRGb3JtR3JvdXAoY29udHJvbGxlckRhdGE6IENhbnZhc0NvbnRyb2xsZXJEYXRhPFdvcmtmbG93VHlwZT4pIHtcclxuICAgICAgICBjb25zdCB7IGZhY3RvcnkgfSA9IGNvbnRyb2xsZXJEYXRhO1xyXG4gICAgICAgIHRoaXMucHJvcGVydGllcyA9IGZhY3RvcnkuZ2V0UHJvcGVydGllcygpO1xyXG4gICAgICAgIHRoaXMuZm9ybUdyb3VwID0gdGhpcy5mb3JtRmllbGRTZXJ2aWNlLmdldEZvcm1Hcm91cEZyb21Xb3JrZmxvd0ZhY3RvcnkoXHJcbiAgICAgICAgICAgIHRoaXMucHJvcGVydGllcyxcclxuICAgICAgICAgICAgZmFjdG9yeSxcclxuICAgICAgICApO1xyXG4gICAgICAgIHRoaXMuZm9ybUdyb3VwLnZhbHVlQ2hhbmdlcy5waXBlKGRlYm91bmNlVGltZSgyMDApKS5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRyb2xsZXIudXBkYXRlV29ya2Zsb3dTZXR0aW5ncyhcclxuICAgICAgICAgICAgICAgIHRoaXMud29ya2Zsb3dJZCxcclxuICAgICAgICAgICAgICAgIGdldEZvcm1EaXJ0eVZhbHVlcyh0aGlzLmZvcm1Hcm91cCEpIGFzIGFueSxcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBhc3luYyBjcmVhdGVXb3JrZmxvd1NldHRpbmdzR3JvdXBlZEZpZWxkRmllbGRzKFxyXG4gICAgICAgIGZhY3Rvcnk6IENhbnZhc1dvcmtmbG93RmFjdG9yeTxXb3JrZmxvd1R5cGU+LFxyXG4gICAgKTogUHJvbWlzZTxJRmllbGRbXT4ge1xyXG4gICAgICAgIGNvbnN0IHsgZGF0YVByb3ZpZGVyIH0gPSB0aGlzLmNvbnRyb2xsZXI7XHJcbiAgICAgICAgaWYgKCFkYXRhUHJvdmlkZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwoXHJcbiAgICAgICAgICAgIGZhY3RvcnkuZ2V0UHJvcGVydGllc1dpdGhTY2hlbWEoKS5tYXAoKHByb3BlcnR5KSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5mb3JtRmllbGRTZXJ2aWNlLmdldEZpZWxkRnJvbVdvcmtmbG93UHJvcGVydHkoXHJcbiAgICAgICAgICAgICAgICAgICAgcHJvcGVydHksXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YVByb3ZpZGVyLFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRJZDogdGhpcy5ldmVudElkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB3b3JrZmxvd0lkOiB0aGlzLndvcmtmbG93SWQsXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1sZW5cclxuICAgIGFzeW5jIGNyZWF0ZVdvcmtmbG93U2V0dGluZ3NHcm91cEZpZWxkRGF0YTxUIGV4dGVuZHMgV29ya2Zsb3dUeXBlPihcclxuICAgICAgICBjb250cm9sbGVyRGF0YTogQ2FudmFzQ29udHJvbGxlckRhdGE8VD4sXHJcbiAgICApOiBQcm9taXNlPElBemF2aXN0YUdyb3VwZWRGaWVsZHNDb21wb25lbnREYXRhPiB7XHJcbiAgICAgICAgY29uc3QgeyBmYWN0b3J5IH0gPSBjb250cm9sbGVyRGF0YTtcclxuICAgICAgICB0aGlzLnByb3BlcnRpZXMgPSBmYWN0b3J5LmdldFByb3BlcnRpZXMoKTtcclxuICAgICAgICBjb25zdCBmaWVsZHMgPVxyXG4gICAgICAgICAgICBhd2FpdCB0aGlzLmNyZWF0ZVdvcmtmbG93U2V0dGluZ3NHcm91cGVkRmllbGRGaWVsZHMoZmFjdG9yeSk7XHJcbiAgICAgICAgdGhpcy5maWVsZHMgPSBmaWVsZHM7XHJcbiAgICAgICAgdGhpcy53b3JrZmxvd0l0ZW0gPSBmYWN0b3J5LmdldFdvcmtmbG93KCk7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgc2luZ2xlQ29sdW1uOiB0cnVlLFxyXG4gICAgICAgICAgICBlZGl0TW9kZUZvckFsbEZpZWxkczogdHJ1ZSxcclxuICAgICAgICAgICAgZGlzYWJsZUF1dG9PcmRlcmluZzogdHJ1ZSxcclxuICAgICAgICAgICAgZmllbGRzT3B0aW9uczogW1xyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkSWQ6ICdzYWQnLFxyXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnM6IHt9LFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgXSxcclxuICAgICAgICAgICAgZmllbGRzV2l0aEVudGl0eToge1xyXG4gICAgICAgICAgICAgICAgZW50aXR5OiBmYWN0b3J5LmdldFdvcmtmbG93KCkuc2V0dGluZ3MsXHJcbiAgICAgICAgICAgICAgICBmaWVsZHMsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGV4cGFuZFBhbmVsczogZmFsc2UsXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBhc3luYyB0b2dnbGVFeHBhbmRQYW5lbHMoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMud29ya2Zsb3dTZXR0aW5nc0dyb3VwZWRGaWVsZERhdGEpIHtcclxuICAgICAgICAgICAgdGhpcy53b3JrZmxvd1NldHRpbmdzR3JvdXBlZEZpZWxkRGF0YS5leHBhbmRQYW5lbHMgPVxyXG4gICAgICAgICAgICAgICAgIXRoaXMud29ya2Zsb3dTZXR0aW5nc0dyb3VwZWRGaWVsZERhdGEuZXhwYW5kUGFuZWxzO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVDYW52YXNHcm91cGVkRmllbGRzRGF0YTxUIGV4dGVuZHMgV29ya2Zsb3dUeXBlPihcclxuICAgICAgICBjb250cm9sbGVyRGF0YTogQ2FudmFzQ29udHJvbGxlckRhdGE8VD4sXHJcbiAgICApOiBJQXphdmlzdGFHcm91cGVkRmllbGRzQ29tcG9uZW50RGF0YSB7XHJcbiAgICAgICAgY29uc3Qge1xyXG4gICAgICAgICAgICBuYW1lLFxyXG4gICAgICAgICAgICBkZXNjcmlwdGlvbixcclxuICAgICAgICAgICAgZmFjdG9yeTogeyB0eXBlIH0sXHJcbiAgICAgICAgfSA9IGNvbnRyb2xsZXJEYXRhO1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGV4cGFuZFBhbmVsczogdHJ1ZSxcclxuICAgICAgICAgICAgZWRpdE1vZGVGb3JBbGxGaWVsZHM6IHRydWUsXHJcbiAgICAgICAgICAgIHNpbmdsZUNvbHVtbjogdHJ1ZSxcclxuICAgICAgICAgICAgZGlzYWJsZUF1dG9PcmRlcmluZzogdHJ1ZSxcclxuICAgICAgICAgICAgZmllbGRzV2l0aEVudGl0eToge1xyXG4gICAgICAgICAgICAgICAgZmllbGRzOiB0aGlzLmZvcm1GaWVsZFNlcnZpY2UuZ2V0Q2FudmFzRGF0YUZpZWxkcyh0eXBlKSxcclxuICAgICAgICAgICAgICAgIGVudGl0eToge1xyXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPz9cclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaGFyZWRTdmMudHJhbnNsYXRlKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgV09SS0ZMT1dfTkFNRV9UUkFOU0xBVElPTlNbdHlwZV0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICksXHJcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uID8/XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hhcmVkU3ZjLnRyYW5zbGF0ZShcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdPUktGTE9XX0VYUExBTkFUSU9OX1RSQU5TTEFUSU9OU1t0eXBlXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgKSxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBvblVwZGF0ZUNhbnZhc0ZpZWxkcyhkYXRhOiBQYXJ0aWFsPENhbnZhcz4pIHtcclxuICAgICAgICB0aGlzLmNhbnZhc0NoYW5nZXMuZW1pdChkYXRhKTtcclxuICAgICAgICBpZiAodGhpcy5jYW52YXNHcm91cEZpZWxkRGF0YT8uZmllbGRzV2l0aEVudGl0eS5lbnRpdHkpIHtcclxuICAgICAgICAgICAgdGhpcy5jYW52YXNHcm91cEZpZWxkRGF0YS5maWVsZHNXaXRoRW50aXR5LmVudGl0eSA9IHtcclxuICAgICAgICAgICAgICAgIC4uLnRoaXMuY2FudmFzR3JvdXBGaWVsZERhdGE/LmZpZWxkc1dpdGhFbnRpdHkuZW50aXR5LFxyXG4gICAgICAgICAgICAgICAgLi4uZGF0YSxcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb25VcGRhdGVXb3JrZmxvd1NldHRpbmdzRmllbGRzKGRhdGE6IElWYWx1ZUNoYW5nZXNXaXRoT2JqZWN0KSB7XHJcbiAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICB0aGlzLndvcmtmbG93U2V0dGluZ3NHcm91cGVkRmllbGRFbD8uaW52YWxpZEZpZWxkc1dpdGhWYWx1ZXNcclxuICAgICAgICAgICAgICAgID8ubGVuZ3RoID4gMCB8fFxyXG4gICAgICAgICAgICBkYXRhLm9iaiA9PSBudWxsIHx8XHJcbiAgICAgICAgICAgIG9iamVjdEtleXMoZGF0YS5vYmopLmxlbmd0aCA9PT0gMFxyXG4gICAgICAgICkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFdlIGhhY2sgdGhlIHdheSB0byBkaXNwbGF5IHRoZSBwcm9jZXNzIGJ1dHRvbiBieSBjcmVhdGluZyBhIGNoZWNrYm94IGFzIGEgYnV0dG9uLlxyXG4gICAgICAgICAqIFRoZXJlZm9yZSwgd2UgaW50ZXJjZXB0IHRoZSBjaGFuZ2VzIGZyb20gdGhlIHByb2Nlc3MtZmllbGQgYW5kIHVzZSB0aGUgY2hlY2tib3ggdG8gb3BlbiBhIHBvcHVwXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgY29uc3Qgd29ya2Zsb3dQcm9jZXNzUHJvcGVydGllcyA9XHJcbiAgICAgICAgICAgIHRoaXMuY29udHJvbGxlckRhdGE/LmZhY3RvcnlcclxuICAgICAgICAgICAgICAgIC5nZXRQcm9wZXJ0aWVzKClcclxuICAgICAgICAgICAgICAgIC5maWx0ZXIoKHsgdHlwZSB9KSA9PiB0eXBlID09PSAncHJvY2VzcycpID8/IFtdO1xyXG4gICAgICAgIGNvbnN0IGlzUHJvY2Vzc0ZpZWxkID0gd29ya2Zsb3dQcm9jZXNzUHJvcGVydGllcy5zb21lKFxyXG4gICAgICAgICAgICAoeyBhdHRyaWJ1dGUgfSkgPT5cclxuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZSA9PT0gZGF0YS5jaGFuZ2VkRmllbGRXaXRoVmFsdWU/LmZpZWxkLmlkLFxyXG4gICAgICAgICk7XHJcbiAgICAgICAgaWYgKGlzUHJvY2Vzc0ZpZWxkKSB7XHJcbiAgICAgICAgICAgIHRoaXMub3BlblByb2Nlc3NQb3B1cCgpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMud29ya2Zsb3dTZXR0aW5nc0NoYW5nZXMuZW1pdCh7XHJcbiAgICAgICAgICAgIC4uLmRhdGEsXHJcbiAgICAgICAgICAgIG9iajogZGF0YS5vYmpcclxuICAgICAgICAgICAgICAgID8gb21pdChcclxuICAgICAgICAgICAgICAgICAgICAgIGRhdGEub2JqLFxyXG4gICAgICAgICAgICAgICAgICAgICAgd29ya2Zsb3dQcm9jZXNzUHJvcGVydGllcy5tYXAoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgKHsgYXR0cmlidXRlIH0pID0+IGF0dHJpYnV0ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICksXHJcbiAgICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICAgIDogZGF0YS5vYmosXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgbG9hZEZpZWxkc0Nzc0NsYXNzKCkge1xyXG4gICAgICAgIHRoaXMuY29udHJvbGxlckRhdGE/LmZhY3RvcnkuZ2V0UHJvcGVydGllcygpLmZvckVhY2goKHByb3BlcnRpZXMpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgeyBhdHRyaWJ1dGUsIGRhdGFzb3VyY2UgfSA9IHByb3BlcnRpZXM7XHJcbiAgICAgICAgICAgIGlmIChkYXRhc291cmNlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmhvc3QubmF0aXZlRWxlbWVudFxyXG4gICAgICAgICAgICAgICAgICAgIC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBgYXphdmlzdGEtaW5wdXQtZmllbGRbZmllbGQtaWQ9JHthdHRyaWJ1dGV9XWAsXHJcbiAgICAgICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgICAgID8uY2xhc3NMaXN0LmFkZChgZGF0YXNvdXJjZS0ke2RhdGFzb3VyY2V9YCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBvcGVuUHJvY2Vzc1BvcHVwKCkge1xyXG4gICAgICAgIGFsZXJ0KCdPcGVuaW5nIFByb2Nlc3MgUG9wdXAnKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldE5vZGVJbnN0YW5jZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5kaWFncmFtRWwubm9kZXMuZmluZCgoeyBpZCB9KSA9PiBpZCA9PT0gdGhpcy5ub2RlLmlkKTtcclxuICAgIH1cclxufVxyXG4iLCI8ZGl2XHJcbiAgY2xhc3M9XCJ3b3JrZmxvdy1idWlsZGVyLW5vZGUtaXRlbVwiXHJcbiAgKm5nSWY9XCJ3b3JrZmxvd1NldHRpbmdzR3JvdXBlZEZpZWxkRGF0YSAmJiBjYW52YXNHcm91cEZpZWxkRGF0YVwiXHJcbj5cclxuICA8YXphdmlzdGEtd29ya2Zsb3ctYnVpbGRlci1ub2RlLWZvcm0taGVhZGVyXHJcbiAgICAjZm9ybUhlYWRlclxyXG4gICAgW2NvbnRyb2xsZXJEYXRhXT1cImNvbnRyb2xsZXJEYXRhXCJcclxuICAgIChjYW52YXNDaGFuZ2VzKT1cIm9uVXBkYXRlQ2FudmFzRmllbGRzKCRldmVudClcIlxyXG4gID48L2F6YXZpc3RhLXdvcmtmbG93LWJ1aWxkZXItbm9kZS1mb3JtLWhlYWRlcj5cclxuXHJcbiAgPGRpdiBjbGFzcz1cIndvcmtmbG93LWJ1aWxkZXItbm9kZS1pdGVtX19maWVsZHNcIj5cclxuICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJ3b3JrZmxvd1NldHRpbmdzR3JvdXBlZEZpZWxkRGF0YS5leHBhbmRQYW5lbHNcIj5cclxuICAgICAgPG5nLWNvbnRhaW5lclxyXG4gICAgICAgICpuZ0Zvcj1cImxldCBwcm9wZXJ0eSBvZiBwcm9wZXJ0aWVzOyB0cmFja0J5OiB0cmFja0J5V29ya2Zsb3dQcm9wZXJ0eVwiXHJcbiAgICAgID5cclxuICAgICAgICA8bmctY29udGFpbmVyXHJcbiAgICAgICAgICAqbmdJZj1cImZvcm1Hcm91cD8uY29udHJvbHM/Lltwcm9wZXJ0eS5hdHRyaWJ1dGVdIGFzIGZvcm1Db250cm9sXCJcclxuICAgICAgICA+XHJcbiAgICAgICAgICA8YXphdmlzdGEtd29ya2Zsb3ctYnVpbGRlci1ub2RlLWZvcm0tZmllbGQtc2VsZWN0XHJcbiAgICAgICAgICAgICpuZ0lmPVwiXHJcbiAgICAgICAgICAgICAgcHJvcGVydHkudHlwZSA9PT0gJ3NlbGVjdCcgfHwgcHJvcGVydHkudHlwZSA9PT0gJ211bHRpc2VsZWN0J1xyXG4gICAgICAgICAgICBcIlxyXG4gICAgICAgICAgICBbZXZlbnRJZF09XCJldmVudElkXCJcclxuICAgICAgICAgICAgW3dvcmtmbG93SWRdPVwid29ya2Zsb3dJZFwiXHJcbiAgICAgICAgICAgIFtwcm9wZXJ0eV09XCJwcm9wZXJ0eVwiXHJcbiAgICAgICAgICAgIFtjb250cm9sXT1cIiRhbnkoZm9ybUNvbnRyb2wpXCJcclxuICAgICAgICAgID5cclxuICAgICAgICAgIDwvYXphdmlzdGEtd29ya2Zsb3ctYnVpbGRlci1ub2RlLWZvcm0tZmllbGQtc2VsZWN0PlxyXG4gICAgICAgICAgPGF6YXZpc3RhLXdvcmtmbG93LWJ1aWxkZXItbm9kZS1mb3JtLWZpZWxkLXRleHRcclxuICAgICAgICAgICAgKm5nSWY9XCJwcm9wZXJ0eS50eXBlID09PSAndGV4dCcgfHwgcHJvcGVydHkudHlwZSA9PT0gJ251bWJlcidcIlxyXG4gICAgICAgICAgICBbZXZlbnRJZF09XCJldmVudElkXCJcclxuICAgICAgICAgICAgW3dvcmtmbG93SWRdPVwid29ya2Zsb3dJZFwiXHJcbiAgICAgICAgICAgIFtwcm9wZXJ0eV09XCIkYW55KHByb3BlcnR5KVwiXHJcbiAgICAgICAgICAgIFtjb250cm9sXT1cIiRhbnkoZm9ybUNvbnRyb2wpXCJcclxuICAgICAgICAgID5cclxuICAgICAgICAgIDwvYXphdmlzdGEtd29ya2Zsb3ctYnVpbGRlci1ub2RlLWZvcm0tZmllbGQtdGV4dD5cclxuICAgICAgICAgIDxhemF2aXN0YS13b3JrZmxvdy1idWlsZGVyLW5vZGUtZm9ybS1maWVsZC10b2dnbGVcclxuICAgICAgICAgICAgKm5nSWY9XCJwcm9wZXJ0eS50eXBlID09PSAnYm9vbGVhbidcIlxyXG4gICAgICAgICAgICBbZXZlbnRJZF09XCJldmVudElkXCJcclxuICAgICAgICAgICAgW3dvcmtmbG93SWRdPVwid29ya2Zsb3dJZFwiXHJcbiAgICAgICAgICAgIFtwcm9wZXJ0eV09XCIkYW55KHByb3BlcnR5KVwiXHJcbiAgICAgICAgICAgIFtjb250cm9sXT1cIiRhbnkoZm9ybUNvbnRyb2wpXCJcclxuICAgICAgICAgID5cclxuICAgICAgICAgIDwvYXphdmlzdGEtd29ya2Zsb3ctYnVpbGRlci1ub2RlLWZvcm0tZmllbGQtdG9nZ2xlPlxyXG4gICAgICAgICAgPGF6YXZpc3RhLXdvcmtmbG93LWJ1aWxkZXItbm9kZS1mb3JtLWZpZWxkLXByb2Nlc3NcclxuICAgICAgICAgICAgKm5nSWY9XCJwcm9wZXJ0eS50eXBlID09PSAncHJvY2VzcydcIlxyXG4gICAgICAgICAgICBbZXZlbnRJZF09XCJldmVudElkXCJcclxuICAgICAgICAgICAgW3dvcmtmbG93SWRdPVwid29ya2Zsb3dJZFwiXHJcbiAgICAgICAgICAgIFtwcm9wZXJ0eV09XCIkYW55KHByb3BlcnR5KVwiXHJcbiAgICAgICAgICAgIFtjb250cm9sXT1cIiRhbnkoZm9ybUNvbnRyb2wpXCJcclxuICAgICAgICAgID5cclxuICAgICAgICAgIDwvYXphdmlzdGEtd29ya2Zsb3ctYnVpbGRlci1ub2RlLWZvcm0tZmllbGQtcHJvY2Vzcz5cclxuICAgICAgICA8L25nLWNvbnRhaW5lcj5cclxuICAgICAgPC9uZy1jb250YWluZXI+XHJcbiAgICA8L25nLWNvbnRhaW5lcj5cclxuICA8L2Rpdj5cclxuICA8ZGl2XHJcbiAgICBjbGFzcz1cIndvcmtmbG93LWJ1aWxkZXItbm9kZS1pdGVtX19mb290ZXJcIlxyXG4gICAgKm5nSWY9XCJ3b3JrZmxvd1NldHRpbmdzR3JvdXBlZEZpZWxkRGF0YS5maWVsZHNXaXRoRW50aXR5LmZpZWxkcy5sZW5ndGggPiAwXCJcclxuICA+XHJcbiAgICA8YXphdmlzdGEtYnV0dG9uIChjbGljayk9XCJ0b2dnbGVFeHBhbmRQYW5lbHMoKVwiIGNvbG9yPVwicHJpbWFyeVwiPnt7XHJcbiAgICAgICh3b3JrZmxvd1NldHRpbmdzR3JvdXBlZEZpZWxkRGF0YS5leHBhbmRQYW5lbHNcclxuICAgICAgICA/IFwiQ0xPU0VcIlxyXG4gICAgICAgIDogaXNXb3JrZmxvd1ZhbGlkXHJcbiAgICAgICAgICA/IFwiT1BFTlwiXHJcbiAgICAgICAgICA6IFwiU0VUVVBcIlxyXG4gICAgICApIHwgdHJhbnNsYXRlXHJcbiAgICB9fTwvYXphdmlzdGEtYnV0dG9uPlxyXG4gIDwvZGl2PlxyXG4gIDxkaXZcclxuICAgIGNsYXNzPVwid29ya2Zsb3ctYnVpbGRlci1ub2RlLWl0ZW1fX2Fic29sdXRlLWVsZW1lbnRzXCI+XHJcbiAgICA8YnV0dG9uICpuZ0lmPVwiIWZvcm1IZWFkZXIuZWRpdE1vZGVcIiBjbGFzcz1cIndvcmtmbG93LWJ1aWxkZXItbm9kZS1pdGVtX19hYnNvbHV0ZS1lbGVtZW50c19fYnV0dG9uLWRlbGV0ZVwiIG1hdC1pY29uLWJ1dHRvbiAoY2xpY2spPVwicmVtb3ZlTm9kZS5lbWl0KClcIj5cclxuICAgICAgPG1hdC1pY29uPmNsb3NlPC9tYXQtaWNvbj5cclxuICAgIDwvYnV0dG9uPlxyXG4gIDwvZGl2PlxyXG48L2Rpdj5cclxuXHJcbiJdfQ==