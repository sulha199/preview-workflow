import { Component, Input } from '@angular/core';
import { firstValueFrom } from 'rxjs';
import { FormArray } from '@angular/forms';
import { WorkflowBuilderNodeFormFieldBaseComponent } from '../workflow-builder-node-form-field-text/workflow-builder-node-form-field-text.component';
import { WorkflowBuilderProcessBuilderDialogComponent, } from '../workflow-builder-process-builder-dialog/workflow-builder-process-builder-dialog.component';
import { createFormGroupFromData } from '../../utils';
import * as i0 from "@angular/core";
import * as i1 from "@angular/material/dialog";
import * as i2 from "../../workflow-builder.controller";
import * as i3 from "@angular/common";
import * as i4 from "@angular/material/button";
import * as i5 from "@angular/material/icon";
import * as i6 from "@ngx-translate/core";
// eslint-disable-next-line max-len
export class WorkflowBuilderNodeFormFieldProcessComponent extends WorkflowBuilderNodeFormFieldBaseComponent {
    constructor(dialog, controller) {
        super();
        this.dialog = dialog;
        this.controller = controller;
    }
    async openSteps() {
        const fullProcess = {
            name: '',
            steps: this.control && Array.isArray(this.control?.value)
                ? this.control.value
                : [],
            // TODO: define trigger
            trigger: undefined,
            stage_submit: '',
            paused: false,
        };
        const dialogData = {
            eventId: this.eventId,
            processType: "participant" /* ProcessType.participant */,
            showOnlyFlowBuilder: true,
            fullProcess,
            getAclObjectForCurrentUser: () => ({
                allowed: true,
                availableScopes: [],
                requiredScopes: [],
            }),
        };
        const results = await firstValueFrom(this.dialog
            .open(WorkflowBuilderProcessBuilderDialogComponent, {
            data: dialogData,
            width: `800px`,
        })
            .afterClosed());
        if (results && this.control && this.control instanceof FormArray) {
            const controlArray = this.control;
            controlArray.controls.forEach(() => {
                controlArray.removeAt(-1);
            });
            results.forEach((step) => controlArray.push(createFormGroupFromData(step)));
            // controlArray.insert(new FormGroup<FormGroupType<Step>({
            // }))
            if (this.workflowId && this.property) {
                this.controller.updateWorkflowProcess(this.workflowId, this.property?.attribute, results);
            }
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.10", ngImport: i0, type: WorkflowBuilderNodeFormFieldProcessComponent, deps: [{ token: i1.MatDialog }, { token: i2.AzavistaWorkflowBuilderController }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.2.10", type: WorkflowBuilderNodeFormFieldProcessComponent, selector: "azavista-workflow-builder-node-form-field-process", inputs: { property: "property" }, usesInheritance: true, ngImport: i0, template: "<ng-container *ngIf=\"property\">\r\n  <button\r\n    mat-flat-button\r\n    (click)=\"openSteps()\"\r\n    [class.has-steps]=\"control?.value?.length\"\r\n  >\r\n    <mat-icon *ngIf=\"!control?.value?.length\">add</mat-icon>\r\n    <mat-icon *ngIf=\"control?.value?.length\">settings</mat-icon>\r\n    {{ property.label | translate }}\r\n  </button>\r\n</ng-container>\r\n", styles: [":host{display:block}button{width:100%;border:2px dashed #C2D8F8;border-radius:4px;padding-left:1em;padding-right:1em}button:hover{background-color:#eee;border-width:3px;padding-left:calc(1em - 1px);padding-right:calc(1em - 1px)}button:hover ::ng-deep .mat-mdc-button-persistent-ripple:before,button:hover .mat-mdc-unelevated-button:hover .mat-mdc-button-persistent-ripple:before{opacity:0}button.has-steps{background-color:#e4ffd7}button.has-steps mat-icon{order:2;margin:0}button.has-steps ::ng-deep .mdc-button__label{flex:1;text-align:left}\n"], dependencies: [{ kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i4.MatButton, selector: "    button[mat-button], button[mat-raised-button], button[mat-flat-button],    button[mat-stroked-button]  ", inputs: ["disabled", "disableRipple", "color"], exportAs: ["matButton"] }, { kind: "component", type: i5.MatIcon, selector: "mat-icon", inputs: ["color", "inline", "svgIcon", "fontSet", "fontIcon"], exportAs: ["matIcon"] }, { kind: "pipe", type: i6.TranslatePipe, name: "translate" }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.10", ngImport: i0, type: WorkflowBuilderNodeFormFieldProcessComponent, decorators: [{
            type: Component,
            args: [{ selector: 'azavista-workflow-builder-node-form-field-process', template: "<ng-container *ngIf=\"property\">\r\n  <button\r\n    mat-flat-button\r\n    (click)=\"openSteps()\"\r\n    [class.has-steps]=\"control?.value?.length\"\r\n  >\r\n    <mat-icon *ngIf=\"!control?.value?.length\">add</mat-icon>\r\n    <mat-icon *ngIf=\"control?.value?.length\">settings</mat-icon>\r\n    {{ property.label | translate }}\r\n  </button>\r\n</ng-container>\r\n", styles: [":host{display:block}button{width:100%;border:2px dashed #C2D8F8;border-radius:4px;padding-left:1em;padding-right:1em}button:hover{background-color:#eee;border-width:3px;padding-left:calc(1em - 1px);padding-right:calc(1em - 1px)}button:hover ::ng-deep .mat-mdc-button-persistent-ripple:before,button:hover .mat-mdc-unelevated-button:hover .mat-mdc-button-persistent-ripple:before{opacity:0}button.has-steps{background-color:#e4ffd7}button.has-steps mat-icon{order:2;margin:0}button.has-steps ::ng-deep .mdc-button__label{flex:1;text-align:left}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.MatDialog }, { type: i2.AzavistaWorkflowBuilderController }]; }, propDecorators: { property: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid29ya2Zsb3ctYnVpbGRlci1ub2RlLWZvcm0tZmllbGQtcHJvY2Vzcy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9hemF2aXN0YS93b3JrZmxvdy1idWlsZGVyL3NyYy9saWIvY29tcG9uZW50cy93b3JrZmxvdy1idWlsZGVyLW5vZGUtZm9ybS1maWVsZC1wcm9jZXNzL3dvcmtmbG93LWJ1aWxkZXItbm9kZS1mb3JtLWZpZWxkLXByb2Nlc3MuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvYXphdmlzdGEvd29ya2Zsb3ctYnVpbGRlci9zcmMvbGliL2NvbXBvbmVudHMvd29ya2Zsb3ctYnVpbGRlci1ub2RlLWZvcm0tZmllbGQtcHJvY2Vzcy93b3JrZmxvdy1idWlsZGVyLW5vZGUtZm9ybS1maWVsZC1wcm9jZXNzLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBSWpELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDdEMsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzNDLE9BQU8sRUFBRSx5Q0FBeUMsRUFBRSxNQUFNLDBGQUEwRixDQUFDO0FBQ3JKLE9BQU8sRUFDSCw0Q0FBNEMsR0FFL0MsTUFBTSw4RkFBOEYsQ0FBQztBQUV0RyxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSxhQUFhLENBQUM7Ozs7Ozs7O0FBUXRELG1DQUFtQztBQUNuQyxNQUFNLE9BQU8sNENBQTZDLFNBQVEseUNBRWpFO0lBR0csWUFDWSxNQUFpQixFQUNqQixVQUE2QztRQUVyRCxLQUFLLEVBQUUsQ0FBQztRQUhBLFdBQU0sR0FBTixNQUFNLENBQVc7UUFDakIsZUFBVSxHQUFWLFVBQVUsQ0FBbUM7SUFHekQsQ0FBQztJQUVELEtBQUssQ0FBQyxTQUFTO1FBQ1gsTUFBTSxXQUFXLEdBQWlCO1lBQzlCLElBQUksRUFBRSxFQUFFO1lBQ1IsS0FBSyxFQUNELElBQUksQ0FBQyxPQUFPLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQztnQkFDOUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSztnQkFDcEIsQ0FBQyxDQUFDLEVBQUU7WUFDWix1QkFBdUI7WUFDdkIsT0FBTyxFQUFFLFNBQWdCO1lBQ3pCLFlBQVksRUFBRSxFQUFFO1lBQ2hCLE1BQU0sRUFBRSxLQUFLO1NBQ2hCLENBQUM7UUFFRixNQUFNLFVBQVUsR0FBNEM7WUFDeEQsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPO1lBQ3JCLFdBQVcsNkNBQXlCO1lBQ3BDLG1CQUFtQixFQUFFLElBQUk7WUFDekIsV0FBVztZQUNYLDBCQUEwQixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7Z0JBQy9CLE9BQU8sRUFBRSxJQUFJO2dCQUNiLGVBQWUsRUFBRSxFQUFFO2dCQUNuQixjQUFjLEVBQUUsRUFBRTthQUNyQixDQUFDO1NBQ0wsQ0FBQztRQUNGLE1BQU0sT0FBTyxHQUF1QixNQUFNLGNBQWMsQ0FDcEQsSUFBSSxDQUFDLE1BQU07YUFDTixJQUFJLENBQUMsNENBQTRDLEVBQUU7WUFDaEQsSUFBSSxFQUFFLFVBQVU7WUFDaEIsS0FBSyxFQUFFLE9BQU87U0FDakIsQ0FBQzthQUNELFdBQVcsRUFBRSxDQUNyQixDQUFDO1FBRUYsSUFBSSxPQUFPLElBQUksSUFBSSxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsT0FBTyxZQUFZLFNBQVMsRUFBRTtZQUM5RCxNQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsT0FBb0IsQ0FBQztZQUMvQyxZQUFZLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUU7Z0JBQy9CLFlBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM5QixDQUFDLENBQUMsQ0FBQztZQUVILE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUNyQixZQUFZLENBQUMsSUFBSSxDQUFDLHVCQUF1QixDQUFDLElBQUksQ0FBQyxDQUFDLENBQ25ELENBQUM7WUFFRiwwREFBMEQ7WUFFMUQsTUFBTTtZQUNOLElBQUksSUFBSSxDQUFDLFVBQVUsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO2dCQUNsQyxJQUFJLENBQUMsVUFBVSxDQUFDLHFCQUFxQixDQUNqQyxJQUFJLENBQUMsVUFBVSxFQUNmLElBQUksQ0FBQyxRQUFRLEVBQUUsU0FBUyxFQUN4QixPQUFPLENBQ1YsQ0FBQzthQUNMO1NBQ0o7SUFDTCxDQUFDOytHQWxFUSw0Q0FBNEM7bUdBQTVDLDRDQUE0QyxrSkNyQnpELHVYQVdBOzs0RkRVYSw0Q0FBNEM7a0JBTnhELFNBQVM7K0JBQ0ksbURBQW1EO2dKQVEzQyxRQUFRO3NCQUF6QixLQUFLIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTWF0RGlhbG9nIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvZGlhbG9nJztcbmltcG9ydCB7IElQcm9jZXNzRnVsbCwgU3RlcCB9IGZyb20gJ0BhemF2aXN0YS9zZXJ2aWNlbGliJztcbmltcG9ydCB7IFdvcmtmbG93UHJvcGVydHkgfSBmcm9tICdAYXphdmlzdGEvd29ya2Zsb3ctYnVpbGRlci1zaGFyZWQnO1xuaW1wb3J0IHsgZmlyc3RWYWx1ZUZyb20gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IEZvcm1BcnJheSB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IFdvcmtmbG93QnVpbGRlck5vZGVGb3JtRmllbGRCYXNlQ29tcG9uZW50IH0gZnJvbSAnLi4vd29ya2Zsb3ctYnVpbGRlci1ub2RlLWZvcm0tZmllbGQtdGV4dC93b3JrZmxvdy1idWlsZGVyLW5vZGUtZm9ybS1maWVsZC10ZXh0LmNvbXBvbmVudCc7XG5pbXBvcnQge1xuICAgIFdvcmtmbG93QnVpbGRlclByb2Nlc3NCdWlsZGVyRGlhbG9nQ29tcG9uZW50LFxuICAgIFdvcmtmbG93QnVpbGRlclByb2Nlc3NCdWlsZGVyRGlhbG9nRGF0YSxcbn0gZnJvbSAnLi4vd29ya2Zsb3ctYnVpbGRlci1wcm9jZXNzLWJ1aWxkZXItZGlhbG9nL3dvcmtmbG93LWJ1aWxkZXItcHJvY2Vzcy1idWlsZGVyLWRpYWxvZy5jb21wb25lbnQnO1xuaW1wb3J0IHsgUHJvY2Vzc1R5cGUgfSBmcm9tICcuLi8uLi90eXBlcyc7XG5pbXBvcnQgeyBjcmVhdGVGb3JtR3JvdXBGcm9tRGF0YSB9IGZyb20gJy4uLy4uL3V0aWxzJztcbmltcG9ydCB7IEF6YXZpc3RhV29ya2Zsb3dCdWlsZGVyQ29udHJvbGxlciB9IGZyb20gJy4uLy4uL3dvcmtmbG93LWJ1aWxkZXIuY29udHJvbGxlcic7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnYXphdmlzdGEtd29ya2Zsb3ctYnVpbGRlci1ub2RlLWZvcm0tZmllbGQtcHJvY2VzcycsXG4gICAgdGVtcGxhdGVVcmw6IGAuL3dvcmtmbG93LWJ1aWxkZXItbm9kZS1mb3JtLWZpZWxkLXByb2Nlc3MuY29tcG9uZW50Lmh0bWxgLFxuICAgIHN0eWxlVXJsczogWycuL3dvcmtmbG93LWJ1aWxkZXItbm9kZS1mb3JtLWZpZWxkLXByb2Nlc3MuY29tcG9uZW50LnNjc3MnXSxcbn0pXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LWxlblxuZXhwb3J0IGNsYXNzIFdvcmtmbG93QnVpbGRlck5vZGVGb3JtRmllbGRQcm9jZXNzQ29tcG9uZW50IGV4dGVuZHMgV29ya2Zsb3dCdWlsZGVyTm9kZUZvcm1GaWVsZEJhc2VDb21wb25lbnQ8XG4gICAgU3RlcFtdXG4+IHtcbiAgICBASW5wdXQoKSBvdmVycmlkZSBwcm9wZXJ0eT86IFdvcmtmbG93UHJvcGVydHkgJiB7IHR5cGU6ICdwcm9jZXNzJyB9O1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgZGlhbG9nOiBNYXREaWFsb2csXG4gICAgICAgIHByaXZhdGUgY29udHJvbGxlcjogQXphdmlzdGFXb3JrZmxvd0J1aWxkZXJDb250cm9sbGVyLFxuICAgICkge1xuICAgICAgICBzdXBlcigpO1xuICAgIH1cblxuICAgIGFzeW5jIG9wZW5TdGVwcygpIHtcbiAgICAgICAgY29uc3QgZnVsbFByb2Nlc3M6IElQcm9jZXNzRnVsbCA9IHtcbiAgICAgICAgICAgIG5hbWU6ICcnLFxuICAgICAgICAgICAgc3RlcHM6XG4gICAgICAgICAgICAgICAgdGhpcy5jb250cm9sICYmIEFycmF5LmlzQXJyYXkodGhpcy5jb250cm9sPy52YWx1ZSlcbiAgICAgICAgICAgICAgICAgICAgPyB0aGlzLmNvbnRyb2wudmFsdWVcbiAgICAgICAgICAgICAgICAgICAgOiBbXSxcbiAgICAgICAgICAgIC8vIFRPRE86IGRlZmluZSB0cmlnZ2VyXG4gICAgICAgICAgICB0cmlnZ2VyOiB1bmRlZmluZWQgYXMgYW55LFxuICAgICAgICAgICAgc3RhZ2Vfc3VibWl0OiAnJyxcbiAgICAgICAgICAgIHBhdXNlZDogZmFsc2UsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgZGlhbG9nRGF0YTogV29ya2Zsb3dCdWlsZGVyUHJvY2Vzc0J1aWxkZXJEaWFsb2dEYXRhID0ge1xuICAgICAgICAgICAgZXZlbnRJZDogdGhpcy5ldmVudElkLFxuICAgICAgICAgICAgcHJvY2Vzc1R5cGU6IFByb2Nlc3NUeXBlLnBhcnRpY2lwYW50LFxuICAgICAgICAgICAgc2hvd09ubHlGbG93QnVpbGRlcjogdHJ1ZSxcbiAgICAgICAgICAgIGZ1bGxQcm9jZXNzLFxuICAgICAgICAgICAgZ2V0QWNsT2JqZWN0Rm9yQ3VycmVudFVzZXI6ICgpID0+ICh7XG4gICAgICAgICAgICAgICAgYWxsb3dlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBhdmFpbGFibGVTY29wZXM6IFtdLFxuICAgICAgICAgICAgICAgIHJlcXVpcmVkU2NvcGVzOiBbXSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCByZXN1bHRzOiBTdGVwW10gfCB1bmRlZmluZWQgPSBhd2FpdCBmaXJzdFZhbHVlRnJvbShcbiAgICAgICAgICAgIHRoaXMuZGlhbG9nXG4gICAgICAgICAgICAgICAgLm9wZW4oV29ya2Zsb3dCdWlsZGVyUHJvY2Vzc0J1aWxkZXJEaWFsb2dDb21wb25lbnQsIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogZGlhbG9nRGF0YSxcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGA4MDBweGAsXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuYWZ0ZXJDbG9zZWQoKSxcbiAgICAgICAgKTtcblxuICAgICAgICBpZiAocmVzdWx0cyAmJiB0aGlzLmNvbnRyb2wgJiYgdGhpcy5jb250cm9sIGluc3RhbmNlb2YgRm9ybUFycmF5KSB7XG4gICAgICAgICAgICBjb25zdCBjb250cm9sQXJyYXkgPSB0aGlzLmNvbnRyb2wgYXMgRm9ybUFycmF5O1xuICAgICAgICAgICAgY29udHJvbEFycmF5LmNvbnRyb2xzLmZvckVhY2goKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xBcnJheS5yZW1vdmVBdCgtMSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmVzdWx0cy5mb3JFYWNoKChzdGVwKSA9PlxuICAgICAgICAgICAgICAgIGNvbnRyb2xBcnJheS5wdXNoKGNyZWF0ZUZvcm1Hcm91cEZyb21EYXRhKHN0ZXApKSxcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIC8vIGNvbnRyb2xBcnJheS5pbnNlcnQobmV3IEZvcm1Hcm91cDxGb3JtR3JvdXBUeXBlPFN0ZXA+KHtcblxuICAgICAgICAgICAgLy8gfSkpXG4gICAgICAgICAgICBpZiAodGhpcy53b3JrZmxvd0lkICYmIHRoaXMucHJvcGVydHkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xsZXIudXBkYXRlV29ya2Zsb3dQcm9jZXNzKFxuICAgICAgICAgICAgICAgICAgICB0aGlzLndvcmtmbG93SWQsXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvcGVydHk/LmF0dHJpYnV0ZSxcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0cyxcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuIiwiPG5nLWNvbnRhaW5lciAqbmdJZj1cInByb3BlcnR5XCI+XHJcbiAgPGJ1dHRvblxyXG4gICAgbWF0LWZsYXQtYnV0dG9uXHJcbiAgICAoY2xpY2spPVwib3BlblN0ZXBzKClcIlxyXG4gICAgW2NsYXNzLmhhcy1zdGVwc109XCJjb250cm9sPy52YWx1ZT8ubGVuZ3RoXCJcclxuICA+XHJcbiAgICA8bWF0LWljb24gKm5nSWY9XCIhY29udHJvbD8udmFsdWU/Lmxlbmd0aFwiPmFkZDwvbWF0LWljb24+XHJcbiAgICA8bWF0LWljb24gKm5nSWY9XCJjb250cm9sPy52YWx1ZT8ubGVuZ3RoXCI+c2V0dGluZ3M8L21hdC1pY29uPlxyXG4gICAge3sgcHJvcGVydHkubGFiZWwgfCB0cmFuc2xhdGUgfX1cclxuICA8L2J1dHRvbj5cclxuPC9uZy1jb250YWluZXI+XHJcbiJdfQ==