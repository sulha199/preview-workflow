/* eslint-disable @typescript-eslint/ban-ts-comment */
import { ChangeDetectionStrategy, Component, Input, ViewChild, ViewChildren, } from '@angular/core';
import { Connector, ConnectorConstraints, DiagramConstraints, DiagramTools, Node, NodeConstraints, SnapConstraints, } from '@syncfusion/ej2-angular-diagrams';
import { ngResizeObserverProviders, } from 'ng-resize-observer';
import { debounceTime, startWith } from 'rxjs';
import { DEFAULT_CONNECTOR, DEFAULT_ERROR_STROKE_COLOR, DEFAULT_STROKE_COLOR, DEFAULT_STROKE_WIDTH, OUTPUT_PIN_PAIR, PREFIX_NODE, PREFIX_PORT, WORKFLOW_EXPLANATION_TRANSLATIONS, WORKFLOW_NAME_TRANSLATIONS, } from './types';
import { delay, getConnectorAnnotation, getMapByValue, getNodeAndConnectorsFromCanvasControllerData, getNodeFromCanvasControllerData, getOutputPinFromConnector, getWorkflowIdFromNodeId, workflowTypeArray, } from './utils';
import { WorkflowBuilderNodeFormComponent } from './components/workflow-builder-node-form/workflow-builder-node-form.component';
import * as i0 from "@angular/core";
import * as i1 from "./services/workflow-builder.service";
import * as i2 from "./workflow-builder.controller";
import * as i3 from "ng-resize-observer";
import * as i4 from "@azavista/components/shared";
import * as i5 from "@angular/common";
import * as i6 from "@angular/material/select";
import * as i7 from "@angular/material/core";
import * as i8 from "@angular/material/tabs";
import * as i9 from "@syncfusion/ej2-angular-diagrams";
import * as i10 from "@azavista/components/button";
import * as i11 from "./components/workflow-builder-palette/workflow-builder-palette.component";
import * as i12 from "./components/workflow-builder-node-form/workflow-builder-node-form.component";
import * as i13 from "@ngx-translate/core";
import * as i14 from "./pipes/apply-function.pipe";
export const ZOOM_FACTOR_OPTIONS = [
    0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1,
];
export class WorkflowBuilderComponent {
    constructor(builderSvc, controller, host, resize$, sharedSvc) {
        this.builderSvc = builderSvc;
        this.controller = controller;
        this.host = host;
        this.resize$ = resize$;
        this.sharedSvc = sharedSvc;
        /** Fill this to use custom dataProvider */
        this.dataProvider = this.builderSvc.dataProvider;
        this.debugMode = false;
        this.diagramConfig = {
            constraints: DiagramConstraints.Default,
            snapSettings: {
                constraints: SnapConstraints.SnapToObject,
            },
            getConnectorDefaults: () => DEFAULT_CONNECTOR,
            drawingObject: { ...DEFAULT_CONNECTOR },
        };
        this.tool = DiagramTools.SingleSelect | DiagramTools.ZoomPan;
        this.paletteConfig = {
            palettes: [],
            getSymbolInfo: () => { },
        };
        this.isInitialized = false;
        this.zoomOptions = ZOOM_FACTOR_OPTIONS;
        this.currentZoomFactor = 1;
        this.hasNodeSelectedAndExpanded = (selectedNodes) => {
            const selectedNodeMap = getMapByValue(selectedNodes, 'id');
            return !!this.nodeForms?.some((node) => !!selectedNodeMap[node.node.id] &&
                (!!node.formHeader?.editMode ||
                    !!node.workflowSettingsGroupedFieldData?.expandPanels));
        };
        this.areWorkflowsValid = (validityMap) => {
            return Object.values(validityMap).every((isValid) => isValid);
        };
    }
    async ngOnInit() {
        this.controller.isDebugCallback = () => this.debugMode;
        if (this.dataProvider) {
            this.builderSvc.dataProvider = this.dataProvider;
        }
        if (!this.eventId) {
            throw new Error('Please assign eventId to WorkflowBuilderComponent');
        }
    }
    async ngAfterViewInit() {
        await delay(0); // delay to wait until html is fully rendered
        this.resize$.pipe(startWith(), debounceTime(100)).subscribe(() => {
            this.updateDiagramSize();
        });
    }
    async onDiagramLoad() {
        await this.controller.initFromProvider(this.dataProvider, this.eventId);
        const { connectors, nodes } = getNodeAndConnectorsFromCanvasControllerData(Object.values(this.controller.dataMap));
        nodes.forEach((node) => this.diagramEl.addNode({
            ...node,
            shape: {
                type: 'HTML',
            },
            style: {
                fill: 'blue',
            },
        }));
        connectors.forEach((connector) => this.diagramEl.addConnector(connector));
        this.log('onDiagramLoad - controller.dataMap', this.controller.dataMap, nodes, connectors);
        this.diagramEl.pan(0, 0);
    }
    async onPublish() {
        this.log('onPublish', this.controller.getCurrentState());
        this.controller.publish();
    }
    log(logName, ...params) {
        if (this.debugMode) {
            console.groupCollapsed(logName);
            console.trace(params);
            console.groupEnd();
        }
    }
    getSymbolInfo(symbol) {
        // Defines the symbol description
        return {
            width: 75,
            height: 40,
            description: { text: symbol.addInfo['description'] },
        };
    }
    onConnectionPointChange(event) {
        this.log('connectionPointChange', event);
        const { connector, state } = event;
        if (state !== 'Completed') {
            return;
        }
        this.handleConnectorPorts(connector);
    }
    async onElementDraw(event) {
        this.log('elementDraw', event);
        const { objectType, state } = event;
        if (state === 'Start') {
            // this is required to remove the selection-border that causes the connector to lose its sourceId
            this.diagramEl.unSelect(event.source);
        }
        if (state !== 'Completed') {
            return;
        }
        switch (objectType) {
            case 'Connector': {
                const connectorEvent = event;
                return this.onConnectionAddedByDrawing(connectorEvent.source);
            }
        }
    }
    async onCollectionChange(event) {
        this.log('collectionChange', event);
        const { type, state, element } = event;
        if (state !== 'Changed') {
            return;
        }
        if (element instanceof Node) {
            switch (type) {
                case 'Addition': {
                    await delay(300);
                    this.onDropPalette(element);
                    break;
                }
                case 'Removal': {
                    this.deleteWorkflow(getWorkflowIdFromNodeId(element.id));
                    break;
                }
            }
        }
        if (element instanceof Connector) {
            switch (type) {
                case 'Removal': {
                    const sourceWorkflowId = getWorkflowIdFromNodeId(element.sourceID);
                    const targetWorkflowId = getWorkflowIdFromNodeId(element.targetID);
                    const elementConnector = element;
                    const sourceWorkflow = this.controller.dataMap[sourceWorkflowId];
                    const outputPin = getOutputPinFromConnector(elementConnector);
                    if (targetWorkflowId ===
                        sourceWorkflow?.factory.getNextWorkflows()[outputPin]) {
                        this.controller.updateWorkflowNextWorkflow(outputPin, sourceWorkflowId, null);
                    }
                    break;
                }
                case 'Addition': {
                    break;
                }
            }
        }
    }
    async onSelectionChange(event) {
        this.log('selectionChange', event);
        const { state } = event;
        if (state !== 'Changed') {
            return;
        }
        // handle connectors selection indicator
        const selectedConnectorsMaps = getMapByValue(this.diagramEl.selectedItems.connectors ?? [], 'id');
        this.diagramEl.connectors.forEach((item) => {
            const selectedStrokeWidth = DEFAULT_STROKE_WIDTH * 2;
            const isSelectedItem = !!selectedConnectorsMaps[item.id];
            if (item.style?.strokeWidth) {
                if (item.style.strokeWidth !== DEFAULT_STROKE_WIDTH &&
                    !isSelectedItem) {
                    item.style.strokeWidth = DEFAULT_STROKE_WIDTH;
                }
                if (item.style.strokeWidth !== selectedStrokeWidth &&
                    isSelectedItem) {
                    item.style.strokeWidth = selectedStrokeWidth;
                }
            }
        });
        // make selected node on top of z-index
        const selectedNodesMaps = getMapByValue(this.diagramEl.selectedItems.nodes ?? [], 'id');
        this.diagramEl.nodes.forEach((item) => {
            const isSelectedItem = !!selectedNodesMaps[item.id];
            const nodeElement = this.host.nativeElement.querySelector(`#${item.id}_content_html_element`);
            if (nodeElement) {
                nodeElement.classList.toggle('diagram-node__selected', isSelectedItem);
            }
        });
    }
    onScrollChange(event) {
        this.log('onScrollChange', event);
        this.currentZoomFactor = event.newValue.CurrentZoom;
    }
    deleteWorkflow(workflowId) {
        this.controller.deleteWorkflow(workflowId);
    }
    /** Handle when dragging the tip end/start of a connector */
    async onConnectionChange(event) {
        this.log('connectionChange', event);
        const { state, newValue, oldValue, connectorEnd, connector } = event;
        if (state !== 'Changed') {
            return;
        }
        // @ts-ignore
        const newValueNodeId = newValue.nodeId;
        // @ts-ignore
        const oldValueNodeId = oldValue.nodeId;
        const connectorModel = connector;
        const outputPin = getOutputPinFromConnector(connectorModel);
        if (newValueNodeId != null &&
            oldValueNodeId != null &&
            newValueNodeId !== oldValueNodeId) {
            if (connectorEnd === 'ConnectorSourceEnd') {
                const oldWorkflowSourceId = getWorkflowIdFromNodeId(oldValueNodeId);
                const newWorkflowSourceId = getWorkflowIdFromNodeId(newValueNodeId);
                const newWorkflowTargetId = connector.targetID
                    ? getWorkflowIdFromNodeId(connector.targetID)
                    : null;
                const isValidNextWorkflow = this.controller.isValidNextWorkflow(outputPin, newWorkflowSourceId, newWorkflowTargetId);
                if (isValidNextWorkflow) {
                    this.controller.updateWorkflowNextWorkflow(outputPin, oldWorkflowSourceId, null);
                    if (newValueNodeId) {
                        this.controller.updateWorkflowNextWorkflow(outputPin, newWorkflowSourceId, newWorkflowTargetId);
                    }
                }
                else {
                    connector.sourceID = oldValueNodeId;
                }
            }
            if (connectorEnd === 'ConnectorTargetEnd' &&
                connector.sourceID?.startsWith(PREFIX_NODE)) {
                const workflowSourceId = getWorkflowIdFromNodeId(connector.sourceID);
                const newWorkflowTargetId = newValueNodeId
                    ? getWorkflowIdFromNodeId(newValueNodeId)
                    : null;
                const isValidNextWorkflow = this.controller.isValidNextWorkflow(outputPin, workflowSourceId, newWorkflowTargetId);
                if (isValidNextWorkflow) {
                    this.controller.updateWorkflowNextWorkflow(outputPin, workflowSourceId, newWorkflowTargetId);
                }
                else {
                    connector.targetID = oldValueNodeId;
                }
            }
        }
        this.checkConnector(connector.id);
    }
    async onDropPalette(node) {
        const paletteAddInfo = node?.addInfo;
        if (workflowTypeArray.includes(paletteAddInfo?.type)) {
            const newControllerData = this.controller.addWorkflow(paletteAddInfo?.type, {
                coordinate: {
                    x: node.offsetX,
                    y: node.offsetY,
                },
                name: this.sharedSvc.translate(WORKFLOW_NAME_TRANSLATIONS[paletteAddInfo.type]),
                description: this.sharedSvc.translate(WORKFLOW_EXPLANATION_TRANSLATIONS[paletteAddInfo.type]),
            });
            const newNodeData = getNodeFromCanvasControllerData(newControllerData);
            this.diagramEl.addNode(newNodeData);
            this.diagramEl.remove(node);
        }
    }
    onPositionChange(event) {
        this.log('positionChange', event);
        const { state, newValue, source } = event;
        if (state !== 'Completed') {
            return;
        }
        const sourceNode = source;
        if (sourceNode?.id?.startsWith(PREFIX_NODE)) {
            this.controller.updateWorkflowCoordinate(getWorkflowIdFromNodeId(sourceNode.id), {
                x: newValue.offsetX,
                y: newValue.offsetY,
            });
        }
    }
    async onConnectionAddedByDrawing(connector) {
        this.log('onConnectionAddedByDrawing', connector);
        const workflowSourceId = getWorkflowIdFromNodeId(connector.sourceID);
        const workflowTargetId = getWorkflowIdFromNodeId(connector.targetID);
        const connectorModel = connector;
        const outputPin = getOutputPinFromConnector(connectorModel);
        const isValidNextWorkflow = this.controller.isValidNextWorkflow(outputPin, workflowSourceId, workflowTargetId, true);
        if (isValidNextWorkflow) {
            this.controller.updateWorkflowNextWorkflow(outputPin, workflowSourceId, workflowTargetId);
        }
        else {
            await delay(300);
            this.diagramEl.remove(connector);
        }
        this.checkConnector(connector.id);
    }
    checkConnector(connectorId) {
        const connector = this.diagramEl.connectors.find(({ id }) => id === connectorId);
        if (!connector) {
            return;
        }
        connector.style = {
            ...connector.style,
            strokeColor: connector.sourceID &&
                connector.targetID &&
                connector.sourceID !== connector.targetID
                ? DEFAULT_STROKE_COLOR
                : DEFAULT_ERROR_STROKE_COLOR,
        };
        const connectorInstance = connector;
        const connectorModel = connector;
        const outputPin = getOutputPinFromConnector(connectorModel);
        connectorInstance.constraints =
            ConnectorConstraints.Default - ConnectorConstraints.DragSourceEnd;
        if (connectorInstance.annotations?.[0]) {
            connectorInstance.annotations[0].content =
                getConnectorAnnotation(outputPin)[0].content;
        }
        else {
            this.diagramEl.addConnectorLabels(connector, getConnectorAnnotation(outputPin));
        }
        this.handleConnectorPorts(connectorInstance);
        this.diagramEl.dataBind();
    }
    handleConnectorPorts(connector) {
        const connectorModel = connector;
        const outputPin = getOutputPinFromConnector(connectorModel);
        if (outputPin &&
            connectorModel.sourceID &&
            !connectorModel.sourcePortID) {
            connectorModel.sourcePortID = `${PREFIX_PORT}_${outputPin}_pin`;
        }
        if (outputPin &&
            connectorModel.targetID &&
            !connectorModel.targetPortID) {
            connectorModel.targetPortID = `${PREFIX_PORT}_${OUTPUT_PIN_PAIR[outputPin]}_pin`;
        }
    }
    updateWorkflowSettings(nodeId, data) {
        if (data?.obj) {
            this.controller.updateWorkflowSettings(getWorkflowIdFromNodeId(nodeId), data.obj);
        }
    }
    updateWorkflowCanvas(nodeId, data) {
        this.controller.updateWorkflowCanvas(getWorkflowIdFromNodeId(nodeId), data);
    }
    deleteNode(nodeModel) {
        const nodeInstance = this.diagramEl.nodes.find(({ id }) => id === nodeModel.id);
        nodeInstance.constraints = NodeConstraints.Default;
        this.diagramEl.remove(nodeInstance);
    }
    async updateDiagramSize() {
        const rect = this.host.nativeElement
            .querySelector('ejs-diagram')
            ?.getBoundingClientRect();
        this.diagramConfig.height = rect?.height;
        this.diagramConfig.width = rect?.width;
    }
    saveState() {
        // TODO
    }
    hasNodeSelectedAndExpanded2() {
        const selectedNodeMap = getMapByValue(this.diagramEl?.selectedItems.nodes ?? [], 'id');
        return !!this.nodeForms?.some((node) => !!selectedNodeMap[node.node.id] &&
            !!node.workflowSettingsGroupedFieldData?.expandPanels);
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.10", ngImport: i0, type: WorkflowBuilderComponent, deps: [{ token: i1.WorkflowBuilderService }, { token: i2.AzavistaWorkflowBuilderController }, { token: i0.ElementRef }, { token: i3.NgResizeObserver }, { token: i4.AzavistaSharedService }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.2.10", type: WorkflowBuilderComponent, selector: "azavista-workflow-builder", inputs: { dataProvider: "dataProvider", eventId: "eventId", debugMode: "debugMode" }, providers: [...ngResizeObserverProviders], viewQueries: [{ propertyName: "diagramEl", first: true, predicate: ["diagram"], descendants: true }, { propertyName: "nodeForms", predicate: WorkflowBuilderNodeFormComponent, descendants: true }], ngImport: i0, template: "<div class=\"workflow-builder-div\">\r\n  <div class=\"workflow-builder-div__diagram-area\">\r\n    <div class=\"workflow-builder-div__diagram-area__toolbar\">\r\n      <div class=\"workflow-builder-div__diagram-area__toolbar__left\">\r\n        <azavista-button\r\n          [disabled]=\"!(controller.validityMap| apply : areWorkflowsValid)\"\r\n          (click)=\"onPublish()\"\r\n          color=\"primary\">{{\r\n          \"PUBLISH\" | translate\r\n        }}</azavista-button>\r\n      </div>\r\n      <div class=\"workflow-builder-div__diagram-area__toolbar__right\">\r\n        <mat-select\r\n          [value]=\"1\"\r\n          (selectionChange)=\"diagram.zoom($event.value / currentZoomFactor)\"\r\n          class=\"workflow-builder-div__diagram-area__toolbar__tool-zoom\"\r\n        >\r\n          <mat-option class=\"workflow-builder-div__diagram-area__toolbar__tool-zoom__option\" *ngFor=\"let factor of zoomOptions\" [value]=\"factor\"\r\n            >{{ factor * 100 }} %</mat-option\r\n          >\r\n        </mat-select>\r\n      </div>\r\n    </div>\r\n    <ejs-diagram\r\n      #diagram\r\n      id=\"diagram\"\r\n      [width]=\"diagramConfig.width\"\r\n      [height]=\"diagramConfig.height\"\r\n      [tool]=\"tool\"\r\n      [tooltip]=\"diagramConfig.tooltip\"\r\n      [constraints]=\"diagramConfig.constraints\"\r\n      [snapSettings]=\"diagramConfig.snapSettings\"\r\n      [getConnectorDefaults]=\"diagramConfig.getConnectorDefaults\"\r\n      [class.ejs-diagram--has-node-selected]=\"\r\n        diagram.selectedItems.nodes && diagram.selectedItems.nodes.length > 0\r\n      \"\r\n      [class.ejs-diagram--has-node-selected-and-expanded]=\"\r\n        hasNodeSelectedAndExpanded2()\r\n      \"\r\n      (created)=\"onDiagramLoad()\"\r\n      (connectionChange)=\"onConnectionChange($event)\"\r\n      (elementDraw)=\"onElementDraw($event)\"\r\n      (commandExecute)=\"log('commandExecute', $event)\"\r\n      (created)=\"log('created', $event)\"\r\n      (dataLoaded)=\"log('dataLoaded', $event)\"\r\n      (dragEnter)=\"log('dragEnter', $event)\"\r\n      (dragLeave)=\"log('dragLeave', $event)\"\r\n      (dragOver)=\"log('dragOver', $event)\"\r\n      (drop)=\"log('drop', $event)\"\r\n      (fixedUserHandleClick)=\"log('fixedUserHandleClick', $event)\"\r\n      (load)=\"log('load', $event)\"\r\n      (positionChange)=\"onPositionChange($event)\"\r\n      (propertyChange)=\"log('propertyChange', $event)\"\r\n      (rotateChange)=\"log('rotateChange', $event)\"\r\n      (scrollChange)=\"onScrollChange($event)\"\r\n      (segmentChange)=\"log('segmentChange', $event)\"\r\n      (segmentCollectionChange)=\"log('segmentCollectionChange', $event)\"\r\n      (selectionChange)=\"onSelectionChange($event)\"\r\n      (sizeChange)=\"log('sizeChange', $event)\"\r\n      (sourcePointChange)=\"onConnectionPointChange($event)\"\r\n      (targetPointChange)=\"onConnectionPointChange($event)\"\r\n      (collectionChange)=\"onCollectionChange($event)\"\r\n    >\r\n      <ng-template #nodeTemplate let-data>\r\n        <azavista-workflow-builder-node-form\r\n          [node]=\"data\"\r\n          [diagramEl]=\"diagramEl\"\r\n          [eventId]=\"eventId\"\r\n          (workflowSettingsChanges)=\"updateWorkflowSettings(data.id, $event)\"\r\n          (canvasChanges)=\"updateWorkflowCanvas(data.id, $event)\"\r\n          (removeNode)=\"deleteNode(data)\"\r\n        ></azavista-workflow-builder-node-form>\r\n      </ng-template>\r\n    </ejs-diagram>\r\n  </div>\r\n  <div class=\"workflow-builder-div__palette-area\">\r\n    <mat-tab-group>\r\n      <mat-tab label=\"{{ 'WORK_BLOCKS' | translate }}\">\r\n        <azavista-workflow-builder-workflow-builder-palette></azavista-workflow-builder-workflow-builder-palette>\r\n      </mat-tab>\r\n    </mat-tab-group>\r\n  </div>\r\n</div>\r\n", styles: [":host{display:block;position:relative;min-width:inherit;max-width:inherit;min-height:inherit;max-height:inherit;height:inherit;width:inherit}:host ::ng-deep *{font-size:12px}.workflow-builder-div{display:flex;min-width:inherit;max-width:inherit;min-height:inherit;max-height:inherit;height:inherit}.workflow-builder-div__diagram-area{display:flex;flex-direction:column;width:calc(100% - 256px);height:inherit;overflow:hidden;padding:2px;gap:4px}.workflow-builder-div__diagram-area__toolbar{display:flex;align-items:center;justify-content:space-between;height:var(--mdc-secondary-navigation-tab-container-height);padding:0 24px;border:none;margin:5px 0}.workflow-builder-div__diagram-area__toolbar__tool-zoom{border-radius:8px;border:2px solid #777;padding:2px 6px}.workflow-builder-div__palette-area{max-height:inherit;overflow-y:auto;width:256px;padding:2px}mat-tab-group{max-height:100%;height:100%}mat-tab-group ::ng-deep .mat-mdc-tab-body-wrapper{height:100%;overflow:hidden}mat-tab-group ::ng-deep .mat-mdc-tab-body.mat-mdc-tab-body-active,mat-tab-group ::ng-deep .mat-mdc-tab-body-content{overflow:hidden}::ng-deep .mat-mdc-tab-header{margin-bottom:0}ejs-diagram{display:block;flex:1 1 auto;height:auto!important;width:auto!important;max-width:100%;box-shadow:0 0 2px #0000009c;border-radius:4px;background-color:#fbfbfb}ejs-diagram.ejs-diagram--has-node-selected-and-expanded ::ng-deep #diagram_htmlLayer{z-index:1}::ng-deep .e-tooltip-wrap{display:none}::ng-deep [class].diagram-node__selected{z-index:99999999}::ng-deep [class].diagram-node__ineligible{opacity:.5}::ng-deep div[id^=node_][id$=_content_html_element]>div{overflow-y:auto}::ng-deep .workflow-builder-div__diagram-area__toolbar__tool-zoom__option.mat-mdc-option{font-size:12px}::ng-deep .workflow-builder-div__diagram-area__toolbar__tool-zoom__option.mat-mdc-option .mdc-list-item__primary-text{white-space:pre;text-align:right;min-width:max-content}\n"], dependencies: [{ kind: "directive", type: i5.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "component", type: i6.MatSelect, selector: "mat-select", inputs: ["disabled", "disableRipple", "tabIndex", "panelWidth", "hideSingleSelectionIndicator"], exportAs: ["matSelect"] }, { kind: "component", type: i7.MatOption, selector: "mat-option", exportAs: ["matOption"] }, { kind: "component", type: i8.MatTab, selector: "mat-tab", inputs: ["disabled"], exportAs: ["matTab"] }, { kind: "component", type: i8.MatTabGroup, selector: "mat-tab-group", inputs: ["color", "disableRipple", "fitInkBarToContent", "mat-stretch-tabs"], exportAs: ["matTabGroup"] }, { kind: "component", type: i9.DiagramComponent, selector: "ejs-diagram", inputs: ["addInfo", "annotationTemplate", "backgroundColor", "bridgeDirection", "commandManager", "connectorDefaults", "connectors", "constraints", "contextMenuSettings", "customCursor", "dataSourceSettings", "diagramSettings", "drawingObject", "enableConnectorSplit", "enablePersistence", "enableRtl", "getConnectorDefaults", "getCustomCursor", "getCustomProperty", "getCustomTool", "getDescription", "getNodeDefaults", "height", "historyManager", "layers", "layout", "locale", "mode", "nodeDefaults", "nodeTemplate", "nodes", "pageSettings", "rulerSettings", "scrollSettings", "segmentThumbShape", "selectedItems", "serializationSettings", "setNodeTemplate", "snapSettings", "tool", "tooltip", "updateSelection", "userHandleTemplate", "width"], outputs: ["animationComplete", "click", "collectionChange", "commandExecute", "connectionChange", "contextMenuBeforeItemRender", "contextMenuClick", "contextMenuOpen", "created", "dataLoaded", "doubleClick", "dragEnter", "dragLeave", "dragOver", "drop", "expandStateChange", "fixedUserHandleClick", "historyChange", "historyStateChange", "keyDown", "keyUp", "load", "mouseEnter", "mouseLeave", "mouseOver", "mouseWheel", "onImageLoad", "onUserHandleMouseDown", "onUserHandleMouseEnter", "onUserHandleMouseLeave", "onUserHandleMouseUp", "positionChange", "propertyChange", "rotateChange", "scrollChange", "segmentChange", "segmentCollectionChange", "selectionChange", "sizeChange", "sourcePointChange", "targetPointChange", "textEdit", "elementDraw"] }, { kind: "component", type: i10.AzavistaButtonComponent, selector: "azavista-button", inputs: ["acl", "disabled", "cssClasses", "containerCssClasses"] }, { kind: "component", type: i11.WorkflowBuilderPaletteComponent, selector: "azavista-workflow-builder-workflow-builder-palette" }, { kind: "component", type: i12.WorkflowBuilderNodeFormComponent, selector: "azavista-workflow-builder-node-form", inputs: ["node", "eventId", "diagramEl"], outputs: ["workflowSettingsChanges", "canvasChanges", "removeNode"] }, { kind: "pipe", type: i13.TranslatePipe, name: "translate" }, { kind: "pipe", type: i14.ApplyFunctionPipe, name: "apply" }], changeDetection: i0.ChangeDetectionStrategy.Default }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.10", ngImport: i0, type: WorkflowBuilderComponent, decorators: [{
            type: Component,
            args: [{ selector: 'azavista-workflow-builder', changeDetection: ChangeDetectionStrategy.Default, providers: [...ngResizeObserverProviders], template: "<div class=\"workflow-builder-div\">\r\n  <div class=\"workflow-builder-div__diagram-area\">\r\n    <div class=\"workflow-builder-div__diagram-area__toolbar\">\r\n      <div class=\"workflow-builder-div__diagram-area__toolbar__left\">\r\n        <azavista-button\r\n          [disabled]=\"!(controller.validityMap| apply : areWorkflowsValid)\"\r\n          (click)=\"onPublish()\"\r\n          color=\"primary\">{{\r\n          \"PUBLISH\" | translate\r\n        }}</azavista-button>\r\n      </div>\r\n      <div class=\"workflow-builder-div__diagram-area__toolbar__right\">\r\n        <mat-select\r\n          [value]=\"1\"\r\n          (selectionChange)=\"diagram.zoom($event.value / currentZoomFactor)\"\r\n          class=\"workflow-builder-div__diagram-area__toolbar__tool-zoom\"\r\n        >\r\n          <mat-option class=\"workflow-builder-div__diagram-area__toolbar__tool-zoom__option\" *ngFor=\"let factor of zoomOptions\" [value]=\"factor\"\r\n            >{{ factor * 100 }} %</mat-option\r\n          >\r\n        </mat-select>\r\n      </div>\r\n    </div>\r\n    <ejs-diagram\r\n      #diagram\r\n      id=\"diagram\"\r\n      [width]=\"diagramConfig.width\"\r\n      [height]=\"diagramConfig.height\"\r\n      [tool]=\"tool\"\r\n      [tooltip]=\"diagramConfig.tooltip\"\r\n      [constraints]=\"diagramConfig.constraints\"\r\n      [snapSettings]=\"diagramConfig.snapSettings\"\r\n      [getConnectorDefaults]=\"diagramConfig.getConnectorDefaults\"\r\n      [class.ejs-diagram--has-node-selected]=\"\r\n        diagram.selectedItems.nodes && diagram.selectedItems.nodes.length > 0\r\n      \"\r\n      [class.ejs-diagram--has-node-selected-and-expanded]=\"\r\n        hasNodeSelectedAndExpanded2()\r\n      \"\r\n      (created)=\"onDiagramLoad()\"\r\n      (connectionChange)=\"onConnectionChange($event)\"\r\n      (elementDraw)=\"onElementDraw($event)\"\r\n      (commandExecute)=\"log('commandExecute', $event)\"\r\n      (created)=\"log('created', $event)\"\r\n      (dataLoaded)=\"log('dataLoaded', $event)\"\r\n      (dragEnter)=\"log('dragEnter', $event)\"\r\n      (dragLeave)=\"log('dragLeave', $event)\"\r\n      (dragOver)=\"log('dragOver', $event)\"\r\n      (drop)=\"log('drop', $event)\"\r\n      (fixedUserHandleClick)=\"log('fixedUserHandleClick', $event)\"\r\n      (load)=\"log('load', $event)\"\r\n      (positionChange)=\"onPositionChange($event)\"\r\n      (propertyChange)=\"log('propertyChange', $event)\"\r\n      (rotateChange)=\"log('rotateChange', $event)\"\r\n      (scrollChange)=\"onScrollChange($event)\"\r\n      (segmentChange)=\"log('segmentChange', $event)\"\r\n      (segmentCollectionChange)=\"log('segmentCollectionChange', $event)\"\r\n      (selectionChange)=\"onSelectionChange($event)\"\r\n      (sizeChange)=\"log('sizeChange', $event)\"\r\n      (sourcePointChange)=\"onConnectionPointChange($event)\"\r\n      (targetPointChange)=\"onConnectionPointChange($event)\"\r\n      (collectionChange)=\"onCollectionChange($event)\"\r\n    >\r\n      <ng-template #nodeTemplate let-data>\r\n        <azavista-workflow-builder-node-form\r\n          [node]=\"data\"\r\n          [diagramEl]=\"diagramEl\"\r\n          [eventId]=\"eventId\"\r\n          (workflowSettingsChanges)=\"updateWorkflowSettings(data.id, $event)\"\r\n          (canvasChanges)=\"updateWorkflowCanvas(data.id, $event)\"\r\n          (removeNode)=\"deleteNode(data)\"\r\n        ></azavista-workflow-builder-node-form>\r\n      </ng-template>\r\n    </ejs-diagram>\r\n  </div>\r\n  <div class=\"workflow-builder-div__palette-area\">\r\n    <mat-tab-group>\r\n      <mat-tab label=\"{{ 'WORK_BLOCKS' | translate }}\">\r\n        <azavista-workflow-builder-workflow-builder-palette></azavista-workflow-builder-workflow-builder-palette>\r\n      </mat-tab>\r\n    </mat-tab-group>\r\n  </div>\r\n</div>\r\n", styles: [":host{display:block;position:relative;min-width:inherit;max-width:inherit;min-height:inherit;max-height:inherit;height:inherit;width:inherit}:host ::ng-deep *{font-size:12px}.workflow-builder-div{display:flex;min-width:inherit;max-width:inherit;min-height:inherit;max-height:inherit;height:inherit}.workflow-builder-div__diagram-area{display:flex;flex-direction:column;width:calc(100% - 256px);height:inherit;overflow:hidden;padding:2px;gap:4px}.workflow-builder-div__diagram-area__toolbar{display:flex;align-items:center;justify-content:space-between;height:var(--mdc-secondary-navigation-tab-container-height);padding:0 24px;border:none;margin:5px 0}.workflow-builder-div__diagram-area__toolbar__tool-zoom{border-radius:8px;border:2px solid #777;padding:2px 6px}.workflow-builder-div__palette-area{max-height:inherit;overflow-y:auto;width:256px;padding:2px}mat-tab-group{max-height:100%;height:100%}mat-tab-group ::ng-deep .mat-mdc-tab-body-wrapper{height:100%;overflow:hidden}mat-tab-group ::ng-deep .mat-mdc-tab-body.mat-mdc-tab-body-active,mat-tab-group ::ng-deep .mat-mdc-tab-body-content{overflow:hidden}::ng-deep .mat-mdc-tab-header{margin-bottom:0}ejs-diagram{display:block;flex:1 1 auto;height:auto!important;width:auto!important;max-width:100%;box-shadow:0 0 2px #0000009c;border-radius:4px;background-color:#fbfbfb}ejs-diagram.ejs-diagram--has-node-selected-and-expanded ::ng-deep #diagram_htmlLayer{z-index:1}::ng-deep .e-tooltip-wrap{display:none}::ng-deep [class].diagram-node__selected{z-index:99999999}::ng-deep [class].diagram-node__ineligible{opacity:.5}::ng-deep div[id^=node_][id$=_content_html_element]>div{overflow-y:auto}::ng-deep .workflow-builder-div__diagram-area__toolbar__tool-zoom__option.mat-mdc-option{font-size:12px}::ng-deep .workflow-builder-div__diagram-area__toolbar__tool-zoom__option.mat-mdc-option .mdc-list-item__primary-text{white-space:pre;text-align:right;min-width:max-content}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.WorkflowBuilderService }, { type: i2.AzavistaWorkflowBuilderController }, { type: i0.ElementRef }, { type: i3.NgResizeObserver }, { type: i4.AzavistaSharedService }]; }, propDecorators: { dataProvider: [{
                type: Input
            }], eventId: [{
                type: Input
            }], debugMode: [{
                type: Input
            }], diagramEl: [{
                type: ViewChild,
                args: ['diagram']
            }], nodeForms: [{
                type: ViewChildren,
                args: [WorkflowBuilderNodeFormComponent]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid29ya2Zsb3ctYnVpbGRlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9hemF2aXN0YS93b3JrZmxvdy1idWlsZGVyL3NyYy9saWIvd29ya2Zsb3ctYnVpbGRlci5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9hemF2aXN0YS93b3JrZmxvdy1idWlsZGVyL3NyYy9saWIvd29ya2Zsb3ctYnVpbGRlci5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxzREFBc0Q7QUFDdEQsT0FBTyxFQUVILHVCQUF1QixFQUN2QixTQUFTLEVBRVQsS0FBSyxFQUdMLFNBQVMsRUFDVCxZQUFZLEdBQ2YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUNILFNBQVMsRUFDVCxvQkFBb0IsRUFDcEIsa0JBQWtCLEVBQ2xCLFlBQVksRUFPWixJQUFJLEVBQ0osZUFBZSxFQUNmLGVBQWUsR0FHbEIsTUFBTSxrQ0FBa0MsQ0FBQztBQUMxQyxPQUFPLEVBRUgseUJBQXlCLEdBQzVCLE1BQU0sb0JBQW9CLENBQUM7QUFDNUIsT0FBTyxFQUFFLFlBQVksRUFBRSxTQUFTLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFPL0MsT0FBTyxFQUVILGlCQUFpQixFQUNqQiwwQkFBMEIsRUFDMUIsb0JBQW9CLEVBQ3BCLG9CQUFvQixFQUVwQixlQUFlLEVBQ2YsV0FBVyxFQUNYLFdBQVcsRUFDWCxpQ0FBaUMsRUFDakMsMEJBQTBCLEdBQzdCLE1BQU0sU0FBUyxDQUFDO0FBQ2pCLE9BQU8sRUFDSCxLQUFLLEVBQ0wsc0JBQXNCLEVBQ3RCLGFBQWEsRUFDYiw0Q0FBNEMsRUFDNUMsK0JBQStCLEVBQy9CLHlCQUF5QixFQUN6Qix1QkFBdUIsRUFDdkIsaUJBQWlCLEdBQ3BCLE1BQU0sU0FBUyxDQUFDO0FBTWpCLE9BQU8sRUFBRSxnQ0FBZ0MsRUFBRSxNQUFNLDhFQUE4RSxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7O0FBRWhJLE1BQU0sQ0FBQyxNQUFNLG1CQUFtQixHQUFhO0lBQ3pDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLENBQUM7Q0FDakQsQ0FBQztBQVNGLE1BQU0sT0FBTyx3QkFBd0I7SUFnRGpDLFlBQ1ksVUFBa0MsRUFDbkMsVUFBNkMsRUFDNUMsSUFBNkIsRUFDN0IsT0FBeUIsRUFDekIsU0FBZ0M7UUFKaEMsZUFBVSxHQUFWLFVBQVUsQ0FBd0I7UUFDbkMsZUFBVSxHQUFWLFVBQVUsQ0FBbUM7UUFDNUMsU0FBSSxHQUFKLElBQUksQ0FBeUI7UUFDN0IsWUFBTyxHQUFQLE9BQU8sQ0FBa0I7UUFDekIsY0FBUyxHQUFULFNBQVMsQ0FBdUI7UUFwRDVDLDJDQUEyQztRQUNsQyxpQkFBWSxHQUNqQixJQUFJLENBQUMsVUFBVSxDQUFDLFlBQVksQ0FBQztRQUl4QixjQUFTLEdBQUcsS0FBSyxDQUFDO1FBRTNCLGtCQUFhLEdBV1Q7WUFDQSxXQUFXLEVBQUUsa0JBQWtCLENBQUMsT0FBTztZQUN2QyxZQUFZLEVBQUU7Z0JBQ1YsV0FBVyxFQUFFLGVBQWUsQ0FBQyxZQUFZO2FBQzVDO1lBQ0Qsb0JBQW9CLEVBQUUsR0FBRyxFQUFFLENBQUMsaUJBQWlCO1lBQzdDLGFBQWEsRUFBRSxFQUFFLEdBQUcsaUJBQWlCLEVBQUU7U0FDMUMsQ0FBQztRQUVGLFNBQUksR0FBaUIsWUFBWSxDQUFDLFlBQVksR0FBRyxZQUFZLENBQUMsT0FBTyxDQUFDO1FBRXRFLGtCQUFhLEdBQ1Q7WUFDSSxRQUFRLEVBQUUsRUFBRTtZQUNaLGFBQWEsRUFBRSxHQUFHLEVBQUUsR0FBRSxDQUFDO1NBQzFCLENBQUM7UUFFTixrQkFBYSxHQUFHLEtBQUssQ0FBQztRQUV0QixnQkFBVyxHQUFHLG1CQUFtQixDQUFDO1FBRWxDLHNCQUFpQixHQUFHLENBQUMsQ0FBQztRQXVkdEIsK0JBQTBCLEdBQUcsQ0FBQyxhQUFvQyxFQUFFLEVBQUU7WUFDbEUsTUFBTSxlQUFlLEdBQUcsYUFBYSxDQUFDLGFBQWEsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUMzRCxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLElBQUksQ0FDekIsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUNMLENBQUMsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7Z0JBQy9CLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsUUFBUTtvQkFDeEIsQ0FBQyxDQUFDLElBQUksQ0FBQyxnQ0FBZ0MsRUFBRSxZQUFZLENBQUMsQ0FDakUsQ0FBQztRQUNOLENBQUMsQ0FBQztRQWNGLHNCQUFpQixHQUFHLENBQ2hCLFdBQTZELEVBQy9ELEVBQUU7WUFDQSxPQUFPLE1BQU0sQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsT0FBTyxFQUFFLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNsRSxDQUFDLENBQUM7SUFwZUMsQ0FBQztJQUVKLEtBQUssQ0FBQyxRQUFRO1FBQ1YsSUFBSSxDQUFDLFVBQVUsQ0FBQyxlQUFlLEdBQUcsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQztRQUN2RCxJQUFJLElBQUksQ0FBQyxZQUFZLEVBQUU7WUFDbkIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQztTQUNwRDtRQUNELElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ2YsTUFBTSxJQUFJLEtBQUssQ0FDWCxtREFBbUQsQ0FDdEQsQ0FBQztTQUNMO0lBQ0wsQ0FBQztJQUVELEtBQUssQ0FBQyxlQUFlO1FBQ2pCLE1BQU0sS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsNkNBQTZDO1FBQzdELElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxFQUFFLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUU7WUFDN0QsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFDN0IsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQsS0FBSyxDQUFDLGFBQWE7UUFDZixNQUFNLElBQUksQ0FBQyxVQUFVLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDeEUsTUFBTSxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUUsR0FDdkIsNENBQTRDLENBQ3hDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FDekMsQ0FBQztRQUNOLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUNuQixJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQztZQUNuQixHQUFHLElBQUk7WUFDUCxLQUFLLEVBQUU7Z0JBQ0gsSUFBSSxFQUFFLE1BQU07YUFDZjtZQUNELEtBQUssRUFBRTtnQkFDSCxJQUFJLEVBQUUsTUFBTTthQUNmO1NBQ0osQ0FBQyxDQUNMLENBQUM7UUFDRixVQUFVLENBQUMsT0FBTyxDQUFDLENBQUMsU0FBUyxFQUFFLEVBQUUsQ0FDN0IsSUFBSSxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDLENBQ3pDLENBQUM7UUFDRixJQUFJLENBQUMsR0FBRyxDQUNKLG9DQUFvQyxFQUNwQyxJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sRUFDdkIsS0FBSyxFQUNMLFVBQVUsQ0FDYixDQUFDO1FBRUYsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQzdCLENBQUM7SUFFRCxLQUFLLENBQUMsU0FBUztRQUNYLElBQUksQ0FBQyxHQUFHLENBQUMsV0FBVyxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsZUFBZSxFQUFFLENBQUMsQ0FBQztRQUN6RCxJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQzlCLENBQUM7SUFFRCxHQUFHLENBQUMsT0FBZSxFQUFFLEdBQUcsTUFBYTtRQUNqQyxJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDaEIsT0FBTyxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNoQyxPQUFPLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ3RCLE9BQU8sQ0FBQyxRQUFRLEVBQUUsQ0FBQztTQUN0QjtJQUNMLENBQUM7SUFFTSxhQUFhLENBQUMsTUFBVztRQUM1QixpQ0FBaUM7UUFDakMsT0FBTztZQUNILEtBQUssRUFBRSxFQUFFO1lBQ1QsTUFBTSxFQUFFLEVBQUU7WUFDVixXQUFXLEVBQUUsRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsRUFBRTtTQUN2RCxDQUFDO0lBQ04sQ0FBQztJQUVELHVCQUF1QixDQUFDLEtBQWlDO1FBQ3JELElBQUksQ0FBQyxHQUFHLENBQUMsdUJBQXVCLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDekMsTUFBTSxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsR0FBRyxLQUFLLENBQUM7UUFDbkMsSUFBSSxLQUFLLEtBQUssV0FBVyxFQUFFO1lBQ3ZCLE9BQU87U0FDVjtRQUNELElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUN6QyxDQUFDO0lBRUQsS0FBSyxDQUFDLGFBQWEsQ0FBQyxLQUE0QjtRQUM1QyxJQUFJLENBQUMsR0FBRyxDQUFDLGFBQWEsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUMvQixNQUFNLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBRSxHQUFHLEtBQUssQ0FBQztRQUNwQyxJQUFJLEtBQUssS0FBSyxPQUFPLEVBQUU7WUFDbkIsaUdBQWlHO1lBQ2pHLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUN6QztRQUNELElBQUksS0FBSyxLQUFLLFdBQVcsRUFBRTtZQUN2QixPQUFPO1NBQ1Y7UUFDRCxRQUFRLFVBQVUsRUFBRTtZQUNoQixLQUFLLFdBQVcsQ0FBQyxDQUFDO2dCQUNkLE1BQU0sY0FBYyxHQUNoQixLQUF5QyxDQUFDO2dCQUM5QyxPQUFPLElBQUksQ0FBQywwQkFBMEIsQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLENBQUM7YUFDakU7U0FDSjtJQUNMLENBQUM7SUFFRCxLQUFLLENBQUMsa0JBQWtCLENBQUMsS0FBaUM7UUFDdEQsSUFBSSxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUNwQyxNQUFNLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsR0FBRyxLQUFLLENBQUM7UUFDdkMsSUFBSSxLQUFLLEtBQUssU0FBUyxFQUFFO1lBQ3JCLE9BQU87U0FDVjtRQUNELElBQUksT0FBTyxZQUFZLElBQUksRUFBRTtZQUN6QixRQUFRLElBQUksRUFBRTtnQkFDVixLQUFLLFVBQVUsQ0FBQyxDQUFDO29CQUNiLE1BQU0sS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO29CQUNqQixJQUFJLENBQUMsYUFBYSxDQUFDLE9BQWMsQ0FBQyxDQUFDO29CQUNuQyxNQUFNO2lCQUNUO2dCQUNELEtBQUssU0FBUyxDQUFDLENBQUM7b0JBQ1osSUFBSSxDQUFDLGNBQWMsQ0FDZix1QkFBdUIsQ0FBQyxPQUFPLENBQUMsRUFBUyxDQUFDLENBQzdDLENBQUM7b0JBQ0YsTUFBTTtpQkFDVDthQUNKO1NBQ0o7UUFDRCxJQUFJLE9BQU8sWUFBWSxTQUFTLEVBQUU7WUFDOUIsUUFBUSxJQUFJLEVBQUU7Z0JBQ1YsS0FBSyxTQUFTLENBQUMsQ0FBQztvQkFDWixNQUFNLGdCQUFnQixHQUFHLHVCQUF1QixDQUM1QyxPQUFPLENBQUMsUUFBZSxDQUMxQixDQUFDO29CQUNGLE1BQU0sZ0JBQWdCLEdBQUcsdUJBQXVCLENBQzVDLE9BQU8sQ0FBQyxRQUFlLENBQzFCLENBQUM7b0JBQ0YsTUFBTSxnQkFBZ0IsR0FDbEIsT0FBb0MsQ0FBQztvQkFDekMsTUFBTSxjQUFjLEdBQ2hCLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUM7b0JBQzlDLE1BQU0sU0FBUyxHQUNYLHlCQUF5QixDQUFDLGdCQUFnQixDQUFDLENBQUM7b0JBQ2hELElBQ0ksZ0JBQWdCO3dCQUNoQixjQUFjLEVBQUUsT0FBTyxDQUFDLGdCQUFnQixFQUFFLENBQUMsU0FBUyxDQUFDLEVBQ3ZEO3dCQUNFLElBQUksQ0FBQyxVQUFVLENBQUMsMEJBQTBCLENBQ3RDLFNBQVMsRUFDVCxnQkFBZ0IsRUFDaEIsSUFBSSxDQUNQLENBQUM7cUJBQ0w7b0JBQ0QsTUFBTTtpQkFDVDtnQkFDRCxLQUFLLFVBQVUsQ0FBQyxDQUFDO29CQUNiLE1BQU07aUJBQ1Q7YUFDSjtTQUNKO0lBQ0wsQ0FBQztJQUVELEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxLQUFnQztRQUNwRCxJQUFJLENBQUMsR0FBRyxDQUFDLGlCQUFpQixFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ25DLE1BQU0sRUFBRSxLQUFLLEVBQUUsR0FBRyxLQUFLLENBQUM7UUFDeEIsSUFBSSxLQUFLLEtBQUssU0FBUyxFQUFFO1lBQ3JCLE9BQU87U0FDVjtRQUVELHdDQUF3QztRQUN4QyxNQUFNLHNCQUFzQixHQUFHLGFBQWEsQ0FDeEMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxhQUFhLENBQUMsVUFBVSxJQUFJLEVBQUUsRUFDN0MsSUFBSSxDQUNQLENBQUM7UUFDRixJQUFJLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRTtZQUN2QyxNQUFNLG1CQUFtQixHQUFHLG9CQUFvQixHQUFHLENBQUMsQ0FBQztZQUNyRCxNQUFNLGNBQWMsR0FBRyxDQUFDLENBQUMsc0JBQXNCLENBQUMsSUFBSSxDQUFDLEVBQUcsQ0FBQyxDQUFDO1lBQzFELElBQUksSUFBSSxDQUFDLEtBQUssRUFBRSxXQUFXLEVBQUU7Z0JBQ3pCLElBQ0ksSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLEtBQUssb0JBQW9CO29CQUMvQyxDQUFDLGNBQWMsRUFDakI7b0JBQ0UsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLEdBQUcsb0JBQW9CLENBQUM7aUJBQ2pEO2dCQUNELElBQ0ksSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLEtBQUssbUJBQW1CO29CQUM5QyxjQUFjLEVBQ2hCO29CQUNFLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxHQUFHLG1CQUFtQixDQUFDO2lCQUNoRDthQUNKO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFFSCx1Q0FBdUM7UUFDdkMsTUFBTSxpQkFBaUIsR0FBRyxhQUFhLENBQ25DLElBQUksQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDLEtBQUssSUFBSSxFQUFFLEVBQ3hDLElBQUksQ0FDUCxDQUFDO1FBQ0YsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUU7WUFDbEMsTUFBTSxjQUFjLEdBQUcsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUNwRCxNQUFNLFdBQVcsR0FDYixJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQ2pDLElBQUksSUFBSSxDQUFDLEVBQUUsdUJBQXVCLENBQ3JDLENBQUM7WUFDTixJQUFJLFdBQVcsRUFBRTtnQkFDYixXQUFXLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FDeEIsd0JBQXdCLEVBQ3hCLGNBQWMsQ0FDakIsQ0FBQzthQUNMO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQsY0FBYyxDQUFDLEtBQTZCO1FBQ3hDLElBQUksQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDbEMsSUFBSSxDQUFDLGlCQUFpQixHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDO0lBQ3hELENBQUM7SUFFRCxjQUFjLENBQUMsVUFBa0I7UUFDN0IsSUFBSSxDQUFDLFVBQVUsQ0FBQyxjQUFjLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDL0MsQ0FBQztJQUVELDREQUE0RDtJQUM1RCxLQUFLLENBQUMsa0JBQWtCLENBQUMsS0FBaUM7UUFDdEQsSUFBSSxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUNwQyxNQUFNLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsWUFBWSxFQUFFLFNBQVMsRUFBRSxHQUFHLEtBQUssQ0FBQztRQUNyRSxJQUFJLEtBQUssS0FBSyxTQUFTLEVBQUU7WUFDckIsT0FBTztTQUNWO1FBQ0QsYUFBYTtRQUNiLE1BQU0sY0FBYyxHQUF1QixRQUFRLENBQUMsTUFBTSxDQUFDO1FBQzNELGFBQWE7UUFDYixNQUFNLGNBQWMsR0FBdUIsUUFBUSxDQUFDLE1BQU0sQ0FBQztRQUMzRCxNQUFNLGNBQWMsR0FBRyxTQUFzQyxDQUFDO1FBQzlELE1BQU0sU0FBUyxHQUFHLHlCQUF5QixDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQzVELElBQ0ksY0FBYyxJQUFJLElBQUk7WUFDdEIsY0FBYyxJQUFJLElBQUk7WUFDdEIsY0FBYyxLQUFLLGNBQWMsRUFDbkM7WUFDRSxJQUFJLFlBQVksS0FBSyxvQkFBb0IsRUFBRTtnQkFDdkMsTUFBTSxtQkFBbUIsR0FBRyx1QkFBdUIsQ0FDL0MsY0FBcUIsQ0FDeEIsQ0FBQztnQkFDRixNQUFNLG1CQUFtQixHQUFHLHVCQUF1QixDQUMvQyxjQUFxQixDQUN4QixDQUFDO2dCQUNGLE1BQU0sbUJBQW1CLEdBQUcsU0FBUyxDQUFDLFFBQVE7b0JBQzFDLENBQUMsQ0FBQyx1QkFBdUIsQ0FBQyxTQUFTLENBQUMsUUFBZSxDQUFDO29CQUNwRCxDQUFDLENBQUMsSUFBSSxDQUFDO2dCQUNYLE1BQU0sbUJBQW1CLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxtQkFBbUIsQ0FDM0QsU0FBUyxFQUNULG1CQUFtQixFQUNuQixtQkFBbUIsQ0FDdEIsQ0FBQztnQkFDRixJQUFJLG1CQUFtQixFQUFFO29CQUNyQixJQUFJLENBQUMsVUFBVSxDQUFDLDBCQUEwQixDQUN0QyxTQUFTLEVBQ1QsbUJBQW1CLEVBQ25CLElBQUksQ0FDUCxDQUFDO29CQUNGLElBQUksY0FBYyxFQUFFO3dCQUNoQixJQUFJLENBQUMsVUFBVSxDQUFDLDBCQUEwQixDQUN0QyxTQUFTLEVBQ1QsbUJBQW1CLEVBQ25CLG1CQUFtQixDQUN0QixDQUFDO3FCQUNMO2lCQUNKO3FCQUFNO29CQUNILFNBQVMsQ0FBQyxRQUFRLEdBQUcsY0FBYyxDQUFDO2lCQUN2QzthQUNKO1lBQ0QsSUFDSSxZQUFZLEtBQUssb0JBQW9CO2dCQUNyQyxTQUFTLENBQUMsUUFBUSxFQUFFLFVBQVUsQ0FBQyxXQUFXLENBQUMsRUFDN0M7Z0JBQ0UsTUFBTSxnQkFBZ0IsR0FBRyx1QkFBdUIsQ0FDNUMsU0FBUyxDQUFDLFFBQWUsQ0FDNUIsQ0FBQztnQkFDRixNQUFNLG1CQUFtQixHQUFHLGNBQWM7b0JBQ3RDLENBQUMsQ0FBQyx1QkFBdUIsQ0FBQyxjQUFxQixDQUFDO29CQUNoRCxDQUFDLENBQUMsSUFBSSxDQUFDO2dCQUNYLE1BQU0sbUJBQW1CLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxtQkFBbUIsQ0FDM0QsU0FBUyxFQUNULGdCQUFnQixFQUNoQixtQkFBbUIsQ0FDdEIsQ0FBQztnQkFDRixJQUFJLG1CQUFtQixFQUFFO29CQUNyQixJQUFJLENBQUMsVUFBVSxDQUFDLDBCQUEwQixDQUN0QyxTQUFTLEVBQ1QsZ0JBQWdCLEVBQ2hCLG1CQUFtQixDQUN0QixDQUFDO2lCQUNMO3FCQUFNO29CQUNILFNBQVMsQ0FBQyxRQUFRLEdBQUcsY0FBYyxDQUFDO2lCQUN2QzthQUNKO1NBQ0o7UUFDRCxJQUFJLENBQUMsY0FBYyxDQUFDLFNBQVMsQ0FBQyxFQUFHLENBQUMsQ0FBQztJQUN2QyxDQUFDO0lBRU8sS0FBSyxDQUFDLGFBQWEsQ0FBQyxJQUFxQztRQUM3RCxNQUFNLGNBQWMsR0FDaEIsSUFDSCxFQUFFLE9BQU8sQ0FBQztRQUNYLElBQUksaUJBQWlCLENBQUMsUUFBUSxDQUFDLGNBQWMsRUFBRSxJQUFJLENBQUMsRUFBRTtZQUNsRCxNQUFNLGlCQUFpQixHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUNqRCxjQUFjLEVBQUUsSUFBSSxFQUNwQjtnQkFDSSxVQUFVLEVBQUU7b0JBQ1IsQ0FBQyxFQUFFLElBQUksQ0FBQyxPQUFRO29CQUNoQixDQUFDLEVBQUUsSUFBSSxDQUFDLE9BQVE7aUJBQ25CO2dCQUNELElBQUksRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FDMUIsMEJBQTBCLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUNsRDtnQkFDRCxXQUFXLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQ2pDLGlDQUFpQyxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FDekQ7YUFDSixDQUNKLENBQUM7WUFDRixNQUFNLFdBQVcsR0FDYiwrQkFBK0IsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1lBQ3ZELElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQ3BDLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQy9CO0lBQ0wsQ0FBQztJQUVELGdCQUFnQixDQUFDLEtBQXlCO1FBQ3RDLElBQUksQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDbEMsTUFBTSxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLEdBQUcsS0FBSyxDQUFDO1FBQzFDLElBQUksS0FBSyxLQUFLLFdBQVcsRUFBRTtZQUN2QixPQUFPO1NBQ1Y7UUFDRCxNQUFNLFVBQVUsR0FBa0IsTUFBYSxDQUFDO1FBQ2hELElBQUksVUFBVSxFQUFFLEVBQUUsRUFBRSxVQUFVLENBQUMsV0FBVyxDQUFDLEVBQUU7WUFDekMsSUFBSSxDQUFDLFVBQVUsQ0FBQyx3QkFBd0IsQ0FDcEMsdUJBQXVCLENBQUMsVUFBVSxDQUFDLEVBQVMsQ0FBQyxFQUM3QztnQkFDSSxDQUFDLEVBQUUsUUFBUSxDQUFDLE9BQVE7Z0JBQ3BCLENBQUMsRUFBRSxRQUFRLENBQUMsT0FBUTthQUN2QixDQUNKLENBQUM7U0FDTDtJQUNMLENBQUM7SUFFTyxLQUFLLENBQUMsMEJBQTBCLENBQUMsU0FBb0I7UUFDekQsSUFBSSxDQUFDLEdBQUcsQ0FBQyw0QkFBNEIsRUFBRSxTQUFTLENBQUMsQ0FBQztRQUNsRCxNQUFNLGdCQUFnQixHQUFHLHVCQUF1QixDQUM1QyxTQUFTLENBQUMsUUFBZSxDQUM1QixDQUFDO1FBQ0YsTUFBTSxnQkFBZ0IsR0FBRyx1QkFBdUIsQ0FDNUMsU0FBUyxDQUFDLFFBQWUsQ0FDNUIsQ0FBQztRQUNGLE1BQU0sY0FBYyxHQUFHLFNBQTJCLENBQUM7UUFDbkQsTUFBTSxTQUFTLEdBQUcseUJBQXlCLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDNUQsTUFBTSxtQkFBbUIsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLG1CQUFtQixDQUMzRCxTQUFTLEVBQ1QsZ0JBQWdCLEVBQ2hCLGdCQUFnQixFQUNoQixJQUFJLENBQ1AsQ0FBQztRQUNGLElBQUksbUJBQW1CLEVBQUU7WUFDckIsSUFBSSxDQUFDLFVBQVUsQ0FBQywwQkFBMEIsQ0FDdEMsU0FBUyxFQUNULGdCQUFnQixFQUNoQixnQkFBZ0IsQ0FDbkIsQ0FBQztTQUNMO2FBQU07WUFDSCxNQUFNLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNqQixJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQztTQUNwQztRQUNELElBQUksQ0FBQyxjQUFjLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ3RDLENBQUM7SUFFTyxjQUFjLENBQUMsV0FBbUI7UUFDdEMsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUM1QyxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsS0FBSyxXQUFXLENBQ2pDLENBQUM7UUFDRixJQUFJLENBQUMsU0FBUyxFQUFFO1lBQ1osT0FBTztTQUNWO1FBQ0QsU0FBUyxDQUFDLEtBQUssR0FBRztZQUNkLEdBQUcsU0FBUyxDQUFDLEtBQUs7WUFDbEIsV0FBVyxFQUNQLFNBQVMsQ0FBQyxRQUFRO2dCQUNsQixTQUFTLENBQUMsUUFBUTtnQkFDbEIsU0FBUyxDQUFDLFFBQVEsS0FBSyxTQUFTLENBQUMsUUFBUTtnQkFDckMsQ0FBQyxDQUFDLG9CQUFvQjtnQkFDdEIsQ0FBQyxDQUFDLDBCQUEwQjtTQUN2QyxDQUFDO1FBQ0YsTUFBTSxpQkFBaUIsR0FBRyxTQUFzQixDQUFDO1FBQ2pELE1BQU0sY0FBYyxHQUFHLFNBQTJCLENBQUM7UUFDbkQsTUFBTSxTQUFTLEdBQUcseUJBQXlCLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDNUQsaUJBQWlCLENBQUMsV0FBVztZQUN6QixvQkFBb0IsQ0FBQyxPQUFPLEdBQUcsb0JBQW9CLENBQUMsYUFBYSxDQUFDO1FBQ3RFLElBQUksaUJBQWlCLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUU7WUFDcEMsaUJBQWlCLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU87Z0JBQ3BDLHNCQUFzQixDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQztTQUNwRDthQUFNO1lBQ0gsSUFBSSxDQUFDLFNBQVMsQ0FBQyxrQkFBa0IsQ0FDN0IsU0FBUyxFQUNULHNCQUFzQixDQUFDLFNBQVMsQ0FBQyxDQUNwQyxDQUFDO1NBQ0w7UUFDRCxJQUFJLENBQUMsb0JBQW9CLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUM3QyxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQzlCLENBQUM7SUFFTyxvQkFBb0IsQ0FBQyxTQUFvQjtRQUM3QyxNQUFNLGNBQWMsR0FBRyxTQUEyQixDQUFDO1FBQ25ELE1BQU0sU0FBUyxHQUFHLHlCQUF5QixDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQzVELElBQ0ksU0FBUztZQUNULGNBQWMsQ0FBQyxRQUFRO1lBQ3ZCLENBQUMsY0FBYyxDQUFDLFlBQVksRUFDOUI7WUFDRSxjQUFjLENBQUMsWUFBWSxHQUFHLEdBQUcsV0FBVyxJQUFJLFNBQVMsTUFBTSxDQUFDO1NBQ25FO1FBQ0QsSUFDSSxTQUFTO1lBQ1QsY0FBYyxDQUFDLFFBQVE7WUFDdkIsQ0FBQyxjQUFjLENBQUMsWUFBWSxFQUM5QjtZQUNFLGNBQWMsQ0FBQyxZQUFZLEdBQUcsR0FBRyxXQUFXLElBQUksZUFBZSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUM7U0FDcEY7SUFDTCxDQUFDO0lBRUQsc0JBQXNCLENBQUMsTUFBYyxFQUFFLElBQTZCO1FBQ2hFLElBQUksSUFBSSxFQUFFLEdBQUcsRUFBRTtZQUNYLElBQUksQ0FBQyxVQUFVLENBQUMsc0JBQXNCLENBQ2xDLHVCQUF1QixDQUFDLE1BQWEsQ0FBQyxFQUN0QyxJQUFJLENBQUMsR0FBVSxDQUNsQixDQUFDO1NBQ0w7SUFDTCxDQUFDO0lBRUQsb0JBQW9CLENBQUMsTUFBYyxFQUFFLElBQXFCO1FBQ3RELElBQUksQ0FBQyxVQUFVLENBQUMsb0JBQW9CLENBQ2hDLHVCQUF1QixDQUFDLE1BQWEsQ0FBQyxFQUN0QyxJQUFJLENBQ1AsQ0FBQztJQUNOLENBQUM7SUFFRCxVQUFVLENBQUMsU0FBb0I7UUFDM0IsTUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUMxQyxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsS0FBSyxTQUFTLENBQUMsRUFBRSxDQUMxQixDQUFDO1FBQ1YsWUFBWSxDQUFDLFdBQVcsR0FBRyxlQUFlLENBQUMsT0FBTyxDQUFDO1FBQ25ELElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQ3hDLENBQUM7SUFFTyxLQUFLLENBQUMsaUJBQWlCO1FBQzNCLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYTthQUMvQixhQUFhLENBQUMsYUFBYSxDQUFDO1lBQzdCLEVBQUUscUJBQXFCLEVBQUUsQ0FBQztRQUM5QixJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sR0FBRyxJQUFJLEVBQUUsTUFBTSxDQUFDO1FBQ3pDLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxHQUFHLElBQUksRUFBRSxLQUFLLENBQUM7SUFDM0MsQ0FBQztJQUVELFNBQVM7UUFDTCxPQUFPO0lBQ1gsQ0FBQztJQVlELDJCQUEyQjtRQUN2QixNQUFNLGVBQWUsR0FBRyxhQUFhLENBQ2pDLElBQUksQ0FBQyxTQUFTLEVBQUUsYUFBYSxDQUFDLEtBQUssSUFBSSxFQUFFLEVBQ3pDLElBQUksQ0FDUCxDQUFDO1FBQ0YsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQ3pCLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FDTCxDQUFDLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO1lBQy9CLENBQUMsQ0FBQyxJQUFJLENBQUMsZ0NBQWdDLEVBQUUsWUFBWSxDQUM1RCxDQUFDO0lBQ04sQ0FBQzsrR0FwaEJRLHdCQUF3QjttR0FBeEIsd0JBQXdCLDBJQUZ0QixDQUFDLEdBQUcseUJBQXlCLENBQUMsK0lBK0MzQixnQ0FBZ0MsZ0RDOUhsRCx5dkhBbUZBOzs0RkRGYSx3QkFBd0I7a0JBUHBDLFNBQVM7K0JBQ0ksMkJBQTJCLG1CQUdwQix1QkFBdUIsQ0FBQyxPQUFPLGFBQ3JDLENBQUMsR0FBRyx5QkFBeUIsQ0FBQzt5UEFJaEMsWUFBWTtzQkFBcEIsS0FBSztnQkFHRyxPQUFPO3NCQUFmLEtBQUs7Z0JBRUcsU0FBUztzQkFBakIsS0FBSztnQkFvQ2dCLFNBQVM7c0JBQTlCLFNBQVM7dUJBQUMsU0FBUztnQkFHcEIsU0FBUztzQkFEUixZQUFZO3VCQUFDLGdDQUFnQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHMtY29tbWVudCAqL1xyXG5pbXBvcnQge1xyXG4gICAgQWZ0ZXJWaWV3SW5pdCxcclxuICAgIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxyXG4gICAgQ29tcG9uZW50LFxyXG4gICAgRWxlbWVudFJlZixcclxuICAgIElucHV0LFxyXG4gICAgT25Jbml0LFxyXG4gICAgUXVlcnlMaXN0LFxyXG4gICAgVmlld0NoaWxkLFxyXG4gICAgVmlld0NoaWxkcmVuLFxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQge1xyXG4gICAgQ29ubmVjdG9yLFxyXG4gICAgQ29ubmVjdG9yQ29uc3RyYWludHMsXHJcbiAgICBEaWFncmFtQ29uc3RyYWludHMsXHJcbiAgICBEaWFncmFtVG9vbHMsXHJcbiAgICBJQ29sbGVjdGlvbkNoYW5nZUV2ZW50QXJncyxcclxuICAgIElDb25uZWN0aW9uQ2hhbmdlRXZlbnRBcmdzLFxyXG4gICAgSURyYWdnaW5nRXZlbnRBcmdzLFxyXG4gICAgSUVsZW1lbnREcmF3RXZlbnRBcmdzLFxyXG4gICAgSVNjcm9sbENoYW5nZUV2ZW50QXJncyxcclxuICAgIElTZWxlY3Rpb25DaGFuZ2VFdmVudEFyZ3MsXHJcbiAgICBOb2RlLFxyXG4gICAgTm9kZUNvbnN0cmFpbnRzLFxyXG4gICAgU25hcENvbnN0cmFpbnRzLFxyXG4gICAgU3ltYm9sUGFsZXR0ZUNvbXBvbmVudCxcclxuICAgIE5vZGVNb2RlbCBhcyBOb2RlTW9kZWxTeW5jZnVzaW9uLFxyXG59IGZyb20gJ0BzeW5jZnVzaW9uL2VqMi1hbmd1bGFyLWRpYWdyYW1zJztcclxuaW1wb3J0IHtcclxuICAgIE5nUmVzaXplT2JzZXJ2ZXIsXHJcbiAgICBuZ1Jlc2l6ZU9ic2VydmVyUHJvdmlkZXJzLFxyXG59IGZyb20gJ25nLXJlc2l6ZS1vYnNlcnZlcic7XHJcbmltcG9ydCB7IGRlYm91bmNlVGltZSwgc3RhcnRXaXRoIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7XHJcbiAgICBBemF2aXN0YVNoYXJlZFNlcnZpY2UsXHJcbiAgICBJVmFsdWVDaGFuZ2VzV2l0aE9iamVjdCxcclxufSBmcm9tICdAYXphdmlzdGEvY29tcG9uZW50cy9zaGFyZWQnO1xyXG5cclxuaW1wb3J0IHsgQ2FudmFzLCBPdXRwdXRQaW4gfSBmcm9tICdAYXphdmlzdGEvd29ya2Zsb3ctYnVpbGRlci1zaGFyZWQnO1xyXG5pbXBvcnQge1xyXG4gICAgQ29ubmVjdGlvblBvaW50Q2hhbmdlRXZlbnQsXHJcbiAgICBERUZBVUxUX0NPTk5FQ1RPUixcclxuICAgIERFRkFVTFRfRVJST1JfU1RST0tFX0NPTE9SLFxyXG4gICAgREVGQVVMVF9TVFJPS0VfQ09MT1IsXHJcbiAgICBERUZBVUxUX1NUUk9LRV9XSURUSCxcclxuICAgIEVsZW1lbnREcmF3Q29ubmVjdG9yRXZlbnQsXHJcbiAgICBPVVRQVVRfUElOX1BBSVIsXHJcbiAgICBQUkVGSVhfTk9ERSxcclxuICAgIFBSRUZJWF9QT1JULFxyXG4gICAgV09SS0ZMT1dfRVhQTEFOQVRJT05fVFJBTlNMQVRJT05TLFxyXG4gICAgV09SS0ZMT1dfTkFNRV9UUkFOU0xBVElPTlMsXHJcbn0gZnJvbSAnLi90eXBlcyc7XHJcbmltcG9ydCB7XHJcbiAgICBkZWxheSxcclxuICAgIGdldENvbm5lY3RvckFubm90YXRpb24sXHJcbiAgICBnZXRNYXBCeVZhbHVlLFxyXG4gICAgZ2V0Tm9kZUFuZENvbm5lY3RvcnNGcm9tQ2FudmFzQ29udHJvbGxlckRhdGEsXHJcbiAgICBnZXROb2RlRnJvbUNhbnZhc0NvbnRyb2xsZXJEYXRhLFxyXG4gICAgZ2V0T3V0cHV0UGluRnJvbUNvbm5lY3RvcixcclxuICAgIGdldFdvcmtmbG93SWRGcm9tTm9kZUlkLFxyXG4gICAgd29ya2Zsb3dUeXBlQXJyYXksXHJcbn0gZnJvbSAnLi91dGlscyc7XHJcbmltcG9ydCB7IFdvcmtmbG93QnVpbGRlclNlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2VzL3dvcmtmbG93LWJ1aWxkZXIuc2VydmljZSc7XHJcbmltcG9ydCB7XHJcbiAgICBBemF2aXN0YVdvcmtmbG93QnVpbGRlckNvbnRyb2xsZXIsXHJcbiAgICBXb3JrZmxvd0J1aWxkZXJQcm92aWRlckFic3RyYWN0LFxyXG59IGZyb20gJy4vd29ya2Zsb3ctYnVpbGRlci5jb250cm9sbGVyJztcclxuaW1wb3J0IHsgV29ya2Zsb3dCdWlsZGVyTm9kZUZvcm1Db21wb25lbnQgfSBmcm9tICcuL2NvbXBvbmVudHMvd29ya2Zsb3ctYnVpbGRlci1ub2RlLWZvcm0vd29ya2Zsb3ctYnVpbGRlci1ub2RlLWZvcm0uY29tcG9uZW50JztcclxuXHJcbmV4cG9ydCBjb25zdCBaT09NX0ZBQ1RPUl9PUFRJT05TOiBudW1iZXJbXSA9IFtcclxuICAgIDAuMSwgMC4yLCAwLjMsIDAuNCwgMC41LCAwLjYsIDAuNywgMC44LCAwLjksIDEsXHJcbl07XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnYXphdmlzdGEtd29ya2Zsb3ctYnVpbGRlcicsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vd29ya2Zsb3ctYnVpbGRlci5jb21wb25lbnQuaHRtbCcsXHJcbiAgICBzdHlsZVVybHM6IFsnLi93b3JrZmxvdy1idWlsZGVyLmNvbXBvbmVudC5zY3NzJ10sXHJcbiAgICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5LkRlZmF1bHQsXHJcbiAgICBwcm92aWRlcnM6IFsuLi5uZ1Jlc2l6ZU9ic2VydmVyUHJvdmlkZXJzXSxcclxufSlcclxuZXhwb3J0IGNsYXNzIFdvcmtmbG93QnVpbGRlckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCB7XHJcbiAgICAvKiogRmlsbCB0aGlzIHRvIHVzZSBjdXN0b20gZGF0YVByb3ZpZGVyICovXHJcbiAgICBASW5wdXQoKSBkYXRhUHJvdmlkZXI6IFdvcmtmbG93QnVpbGRlclByb3ZpZGVyQWJzdHJhY3QgPVxyXG4gICAgICAgIHRoaXMuYnVpbGRlclN2Yy5kYXRhUHJvdmlkZXI7XHJcblxyXG4gICAgQElucHV0KCkgZXZlbnRJZCE6IHN0cmluZztcclxuXHJcbiAgICBASW5wdXQoKSBkZWJ1Z01vZGUgPSBmYWxzZTtcclxuXHJcbiAgICBkaWFncmFtQ29uZmlnOiBQYXJ0aWFsPFxyXG4gICAgICAgIFBpY2s8XHJcbiAgICAgICAgICAgIERpYWdyYW0sXHJcbiAgICAgICAgICAgIHwgJ2NvbnN0cmFpbnRzJ1xyXG4gICAgICAgICAgICB8ICdzbmFwU2V0dGluZ3MnXHJcbiAgICAgICAgICAgIHwgJ2dldENvbm5lY3RvckRlZmF1bHRzJ1xyXG4gICAgICAgICAgICB8ICdoZWlnaHQnXHJcbiAgICAgICAgICAgIHwgJ3dpZHRoJ1xyXG4gICAgICAgICAgICB8ICdkcmF3aW5nT2JqZWN0J1xyXG4gICAgICAgICAgICB8ICd0b29sdGlwJ1xyXG4gICAgICAgID5cclxuICAgID4gPSB7XHJcbiAgICAgICAgY29uc3RyYWludHM6IERpYWdyYW1Db25zdHJhaW50cy5EZWZhdWx0LFxyXG4gICAgICAgIHNuYXBTZXR0aW5nczoge1xyXG4gICAgICAgICAgICBjb25zdHJhaW50czogU25hcENvbnN0cmFpbnRzLlNuYXBUb09iamVjdCxcclxuICAgICAgICB9LFxyXG4gICAgICAgIGdldENvbm5lY3RvckRlZmF1bHRzOiAoKSA9PiBERUZBVUxUX0NPTk5FQ1RPUixcclxuICAgICAgICBkcmF3aW5nT2JqZWN0OiB7IC4uLkRFRkFVTFRfQ09OTkVDVE9SIH0sXHJcbiAgICB9O1xyXG5cclxuICAgIHRvb2w6IERpYWdyYW1Ub29scyA9IERpYWdyYW1Ub29scy5TaW5nbGVTZWxlY3QgfCBEaWFncmFtVG9vbHMuWm9vbVBhbjtcclxuXHJcbiAgICBwYWxldHRlQ29uZmlnOiBQaWNrPFN5bWJvbFBhbGV0dGVDb21wb25lbnQsICdwYWxldHRlcycgfCAnZ2V0U3ltYm9sSW5mbyc+ID1cclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHBhbGV0dGVzOiBbXSxcclxuICAgICAgICAgICAgZ2V0U3ltYm9sSW5mbzogKCkgPT4ge30sXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICBpc0luaXRpYWxpemVkID0gZmFsc2U7XHJcblxyXG4gICAgem9vbU9wdGlvbnMgPSBaT09NX0ZBQ1RPUl9PUFRJT05TO1xyXG5cclxuICAgIGN1cnJlbnRab29tRmFjdG9yID0gMTtcclxuXHJcbiAgICBAVmlld0NoaWxkKCdkaWFncmFtJykgZGlhZ3JhbUVsITogRGlhZ3JhbTtcclxuXHJcbiAgICBAVmlld0NoaWxkcmVuKFdvcmtmbG93QnVpbGRlck5vZGVGb3JtQ29tcG9uZW50KVxyXG4gICAgbm9kZUZvcm1zPzogUXVlcnlMaXN0PFdvcmtmbG93QnVpbGRlck5vZGVGb3JtQ29tcG9uZW50PjtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIGJ1aWxkZXJTdmM6IFdvcmtmbG93QnVpbGRlclNlcnZpY2UsXHJcbiAgICAgICAgcHVibGljIGNvbnRyb2xsZXI6IEF6YXZpc3RhV29ya2Zsb3dCdWlsZGVyQ29udHJvbGxlcixcclxuICAgICAgICBwcml2YXRlIGhvc3Q6IEVsZW1lbnRSZWY8SFRNTEVsZW1lbnQ+LFxyXG4gICAgICAgIHByaXZhdGUgcmVzaXplJDogTmdSZXNpemVPYnNlcnZlcixcclxuICAgICAgICBwcml2YXRlIHNoYXJlZFN2YzogQXphdmlzdGFTaGFyZWRTZXJ2aWNlLFxyXG4gICAgKSB7fVxyXG5cclxuICAgIGFzeW5jIG5nT25Jbml0KCk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgICAgIHRoaXMuY29udHJvbGxlci5pc0RlYnVnQ2FsbGJhY2sgPSAoKSA9PiB0aGlzLmRlYnVnTW9kZTtcclxuICAgICAgICBpZiAodGhpcy5kYXRhUHJvdmlkZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5idWlsZGVyU3ZjLmRhdGFQcm92aWRlciA9IHRoaXMuZGF0YVByb3ZpZGVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXRoaXMuZXZlbnRJZCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXHJcbiAgICAgICAgICAgICAgICAnUGxlYXNlIGFzc2lnbiBldmVudElkIHRvIFdvcmtmbG93QnVpbGRlckNvbXBvbmVudCcsXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgICAgICBhd2FpdCBkZWxheSgwKTsgLy8gZGVsYXkgdG8gd2FpdCB1bnRpbCBodG1sIGlzIGZ1bGx5IHJlbmRlcmVkXHJcbiAgICAgICAgdGhpcy5yZXNpemUkLnBpcGUoc3RhcnRXaXRoKCksIGRlYm91bmNlVGltZSgxMDApKS5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZURpYWdyYW1TaXplKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgb25EaWFncmFtTG9hZCgpIHtcclxuICAgICAgICBhd2FpdCB0aGlzLmNvbnRyb2xsZXIuaW5pdEZyb21Qcm92aWRlcih0aGlzLmRhdGFQcm92aWRlciwgdGhpcy5ldmVudElkKTtcclxuICAgICAgICBjb25zdCB7IGNvbm5lY3RvcnMsIG5vZGVzIH0gPVxyXG4gICAgICAgICAgICBnZXROb2RlQW5kQ29ubmVjdG9yc0Zyb21DYW52YXNDb250cm9sbGVyRGF0YShcclxuICAgICAgICAgICAgICAgIE9iamVjdC52YWx1ZXModGhpcy5jb250cm9sbGVyLmRhdGFNYXApLFxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIG5vZGVzLmZvckVhY2goKG5vZGUpID0+XHJcbiAgICAgICAgICAgIHRoaXMuZGlhZ3JhbUVsLmFkZE5vZGUoe1xyXG4gICAgICAgICAgICAgICAgLi4ubm9kZSxcclxuICAgICAgICAgICAgICAgIHNoYXBlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ0hUTUwnLFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHN0eWxlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmlsbDogJ2JsdWUnLFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgfSksXHJcbiAgICAgICAgKTtcclxuICAgICAgICBjb25uZWN0b3JzLmZvckVhY2goKGNvbm5lY3RvcikgPT5cclxuICAgICAgICAgICAgdGhpcy5kaWFncmFtRWwuYWRkQ29ubmVjdG9yKGNvbm5lY3RvciksXHJcbiAgICAgICAgKTtcclxuICAgICAgICB0aGlzLmxvZyhcclxuICAgICAgICAgICAgJ29uRGlhZ3JhbUxvYWQgLSBjb250cm9sbGVyLmRhdGFNYXAnLFxyXG4gICAgICAgICAgICB0aGlzLmNvbnRyb2xsZXIuZGF0YU1hcCxcclxuICAgICAgICAgICAgbm9kZXMsXHJcbiAgICAgICAgICAgIGNvbm5lY3RvcnMsXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgdGhpcy5kaWFncmFtRWwucGFuKDAsIDApO1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIG9uUHVibGlzaCgpIHtcclxuICAgICAgICB0aGlzLmxvZygnb25QdWJsaXNoJywgdGhpcy5jb250cm9sbGVyLmdldEN1cnJlbnRTdGF0ZSgpKTtcclxuICAgICAgICB0aGlzLmNvbnRyb2xsZXIucHVibGlzaCgpO1xyXG4gICAgfVxyXG5cclxuICAgIGxvZyhsb2dOYW1lOiBzdHJpbmcsIC4uLnBhcmFtczogYW55W10pIHtcclxuICAgICAgICBpZiAodGhpcy5kZWJ1Z01vZGUpIHtcclxuICAgICAgICAgICAgY29uc29sZS5ncm91cENvbGxhcHNlZChsb2dOYW1lKTtcclxuICAgICAgICAgICAgY29uc29sZS50cmFjZShwYXJhbXMpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmdyb3VwRW5kKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRTeW1ib2xJbmZvKHN5bWJvbDogYW55KSB7XHJcbiAgICAgICAgLy8gRGVmaW5lcyB0aGUgc3ltYm9sIGRlc2NyaXB0aW9uXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgd2lkdGg6IDc1LFxyXG4gICAgICAgICAgICBoZWlnaHQ6IDQwLFxyXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogeyB0ZXh0OiBzeW1ib2wuYWRkSW5mb1snZGVzY3JpcHRpb24nXSB9LFxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgb25Db25uZWN0aW9uUG9pbnRDaGFuZ2UoZXZlbnQ6IENvbm5lY3Rpb25Qb2ludENoYW5nZUV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5sb2coJ2Nvbm5lY3Rpb25Qb2ludENoYW5nZScsIGV2ZW50KTtcclxuICAgICAgICBjb25zdCB7IGNvbm5lY3Rvciwgc3RhdGUgfSA9IGV2ZW50O1xyXG4gICAgICAgIGlmIChzdGF0ZSAhPT0gJ0NvbXBsZXRlZCcpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmhhbmRsZUNvbm5lY3RvclBvcnRzKGNvbm5lY3Rvcik7XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgb25FbGVtZW50RHJhdyhldmVudDogSUVsZW1lbnREcmF3RXZlbnRBcmdzKSB7XHJcbiAgICAgICAgdGhpcy5sb2coJ2VsZW1lbnREcmF3JywgZXZlbnQpO1xyXG4gICAgICAgIGNvbnN0IHsgb2JqZWN0VHlwZSwgc3RhdGUgfSA9IGV2ZW50O1xyXG4gICAgICAgIGlmIChzdGF0ZSA9PT0gJ1N0YXJ0Jykge1xyXG4gICAgICAgICAgICAvLyB0aGlzIGlzIHJlcXVpcmVkIHRvIHJlbW92ZSB0aGUgc2VsZWN0aW9uLWJvcmRlciB0aGF0IGNhdXNlcyB0aGUgY29ubmVjdG9yIHRvIGxvc2UgaXRzIHNvdXJjZUlkXHJcbiAgICAgICAgICAgIHRoaXMuZGlhZ3JhbUVsLnVuU2VsZWN0KGV2ZW50LnNvdXJjZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChzdGF0ZSAhPT0gJ0NvbXBsZXRlZCcpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzd2l0Y2ggKG9iamVjdFR5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSAnQ29ubmVjdG9yJzoge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY29ubmVjdG9yRXZlbnQgPVxyXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50IGFzIGFueSBhcyBFbGVtZW50RHJhd0Nvbm5lY3RvckV2ZW50O1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMub25Db25uZWN0aW9uQWRkZWRCeURyYXdpbmcoY29ubmVjdG9yRXZlbnQuc291cmNlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBhc3luYyBvbkNvbGxlY3Rpb25DaGFuZ2UoZXZlbnQ6IElDb2xsZWN0aW9uQ2hhbmdlRXZlbnRBcmdzKSB7XHJcbiAgICAgICAgdGhpcy5sb2coJ2NvbGxlY3Rpb25DaGFuZ2UnLCBldmVudCk7XHJcbiAgICAgICAgY29uc3QgeyB0eXBlLCBzdGF0ZSwgZWxlbWVudCB9ID0gZXZlbnQ7XHJcbiAgICAgICAgaWYgKHN0YXRlICE9PSAnQ2hhbmdlZCcpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZWxlbWVudCBpbnN0YW5jZW9mIE5vZGUpIHtcclxuICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdBZGRpdGlvbic6IHtcclxuICAgICAgICAgICAgICAgICAgICBhd2FpdCBkZWxheSgzMDApO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMub25Ecm9wUGFsZXR0ZShlbGVtZW50IGFzIGFueSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjYXNlICdSZW1vdmFsJzoge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGVsZXRlV29ya2Zsb3coXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdldFdvcmtmbG93SWRGcm9tTm9kZUlkKGVsZW1lbnQuaWQgYXMgYW55KSxcclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChlbGVtZW50IGluc3RhbmNlb2YgQ29ubmVjdG9yKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnUmVtb3ZhbCc6IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBzb3VyY2VXb3JrZmxvd0lkID0gZ2V0V29ya2Zsb3dJZEZyb21Ob2RlSWQoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuc291cmNlSUQgYXMgYW55LFxyXG4gICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0V29ya2Zsb3dJZCA9IGdldFdvcmtmbG93SWRGcm9tTm9kZUlkKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnRhcmdldElEIGFzIGFueSxcclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGVsZW1lbnRDb25uZWN0b3IgPVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50IGFzIENvbm5lY3Rvck1vZGVsPE91dHB1dFBpbj47XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc291cmNlV29ya2Zsb3cgPVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xsZXIuZGF0YU1hcFtzb3VyY2VXb3JrZmxvd0lkXTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBvdXRwdXRQaW4gPVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRPdXRwdXRQaW5Gcm9tQ29ubmVjdG9yKGVsZW1lbnRDb25uZWN0b3IpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0V29ya2Zsb3dJZCA9PT1cclxuICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlV29ya2Zsb3c/LmZhY3RvcnkuZ2V0TmV4dFdvcmtmbG93cygpW291dHB1dFBpbl1cclxuICAgICAgICAgICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250cm9sbGVyLnVwZGF0ZVdvcmtmbG93TmV4dFdvcmtmbG93KFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0UGluLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlV29ya2Zsb3dJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bGwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY2FzZSAnQWRkaXRpb24nOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgb25TZWxlY3Rpb25DaGFuZ2UoZXZlbnQ6IElTZWxlY3Rpb25DaGFuZ2VFdmVudEFyZ3MpIHtcclxuICAgICAgICB0aGlzLmxvZygnc2VsZWN0aW9uQ2hhbmdlJywgZXZlbnQpO1xyXG4gICAgICAgIGNvbnN0IHsgc3RhdGUgfSA9IGV2ZW50O1xyXG4gICAgICAgIGlmIChzdGF0ZSAhPT0gJ0NoYW5nZWQnKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGhhbmRsZSBjb25uZWN0b3JzIHNlbGVjdGlvbiBpbmRpY2F0b3JcclxuICAgICAgICBjb25zdCBzZWxlY3RlZENvbm5lY3RvcnNNYXBzID0gZ2V0TWFwQnlWYWx1ZShcclxuICAgICAgICAgICAgdGhpcy5kaWFncmFtRWwuc2VsZWN0ZWRJdGVtcy5jb25uZWN0b3JzID8/IFtdLFxyXG4gICAgICAgICAgICAnaWQnLFxyXG4gICAgICAgICk7XHJcbiAgICAgICAgdGhpcy5kaWFncmFtRWwuY29ubmVjdG9ycy5mb3JFYWNoKChpdGVtKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkU3Ryb2tlV2lkdGggPSBERUZBVUxUX1NUUk9LRV9XSURUSCAqIDI7XHJcbiAgICAgICAgICAgIGNvbnN0IGlzU2VsZWN0ZWRJdGVtID0gISFzZWxlY3RlZENvbm5lY3RvcnNNYXBzW2l0ZW0uaWQhXTtcclxuICAgICAgICAgICAgaWYgKGl0ZW0uc3R5bGU/LnN0cm9rZVdpZHRoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5zdHlsZS5zdHJva2VXaWR0aCAhPT0gREVGQVVMVF9TVFJPS0VfV0lEVEggJiZcclxuICAgICAgICAgICAgICAgICAgICAhaXNTZWxlY3RlZEl0ZW1cclxuICAgICAgICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uc3R5bGUuc3Ryb2tlV2lkdGggPSBERUZBVUxUX1NUUk9LRV9XSURUSDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChcclxuICAgICAgICAgICAgICAgICAgICBpdGVtLnN0eWxlLnN0cm9rZVdpZHRoICE9PSBzZWxlY3RlZFN0cm9rZVdpZHRoICYmXHJcbiAgICAgICAgICAgICAgICAgICAgaXNTZWxlY3RlZEl0ZW1cclxuICAgICAgICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uc3R5bGUuc3Ryb2tlV2lkdGggPSBzZWxlY3RlZFN0cm9rZVdpZHRoO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIG1ha2Ugc2VsZWN0ZWQgbm9kZSBvbiB0b3Agb2Ygei1pbmRleFxyXG4gICAgICAgIGNvbnN0IHNlbGVjdGVkTm9kZXNNYXBzID0gZ2V0TWFwQnlWYWx1ZShcclxuICAgICAgICAgICAgdGhpcy5kaWFncmFtRWwuc2VsZWN0ZWRJdGVtcy5ub2RlcyA/PyBbXSxcclxuICAgICAgICAgICAgJ2lkJyxcclxuICAgICAgICApO1xyXG4gICAgICAgIHRoaXMuZGlhZ3JhbUVsLm5vZGVzLmZvckVhY2goKGl0ZW0pID0+IHtcclxuICAgICAgICAgICAgY29uc3QgaXNTZWxlY3RlZEl0ZW0gPSAhIXNlbGVjdGVkTm9kZXNNYXBzW2l0ZW0uaWRdO1xyXG4gICAgICAgICAgICBjb25zdCBub2RlRWxlbWVudCA9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmhvc3QubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yPEhUTUxEaXZFbGVtZW50PihcclxuICAgICAgICAgICAgICAgICAgICBgIyR7aXRlbS5pZH1fY29udGVudF9odG1sX2VsZW1lbnRgLFxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgaWYgKG5vZGVFbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICBub2RlRWxlbWVudC5jbGFzc0xpc3QudG9nZ2xlKFxyXG4gICAgICAgICAgICAgICAgICAgICdkaWFncmFtLW5vZGVfX3NlbGVjdGVkJyxcclxuICAgICAgICAgICAgICAgICAgICBpc1NlbGVjdGVkSXRlbSxcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBvblNjcm9sbENoYW5nZShldmVudDogSVNjcm9sbENoYW5nZUV2ZW50QXJncykge1xyXG4gICAgICAgIHRoaXMubG9nKCdvblNjcm9sbENoYW5nZScsIGV2ZW50KTtcclxuICAgICAgICB0aGlzLmN1cnJlbnRab29tRmFjdG9yID0gZXZlbnQubmV3VmFsdWUuQ3VycmVudFpvb207XHJcbiAgICB9XHJcblxyXG4gICAgZGVsZXRlV29ya2Zsb3cod29ya2Zsb3dJZDogc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5jb250cm9sbGVyLmRlbGV0ZVdvcmtmbG93KHdvcmtmbG93SWQpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiBIYW5kbGUgd2hlbiBkcmFnZ2luZyB0aGUgdGlwIGVuZC9zdGFydCBvZiBhIGNvbm5lY3RvciAqL1xyXG4gICAgYXN5bmMgb25Db25uZWN0aW9uQ2hhbmdlKGV2ZW50OiBJQ29ubmVjdGlvbkNoYW5nZUV2ZW50QXJncykge1xyXG4gICAgICAgIHRoaXMubG9nKCdjb25uZWN0aW9uQ2hhbmdlJywgZXZlbnQpO1xyXG4gICAgICAgIGNvbnN0IHsgc3RhdGUsIG5ld1ZhbHVlLCBvbGRWYWx1ZSwgY29ubmVjdG9yRW5kLCBjb25uZWN0b3IgfSA9IGV2ZW50O1xyXG4gICAgICAgIGlmIChzdGF0ZSAhPT0gJ0NoYW5nZWQnKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgIGNvbnN0IG5ld1ZhbHVlTm9kZUlkOiBzdHJpbmcgfCB1bmRlZmluZWQgPSBuZXdWYWx1ZS5ub2RlSWQ7XHJcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgIGNvbnN0IG9sZFZhbHVlTm9kZUlkOiBzdHJpbmcgfCB1bmRlZmluZWQgPSBvbGRWYWx1ZS5ub2RlSWQ7XHJcbiAgICAgICAgY29uc3QgY29ubmVjdG9yTW9kZWwgPSBjb25uZWN0b3IgYXMgQ29ubmVjdG9yTW9kZWw8T3V0cHV0UGluPjtcclxuICAgICAgICBjb25zdCBvdXRwdXRQaW4gPSBnZXRPdXRwdXRQaW5Gcm9tQ29ubmVjdG9yKGNvbm5lY3Rvck1vZGVsKTtcclxuICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgIG5ld1ZhbHVlTm9kZUlkICE9IG51bGwgJiZcclxuICAgICAgICAgICAgb2xkVmFsdWVOb2RlSWQgIT0gbnVsbCAmJlxyXG4gICAgICAgICAgICBuZXdWYWx1ZU5vZGVJZCAhPT0gb2xkVmFsdWVOb2RlSWRcclxuICAgICAgICApIHtcclxuICAgICAgICAgICAgaWYgKGNvbm5lY3RvckVuZCA9PT0gJ0Nvbm5lY3RvclNvdXJjZUVuZCcpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG9sZFdvcmtmbG93U291cmNlSWQgPSBnZXRXb3JrZmxvd0lkRnJvbU5vZGVJZChcclxuICAgICAgICAgICAgICAgICAgICBvbGRWYWx1ZU5vZGVJZCBhcyBhbnksXHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbmV3V29ya2Zsb3dTb3VyY2VJZCA9IGdldFdvcmtmbG93SWRGcm9tTm9kZUlkKFxyXG4gICAgICAgICAgICAgICAgICAgIG5ld1ZhbHVlTm9kZUlkIGFzIGFueSxcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdXb3JrZmxvd1RhcmdldElkID0gY29ubmVjdG9yLnRhcmdldElEXHJcbiAgICAgICAgICAgICAgICAgICAgPyBnZXRXb3JrZmxvd0lkRnJvbU5vZGVJZChjb25uZWN0b3IudGFyZ2V0SUQgYXMgYW55KVxyXG4gICAgICAgICAgICAgICAgICAgIDogbnVsbDtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGlzVmFsaWROZXh0V29ya2Zsb3cgPSB0aGlzLmNvbnRyb2xsZXIuaXNWYWxpZE5leHRXb3JrZmxvdyhcclxuICAgICAgICAgICAgICAgICAgICBvdXRwdXRQaW4sXHJcbiAgICAgICAgICAgICAgICAgICAgbmV3V29ya2Zsb3dTb3VyY2VJZCxcclxuICAgICAgICAgICAgICAgICAgICBuZXdXb3JrZmxvd1RhcmdldElkLFxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIGlmIChpc1ZhbGlkTmV4dFdvcmtmbG93KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250cm9sbGVyLnVwZGF0ZVdvcmtmbG93TmV4dFdvcmtmbG93KFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRQaW4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9sZFdvcmtmbG93U291cmNlSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG51bGwsXHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWVOb2RlSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250cm9sbGVyLnVwZGF0ZVdvcmtmbG93TmV4dFdvcmtmbG93KFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0UGluLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3V29ya2Zsb3dTb3VyY2VJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1dvcmtmbG93VGFyZ2V0SWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25uZWN0b3Iuc291cmNlSUQgPSBvbGRWYWx1ZU5vZGVJZDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgICAgICBjb25uZWN0b3JFbmQgPT09ICdDb25uZWN0b3JUYXJnZXRFbmQnICYmXHJcbiAgICAgICAgICAgICAgICBjb25uZWN0b3Iuc291cmNlSUQ/LnN0YXJ0c1dpdGgoUFJFRklYX05PREUpXHJcbiAgICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgd29ya2Zsb3dTb3VyY2VJZCA9IGdldFdvcmtmbG93SWRGcm9tTm9kZUlkKFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rvci5zb3VyY2VJRCBhcyBhbnksXHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbmV3V29ya2Zsb3dUYXJnZXRJZCA9IG5ld1ZhbHVlTm9kZUlkXHJcbiAgICAgICAgICAgICAgICAgICAgPyBnZXRXb3JrZmxvd0lkRnJvbU5vZGVJZChuZXdWYWx1ZU5vZGVJZCBhcyBhbnkpXHJcbiAgICAgICAgICAgICAgICAgICAgOiBudWxsO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaXNWYWxpZE5leHRXb3JrZmxvdyA9IHRoaXMuY29udHJvbGxlci5pc1ZhbGlkTmV4dFdvcmtmbG93KFxyXG4gICAgICAgICAgICAgICAgICAgIG91dHB1dFBpbixcclxuICAgICAgICAgICAgICAgICAgICB3b3JrZmxvd1NvdXJjZUlkLFxyXG4gICAgICAgICAgICAgICAgICAgIG5ld1dvcmtmbG93VGFyZ2V0SWQsXHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgaWYgKGlzVmFsaWROZXh0V29ya2Zsb3cpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xsZXIudXBkYXRlV29ya2Zsb3dOZXh0V29ya2Zsb3coXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dFBpbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgd29ya2Zsb3dTb3VyY2VJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3V29ya2Zsb3dUYXJnZXRJZCxcclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25uZWN0b3IudGFyZ2V0SUQgPSBvbGRWYWx1ZU5vZGVJZDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmNoZWNrQ29ubmVjdG9yKGNvbm5lY3Rvci5pZCEpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYXN5bmMgb25Ecm9wUGFsZXR0ZShub2RlOiBOb2RlTW9kZWxGb3JQYWxldHRlIHwgTm9kZU1vZGVsKSB7XHJcbiAgICAgICAgY29uc3QgcGFsZXR0ZUFkZEluZm86IE5vZGVNb2RlbEZvclBhbGV0dGVbJ2FkZEluZm8nXSB8IHVuZGVmaW5lZCA9IChcclxuICAgICAgICAgICAgbm9kZSBhcyBOb2RlTW9kZWxGb3JQYWxldHRlXHJcbiAgICAgICAgKT8uYWRkSW5mbztcclxuICAgICAgICBpZiAod29ya2Zsb3dUeXBlQXJyYXkuaW5jbHVkZXMocGFsZXR0ZUFkZEluZm8/LnR5cGUpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG5ld0NvbnRyb2xsZXJEYXRhID0gdGhpcy5jb250cm9sbGVyLmFkZFdvcmtmbG93KFxyXG4gICAgICAgICAgICAgICAgcGFsZXR0ZUFkZEluZm8/LnR5cGUsXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29vcmRpbmF0ZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB4OiBub2RlLm9mZnNldFghLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB5OiBub2RlLm9mZnNldFkhLFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogdGhpcy5zaGFyZWRTdmMudHJhbnNsYXRlKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBXT1JLRkxPV19OQU1FX1RSQU5TTEFUSU9OU1twYWxldHRlQWRkSW5mby50eXBlXSxcclxuICAgICAgICAgICAgICAgICAgICApLFxyXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLnNoYXJlZFN2Yy50cmFuc2xhdGUoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFdPUktGTE9XX0VYUExBTkFUSU9OX1RSQU5TTEFUSU9OU1twYWxldHRlQWRkSW5mby50eXBlXSxcclxuICAgICAgICAgICAgICAgICAgICApLFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgY29uc3QgbmV3Tm9kZURhdGEgPVxyXG4gICAgICAgICAgICAgICAgZ2V0Tm9kZUZyb21DYW52YXNDb250cm9sbGVyRGF0YShuZXdDb250cm9sbGVyRGF0YSk7XHJcbiAgICAgICAgICAgIHRoaXMuZGlhZ3JhbUVsLmFkZE5vZGUobmV3Tm9kZURhdGEpO1xyXG4gICAgICAgICAgICB0aGlzLmRpYWdyYW1FbC5yZW1vdmUobm9kZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uUG9zaXRpb25DaGFuZ2UoZXZlbnQ6IElEcmFnZ2luZ0V2ZW50QXJncykge1xyXG4gICAgICAgIHRoaXMubG9nKCdwb3NpdGlvbkNoYW5nZScsIGV2ZW50KTtcclxuICAgICAgICBjb25zdCB7IHN0YXRlLCBuZXdWYWx1ZSwgc291cmNlIH0gPSBldmVudDtcclxuICAgICAgICBpZiAoc3RhdGUgIT09ICdDb21wbGV0ZWQnKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3Qgc291cmNlTm9kZTogUGFydGlhbDxOb2RlPiA9IHNvdXJjZSBhcyBhbnk7XHJcbiAgICAgICAgaWYgKHNvdXJjZU5vZGU/LmlkPy5zdGFydHNXaXRoKFBSRUZJWF9OT0RFKSkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRyb2xsZXIudXBkYXRlV29ya2Zsb3dDb29yZGluYXRlKFxyXG4gICAgICAgICAgICAgICAgZ2V0V29ya2Zsb3dJZEZyb21Ob2RlSWQoc291cmNlTm9kZS5pZCBhcyBhbnkpLFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHg6IG5ld1ZhbHVlLm9mZnNldFghLFxyXG4gICAgICAgICAgICAgICAgICAgIHk6IG5ld1ZhbHVlLm9mZnNldFkhLFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBhc3luYyBvbkNvbm5lY3Rpb25BZGRlZEJ5RHJhd2luZyhjb25uZWN0b3I6IENvbm5lY3Rvcikge1xyXG4gICAgICAgIHRoaXMubG9nKCdvbkNvbm5lY3Rpb25BZGRlZEJ5RHJhd2luZycsIGNvbm5lY3Rvcik7XHJcbiAgICAgICAgY29uc3Qgd29ya2Zsb3dTb3VyY2VJZCA9IGdldFdvcmtmbG93SWRGcm9tTm9kZUlkKFxyXG4gICAgICAgICAgICBjb25uZWN0b3Iuc291cmNlSUQgYXMgYW55LFxyXG4gICAgICAgICk7XHJcbiAgICAgICAgY29uc3Qgd29ya2Zsb3dUYXJnZXRJZCA9IGdldFdvcmtmbG93SWRGcm9tTm9kZUlkKFxyXG4gICAgICAgICAgICBjb25uZWN0b3IudGFyZ2V0SUQgYXMgYW55LFxyXG4gICAgICAgICk7XHJcbiAgICAgICAgY29uc3QgY29ubmVjdG9yTW9kZWwgPSBjb25uZWN0b3IgYXMgQ29ubmVjdG9yTW9kZWw7XHJcbiAgICAgICAgY29uc3Qgb3V0cHV0UGluID0gZ2V0T3V0cHV0UGluRnJvbUNvbm5lY3Rvcihjb25uZWN0b3JNb2RlbCk7XHJcbiAgICAgICAgY29uc3QgaXNWYWxpZE5leHRXb3JrZmxvdyA9IHRoaXMuY29udHJvbGxlci5pc1ZhbGlkTmV4dFdvcmtmbG93KFxyXG4gICAgICAgICAgICBvdXRwdXRQaW4sXHJcbiAgICAgICAgICAgIHdvcmtmbG93U291cmNlSWQsXHJcbiAgICAgICAgICAgIHdvcmtmbG93VGFyZ2V0SWQsXHJcbiAgICAgICAgICAgIHRydWUsXHJcbiAgICAgICAgKTtcclxuICAgICAgICBpZiAoaXNWYWxpZE5leHRXb3JrZmxvdykge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRyb2xsZXIudXBkYXRlV29ya2Zsb3dOZXh0V29ya2Zsb3coXHJcbiAgICAgICAgICAgICAgICBvdXRwdXRQaW4sXHJcbiAgICAgICAgICAgICAgICB3b3JrZmxvd1NvdXJjZUlkLFxyXG4gICAgICAgICAgICAgICAgd29ya2Zsb3dUYXJnZXRJZCxcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBhd2FpdCBkZWxheSgzMDApO1xyXG4gICAgICAgICAgICB0aGlzLmRpYWdyYW1FbC5yZW1vdmUoY29ubmVjdG9yKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jaGVja0Nvbm5lY3Rvcihjb25uZWN0b3IuaWQpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY2hlY2tDb25uZWN0b3IoY29ubmVjdG9ySWQ6IHN0cmluZykge1xyXG4gICAgICAgIGNvbnN0IGNvbm5lY3RvciA9IHRoaXMuZGlhZ3JhbUVsLmNvbm5lY3RvcnMuZmluZChcclxuICAgICAgICAgICAgKHsgaWQgfSkgPT4gaWQgPT09IGNvbm5lY3RvcklkLFxyXG4gICAgICAgICk7XHJcbiAgICAgICAgaWYgKCFjb25uZWN0b3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25uZWN0b3Iuc3R5bGUgPSB7XHJcbiAgICAgICAgICAgIC4uLmNvbm5lY3Rvci5zdHlsZSxcclxuICAgICAgICAgICAgc3Ryb2tlQ29sb3I6XHJcbiAgICAgICAgICAgICAgICBjb25uZWN0b3Iuc291cmNlSUQgJiZcclxuICAgICAgICAgICAgICAgIGNvbm5lY3Rvci50YXJnZXRJRCAmJlxyXG4gICAgICAgICAgICAgICAgY29ubmVjdG9yLnNvdXJjZUlEICE9PSBjb25uZWN0b3IudGFyZ2V0SURcclxuICAgICAgICAgICAgICAgICAgICA/IERFRkFVTFRfU1RST0tFX0NPTE9SXHJcbiAgICAgICAgICAgICAgICAgICAgOiBERUZBVUxUX0VSUk9SX1NUUk9LRV9DT0xPUixcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IGNvbm5lY3Rvckluc3RhbmNlID0gY29ubmVjdG9yIGFzIENvbm5lY3RvcjtcclxuICAgICAgICBjb25zdCBjb25uZWN0b3JNb2RlbCA9IGNvbm5lY3RvciBhcyBDb25uZWN0b3JNb2RlbDtcclxuICAgICAgICBjb25zdCBvdXRwdXRQaW4gPSBnZXRPdXRwdXRQaW5Gcm9tQ29ubmVjdG9yKGNvbm5lY3Rvck1vZGVsKTtcclxuICAgICAgICBjb25uZWN0b3JJbnN0YW5jZS5jb25zdHJhaW50cyA9XHJcbiAgICAgICAgICAgIENvbm5lY3RvckNvbnN0cmFpbnRzLkRlZmF1bHQgLSBDb25uZWN0b3JDb25zdHJhaW50cy5EcmFnU291cmNlRW5kO1xyXG4gICAgICAgIGlmIChjb25uZWN0b3JJbnN0YW5jZS5hbm5vdGF0aW9ucz8uWzBdKSB7XHJcbiAgICAgICAgICAgIGNvbm5lY3Rvckluc3RhbmNlLmFubm90YXRpb25zWzBdLmNvbnRlbnQgPVxyXG4gICAgICAgICAgICAgICAgZ2V0Q29ubmVjdG9yQW5ub3RhdGlvbihvdXRwdXRQaW4pWzBdLmNvbnRlbnQ7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5kaWFncmFtRWwuYWRkQ29ubmVjdG9yTGFiZWxzKFxyXG4gICAgICAgICAgICAgICAgY29ubmVjdG9yLFxyXG4gICAgICAgICAgICAgICAgZ2V0Q29ubmVjdG9yQW5ub3RhdGlvbihvdXRwdXRQaW4pLFxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmhhbmRsZUNvbm5lY3RvclBvcnRzKGNvbm5lY3Rvckluc3RhbmNlKTtcclxuICAgICAgICB0aGlzLmRpYWdyYW1FbC5kYXRhQmluZCgpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaGFuZGxlQ29ubmVjdG9yUG9ydHMoY29ubmVjdG9yOiBDb25uZWN0b3IpIHtcclxuICAgICAgICBjb25zdCBjb25uZWN0b3JNb2RlbCA9IGNvbm5lY3RvciBhcyBDb25uZWN0b3JNb2RlbDtcclxuICAgICAgICBjb25zdCBvdXRwdXRQaW4gPSBnZXRPdXRwdXRQaW5Gcm9tQ29ubmVjdG9yKGNvbm5lY3Rvck1vZGVsKTtcclxuICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgIG91dHB1dFBpbiAmJlxyXG4gICAgICAgICAgICBjb25uZWN0b3JNb2RlbC5zb3VyY2VJRCAmJlxyXG4gICAgICAgICAgICAhY29ubmVjdG9yTW9kZWwuc291cmNlUG9ydElEXHJcbiAgICAgICAgKSB7XHJcbiAgICAgICAgICAgIGNvbm5lY3Rvck1vZGVsLnNvdXJjZVBvcnRJRCA9IGAke1BSRUZJWF9QT1JUfV8ke291dHB1dFBpbn1fcGluYDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICBvdXRwdXRQaW4gJiZcclxuICAgICAgICAgICAgY29ubmVjdG9yTW9kZWwudGFyZ2V0SUQgJiZcclxuICAgICAgICAgICAgIWNvbm5lY3Rvck1vZGVsLnRhcmdldFBvcnRJRFxyXG4gICAgICAgICkge1xyXG4gICAgICAgICAgICBjb25uZWN0b3JNb2RlbC50YXJnZXRQb3J0SUQgPSBgJHtQUkVGSVhfUE9SVH1fJHtPVVRQVVRfUElOX1BBSVJbb3V0cHV0UGluXX1fcGluYDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlV29ya2Zsb3dTZXR0aW5ncyhub2RlSWQ6IHN0cmluZywgZGF0YTogSVZhbHVlQ2hhbmdlc1dpdGhPYmplY3QpIHtcclxuICAgICAgICBpZiAoZGF0YT8ub2JqKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29udHJvbGxlci51cGRhdGVXb3JrZmxvd1NldHRpbmdzKFxyXG4gICAgICAgICAgICAgICAgZ2V0V29ya2Zsb3dJZEZyb21Ob2RlSWQobm9kZUlkIGFzIGFueSksXHJcbiAgICAgICAgICAgICAgICBkYXRhLm9iaiBhcyBhbnksXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZVdvcmtmbG93Q2FudmFzKG5vZGVJZDogc3RyaW5nLCBkYXRhOiBQYXJ0aWFsPENhbnZhcz4pIHtcclxuICAgICAgICB0aGlzLmNvbnRyb2xsZXIudXBkYXRlV29ya2Zsb3dDYW52YXMoXHJcbiAgICAgICAgICAgIGdldFdvcmtmbG93SWRGcm9tTm9kZUlkKG5vZGVJZCBhcyBhbnkpLFxyXG4gICAgICAgICAgICBkYXRhLFxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgZGVsZXRlTm9kZShub2RlTW9kZWw6IE5vZGVNb2RlbCkge1xyXG4gICAgICAgIGNvbnN0IG5vZGVJbnN0YW5jZSA9IHRoaXMuZGlhZ3JhbUVsLm5vZGVzLmZpbmQoXHJcbiAgICAgICAgICAgICh7IGlkIH0pID0+IGlkID09PSBub2RlTW9kZWwuaWQsXHJcbiAgICAgICAgKSBhcyBOb2RlO1xyXG4gICAgICAgIG5vZGVJbnN0YW5jZS5jb25zdHJhaW50cyA9IE5vZGVDb25zdHJhaW50cy5EZWZhdWx0O1xyXG4gICAgICAgIHRoaXMuZGlhZ3JhbUVsLnJlbW92ZShub2RlSW5zdGFuY2UpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYXN5bmMgdXBkYXRlRGlhZ3JhbVNpemUoKSB7XHJcbiAgICAgICAgY29uc3QgcmVjdCA9IHRoaXMuaG9zdC5uYXRpdmVFbGVtZW50XHJcbiAgICAgICAgICAgIC5xdWVyeVNlbGVjdG9yKCdlanMtZGlhZ3JhbScpXHJcbiAgICAgICAgICAgID8uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgICAgdGhpcy5kaWFncmFtQ29uZmlnLmhlaWdodCA9IHJlY3Q/LmhlaWdodDtcclxuICAgICAgICB0aGlzLmRpYWdyYW1Db25maWcud2lkdGggPSByZWN0Py53aWR0aDtcclxuICAgIH1cclxuXHJcbiAgICBzYXZlU3RhdGUoKSB7XHJcbiAgICAgICAgLy8gVE9ET1xyXG4gICAgfVxyXG5cclxuICAgIGhhc05vZGVTZWxlY3RlZEFuZEV4cGFuZGVkID0gKHNlbGVjdGVkTm9kZXM6IE5vZGVNb2RlbFN5bmNmdXNpb25bXSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHNlbGVjdGVkTm9kZU1hcCA9IGdldE1hcEJ5VmFsdWUoc2VsZWN0ZWROb2RlcywgJ2lkJyk7XHJcbiAgICAgICAgcmV0dXJuICEhdGhpcy5ub2RlRm9ybXM/LnNvbWUoXHJcbiAgICAgICAgICAgIChub2RlKSA9PlxyXG4gICAgICAgICAgICAgICAgISFzZWxlY3RlZE5vZGVNYXBbbm9kZS5ub2RlLmlkXSAmJlxyXG4gICAgICAgICAgICAgICAgKCEhbm9kZS5mb3JtSGVhZGVyPy5lZGl0TW9kZSB8fFxyXG4gICAgICAgICAgICAgICAgICAgICEhbm9kZS53b3JrZmxvd1NldHRpbmdzR3JvdXBlZEZpZWxkRGF0YT8uZXhwYW5kUGFuZWxzKSxcclxuICAgICAgICApO1xyXG4gICAgfTtcclxuXHJcbiAgICBoYXNOb2RlU2VsZWN0ZWRBbmRFeHBhbmRlZDIoKSB7XHJcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWROb2RlTWFwID0gZ2V0TWFwQnlWYWx1ZShcclxuICAgICAgICAgICAgdGhpcy5kaWFncmFtRWw/LnNlbGVjdGVkSXRlbXMubm9kZXMgPz8gW10sXHJcbiAgICAgICAgICAgICdpZCcsXHJcbiAgICAgICAgKTtcclxuICAgICAgICByZXR1cm4gISF0aGlzLm5vZGVGb3Jtcz8uc29tZShcclxuICAgICAgICAgICAgKG5vZGUpID0+XHJcbiAgICAgICAgICAgICAgICAhIXNlbGVjdGVkTm9kZU1hcFtub2RlLm5vZGUuaWRdICYmXHJcbiAgICAgICAgICAgICAgICAhIW5vZGUud29ya2Zsb3dTZXR0aW5nc0dyb3VwZWRGaWVsZERhdGE/LmV4cGFuZFBhbmVscyxcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIGFyZVdvcmtmbG93c1ZhbGlkID0gKFxyXG4gICAgICAgIHZhbGlkaXR5TWFwOiBBemF2aXN0YVdvcmtmbG93QnVpbGRlckNvbnRyb2xsZXJbJ3ZhbGlkaXR5TWFwJ10sXHJcbiAgICApID0+IHtcclxuICAgICAgICByZXR1cm4gT2JqZWN0LnZhbHVlcyh2YWxpZGl0eU1hcCkuZXZlcnkoKGlzVmFsaWQpID0+IGlzVmFsaWQpO1xyXG4gICAgfTtcclxufVxyXG4iLCI8ZGl2IGNsYXNzPVwid29ya2Zsb3ctYnVpbGRlci1kaXZcIj5cclxuICA8ZGl2IGNsYXNzPVwid29ya2Zsb3ctYnVpbGRlci1kaXZfX2RpYWdyYW0tYXJlYVwiPlxyXG4gICAgPGRpdiBjbGFzcz1cIndvcmtmbG93LWJ1aWxkZXItZGl2X19kaWFncmFtLWFyZWFfX3Rvb2xiYXJcIj5cclxuICAgICAgPGRpdiBjbGFzcz1cIndvcmtmbG93LWJ1aWxkZXItZGl2X19kaWFncmFtLWFyZWFfX3Rvb2xiYXJfX2xlZnRcIj5cclxuICAgICAgICA8YXphdmlzdGEtYnV0dG9uXHJcbiAgICAgICAgICBbZGlzYWJsZWRdPVwiIShjb250cm9sbGVyLnZhbGlkaXR5TWFwfCBhcHBseSA6IGFyZVdvcmtmbG93c1ZhbGlkKVwiXHJcbiAgICAgICAgICAoY2xpY2spPVwib25QdWJsaXNoKClcIlxyXG4gICAgICAgICAgY29sb3I9XCJwcmltYXJ5XCI+e3tcclxuICAgICAgICAgIFwiUFVCTElTSFwiIHwgdHJhbnNsYXRlXHJcbiAgICAgICAgfX08L2F6YXZpc3RhLWJ1dHRvbj5cclxuICAgICAgPC9kaXY+XHJcbiAgICAgIDxkaXYgY2xhc3M9XCJ3b3JrZmxvdy1idWlsZGVyLWRpdl9fZGlhZ3JhbS1hcmVhX190b29sYmFyX19yaWdodFwiPlxyXG4gICAgICAgIDxtYXQtc2VsZWN0XHJcbiAgICAgICAgICBbdmFsdWVdPVwiMVwiXHJcbiAgICAgICAgICAoc2VsZWN0aW9uQ2hhbmdlKT1cImRpYWdyYW0uem9vbSgkZXZlbnQudmFsdWUgLyBjdXJyZW50Wm9vbUZhY3RvcilcIlxyXG4gICAgICAgICAgY2xhc3M9XCJ3b3JrZmxvdy1idWlsZGVyLWRpdl9fZGlhZ3JhbS1hcmVhX190b29sYmFyX190b29sLXpvb21cIlxyXG4gICAgICAgID5cclxuICAgICAgICAgIDxtYXQtb3B0aW9uIGNsYXNzPVwid29ya2Zsb3ctYnVpbGRlci1kaXZfX2RpYWdyYW0tYXJlYV9fdG9vbGJhcl9fdG9vbC16b29tX19vcHRpb25cIiAqbmdGb3I9XCJsZXQgZmFjdG9yIG9mIHpvb21PcHRpb25zXCIgW3ZhbHVlXT1cImZhY3RvclwiXHJcbiAgICAgICAgICAgID57eyBmYWN0b3IgKiAxMDAgfX0gJTwvbWF0LW9wdGlvblxyXG4gICAgICAgICAgPlxyXG4gICAgICAgIDwvbWF0LXNlbGVjdD5cclxuICAgICAgPC9kaXY+XHJcbiAgICA8L2Rpdj5cclxuICAgIDxlanMtZGlhZ3JhbVxyXG4gICAgICAjZGlhZ3JhbVxyXG4gICAgICBpZD1cImRpYWdyYW1cIlxyXG4gICAgICBbd2lkdGhdPVwiZGlhZ3JhbUNvbmZpZy53aWR0aFwiXHJcbiAgICAgIFtoZWlnaHRdPVwiZGlhZ3JhbUNvbmZpZy5oZWlnaHRcIlxyXG4gICAgICBbdG9vbF09XCJ0b29sXCJcclxuICAgICAgW3Rvb2x0aXBdPVwiZGlhZ3JhbUNvbmZpZy50b29sdGlwXCJcclxuICAgICAgW2NvbnN0cmFpbnRzXT1cImRpYWdyYW1Db25maWcuY29uc3RyYWludHNcIlxyXG4gICAgICBbc25hcFNldHRpbmdzXT1cImRpYWdyYW1Db25maWcuc25hcFNldHRpbmdzXCJcclxuICAgICAgW2dldENvbm5lY3RvckRlZmF1bHRzXT1cImRpYWdyYW1Db25maWcuZ2V0Q29ubmVjdG9yRGVmYXVsdHNcIlxyXG4gICAgICBbY2xhc3MuZWpzLWRpYWdyYW0tLWhhcy1ub2RlLXNlbGVjdGVkXT1cIlxyXG4gICAgICAgIGRpYWdyYW0uc2VsZWN0ZWRJdGVtcy5ub2RlcyAmJiBkaWFncmFtLnNlbGVjdGVkSXRlbXMubm9kZXMubGVuZ3RoID4gMFxyXG4gICAgICBcIlxyXG4gICAgICBbY2xhc3MuZWpzLWRpYWdyYW0tLWhhcy1ub2RlLXNlbGVjdGVkLWFuZC1leHBhbmRlZF09XCJcclxuICAgICAgICBoYXNOb2RlU2VsZWN0ZWRBbmRFeHBhbmRlZDIoKVxyXG4gICAgICBcIlxyXG4gICAgICAoY3JlYXRlZCk9XCJvbkRpYWdyYW1Mb2FkKClcIlxyXG4gICAgICAoY29ubmVjdGlvbkNoYW5nZSk9XCJvbkNvbm5lY3Rpb25DaGFuZ2UoJGV2ZW50KVwiXHJcbiAgICAgIChlbGVtZW50RHJhdyk9XCJvbkVsZW1lbnREcmF3KCRldmVudClcIlxyXG4gICAgICAoY29tbWFuZEV4ZWN1dGUpPVwibG9nKCdjb21tYW5kRXhlY3V0ZScsICRldmVudClcIlxyXG4gICAgICAoY3JlYXRlZCk9XCJsb2coJ2NyZWF0ZWQnLCAkZXZlbnQpXCJcclxuICAgICAgKGRhdGFMb2FkZWQpPVwibG9nKCdkYXRhTG9hZGVkJywgJGV2ZW50KVwiXHJcbiAgICAgIChkcmFnRW50ZXIpPVwibG9nKCdkcmFnRW50ZXInLCAkZXZlbnQpXCJcclxuICAgICAgKGRyYWdMZWF2ZSk9XCJsb2coJ2RyYWdMZWF2ZScsICRldmVudClcIlxyXG4gICAgICAoZHJhZ092ZXIpPVwibG9nKCdkcmFnT3ZlcicsICRldmVudClcIlxyXG4gICAgICAoZHJvcCk9XCJsb2coJ2Ryb3AnLCAkZXZlbnQpXCJcclxuICAgICAgKGZpeGVkVXNlckhhbmRsZUNsaWNrKT1cImxvZygnZml4ZWRVc2VySGFuZGxlQ2xpY2snLCAkZXZlbnQpXCJcclxuICAgICAgKGxvYWQpPVwibG9nKCdsb2FkJywgJGV2ZW50KVwiXHJcbiAgICAgIChwb3NpdGlvbkNoYW5nZSk9XCJvblBvc2l0aW9uQ2hhbmdlKCRldmVudClcIlxyXG4gICAgICAocHJvcGVydHlDaGFuZ2UpPVwibG9nKCdwcm9wZXJ0eUNoYW5nZScsICRldmVudClcIlxyXG4gICAgICAocm90YXRlQ2hhbmdlKT1cImxvZygncm90YXRlQ2hhbmdlJywgJGV2ZW50KVwiXHJcbiAgICAgIChzY3JvbGxDaGFuZ2UpPVwib25TY3JvbGxDaGFuZ2UoJGV2ZW50KVwiXHJcbiAgICAgIChzZWdtZW50Q2hhbmdlKT1cImxvZygnc2VnbWVudENoYW5nZScsICRldmVudClcIlxyXG4gICAgICAoc2VnbWVudENvbGxlY3Rpb25DaGFuZ2UpPVwibG9nKCdzZWdtZW50Q29sbGVjdGlvbkNoYW5nZScsICRldmVudClcIlxyXG4gICAgICAoc2VsZWN0aW9uQ2hhbmdlKT1cIm9uU2VsZWN0aW9uQ2hhbmdlKCRldmVudClcIlxyXG4gICAgICAoc2l6ZUNoYW5nZSk9XCJsb2coJ3NpemVDaGFuZ2UnLCAkZXZlbnQpXCJcclxuICAgICAgKHNvdXJjZVBvaW50Q2hhbmdlKT1cIm9uQ29ubmVjdGlvblBvaW50Q2hhbmdlKCRldmVudClcIlxyXG4gICAgICAodGFyZ2V0UG9pbnRDaGFuZ2UpPVwib25Db25uZWN0aW9uUG9pbnRDaGFuZ2UoJGV2ZW50KVwiXHJcbiAgICAgIChjb2xsZWN0aW9uQ2hhbmdlKT1cIm9uQ29sbGVjdGlvbkNoYW5nZSgkZXZlbnQpXCJcclxuICAgID5cclxuICAgICAgPG5nLXRlbXBsYXRlICNub2RlVGVtcGxhdGUgbGV0LWRhdGE+XHJcbiAgICAgICAgPGF6YXZpc3RhLXdvcmtmbG93LWJ1aWxkZXItbm9kZS1mb3JtXHJcbiAgICAgICAgICBbbm9kZV09XCJkYXRhXCJcclxuICAgICAgICAgIFtkaWFncmFtRWxdPVwiZGlhZ3JhbUVsXCJcclxuICAgICAgICAgIFtldmVudElkXT1cImV2ZW50SWRcIlxyXG4gICAgICAgICAgKHdvcmtmbG93U2V0dGluZ3NDaGFuZ2VzKT1cInVwZGF0ZVdvcmtmbG93U2V0dGluZ3MoZGF0YS5pZCwgJGV2ZW50KVwiXHJcbiAgICAgICAgICAoY2FudmFzQ2hhbmdlcyk9XCJ1cGRhdGVXb3JrZmxvd0NhbnZhcyhkYXRhLmlkLCAkZXZlbnQpXCJcclxuICAgICAgICAgIChyZW1vdmVOb2RlKT1cImRlbGV0ZU5vZGUoZGF0YSlcIlxyXG4gICAgICAgID48L2F6YXZpc3RhLXdvcmtmbG93LWJ1aWxkZXItbm9kZS1mb3JtPlxyXG4gICAgICA8L25nLXRlbXBsYXRlPlxyXG4gICAgPC9lanMtZGlhZ3JhbT5cclxuICA8L2Rpdj5cclxuICA8ZGl2IGNsYXNzPVwid29ya2Zsb3ctYnVpbGRlci1kaXZfX3BhbGV0dGUtYXJlYVwiPlxyXG4gICAgPG1hdC10YWItZ3JvdXA+XHJcbiAgICAgIDxtYXQtdGFiIGxhYmVsPVwie3sgJ1dPUktfQkxPQ0tTJyB8IHRyYW5zbGF0ZSB9fVwiPlxyXG4gICAgICAgIDxhemF2aXN0YS13b3JrZmxvdy1idWlsZGVyLXdvcmtmbG93LWJ1aWxkZXItcGFsZXR0ZT48L2F6YXZpc3RhLXdvcmtmbG93LWJ1aWxkZXItd29ya2Zsb3ctYnVpbGRlci1wYWxldHRlPlxyXG4gICAgICA8L21hdC10YWI+XHJcbiAgICA8L21hdC10YWItZ3JvdXA+XHJcbiAgPC9kaXY+XHJcbjwvZGl2PlxyXG4iXX0=