/**
 * Please place the code according to the `// #region` comment tag
 *
 * For example `// #region General utils` `// #region Diagram utils`
 */
import { ConnectorConstraints, NodeConstraints, PortConstraints, PortVisibility, } from '@syncfusion/ej2-angular-diagrams';
import { InputPin, OutputPin, WorkflowType, } from '@azavista/workflow-builder-shared';
import { getCanvasWorkflow } from '@azavista/workflow-builder-shared/lib/factory';
import { FormArray, FormControl, FormGroup } from '@angular/forms';
import { DEFAULT_CONNECTOR, DEFAULT_NODE_HEIGHT, DEFAULT_NODE_WIDTH, DEFAULT_STROKE_WIDTH, OUTPUT_PIN_PAIR, PREFIX_CONNECTOR, PREFIX_NODE, PREFIX_PORT, WORKFLOW_NAME_TRANSLATIONS, WORKFLOW_TYPE_CATEGORIES, WORKFLOW_TYPE_ORDER, } from './types';
// #region General utils
export const omit = (data, properties) => {
    const result = { ...data };
    properties.forEach((key) => delete result[key]);
    return result;
};
export const objectKeys = (o) => {
    return Object.keys(o);
};
export const delay = (milliSeconds) => {
    return new Promise((resolve) => {
        setTimeout(resolve, milliSeconds);
    });
};
export const getGroupByValue = (rows, fieldName) => {
    return rows.reduce((group, row) => {
        group[row[fieldName]] = [...(group[row[fieldName]] ?? []), row];
        return group;
    }, {});
};
export const getMapByValue = (rows, fieldName) => {
    return rows.reduce((group, row) => {
        group[row[fieldName]] = row;
        return group;
    }, {});
};
export const isObject = (item) => {
    return item && typeof item === 'object' && !Array.isArray(item);
};
/**
 *
 * @param target
 * @param source
 * @returns new object that merged both `target` & `source` with properties from `source` replacing existing `target`'s properties
 */
export const mergeDeep = (target, source) => {
    const output = { ...target };
    if (isObject(target) && isObject(source)) {
        objectKeys(source).forEach((key) => {
            if (isObject(source[key])) {
                if (!(key in target))
                    Object.assign(output, { [key]: source[key] });
                else
                    output[key] = mergeDeep(target[key], source[key]);
            }
            else {
                Object.assign(output, { [key]: source[key] });
            }
        });
    }
    return output;
};
// #endregion
// #region HTML template utils
export const trackByWorkflowProperty = (index, item) => {
    return item.attribute;
};
export const trackBy = (attribute) => (index, item) => item[attribute];
export const trackByAttributeTranslations = (index, item) => {
    return item.value;
};
// #endregion
// #region Diagram utils
export const getConnectorAnnotation = (outputPin) => {
    return outputPin !== OutputPin.OUTPUT
        ? [
            {
                content: outputPin.split('-')[0],
            },
        ]
        : [];
};
export const getValidConnectorsFromWorkfowFactory = (workflows) => workflows.reduce((result, workflow) => {
    const nextWorkflows = workflow.getNextWorkflows();
    objectKeys(nextWorkflows).forEach((outputType) => {
        const next_workflow_ids = nextWorkflows[outputType];
        if (next_workflow_ids) {
            result.push({
                ...DEFAULT_CONNECTOR,
                id: `${PREFIX_CONNECTOR}${workflow.getId()}_${outputType}`,
                sourceID: `${PREFIX_NODE}${workflow.getId()}`,
                sourcePortID: `${PREFIX_PORT}_${outputType}_pin`,
                targetID: `${PREFIX_NODE}${next_workflow_ids}`,
                targetPortID: `${PREFIX_PORT}_${OUTPUT_PIN_PAIR[outputType]}_pin`,
                annotations: getConnectorAnnotation(outputType),
                constraints: ConnectorConstraints.Default -
                    ConnectorConstraints.DragSourceEnd,
            });
        }
    });
    return result;
}, []);
export const getDefaultInputPinPort = (type) => {
    const inputPinOffsetMap = {
        [InputPin.INPUT]: { x: 0, y: 0.5 },
        [InputPin.CANCELLATION_INPUT]: { x: 0.5, y: 0 },
        [InputPin.DECLINE_INPUT]: { x: 0.5, y: 0 },
    };
    return {
        id: `${PREFIX_PORT}_${type}_pin`,
        offset: inputPinOffsetMap[type],
        visibility: PortVisibility.Visible,
        constraints: PortConstraints.InConnect,
        style: {
            fill: '#fff',
            strokeColor: '#ccc',
            strokeWidth: DEFAULT_STROKE_WIDTH,
            opacity: 0.8,
        },
        shape: 'Circle',
        height: 8,
        width: 8,
    };
};
export const getDefaultOutputPinPort = (type) => {
    const outputPinOffsetMap = {
        [OutputPin.OUTPUT]: { x: 1, y: 0.5 },
        [OutputPin.EXISTING_CONTACT]: { x: 1, y: 0.5 },
        [OutputPin.INVITED_CONTACT]: { x: 1, y: 0.5 },
        [OutputPin.NEW_CONTACT]: { x: 1, y: 0.5 },
        [OutputPin.CANCELLATION_OUTPUT]: { x: 0.5, y: 1 },
        [OutputPin.DECLINE_OUTPUT]: { x: 0.5, y: 1 },
    };
    return {
        id: `${PREFIX_PORT}_${type}_pin`,
        offset: outputPinOffsetMap[type],
        visibility: PortVisibility.Visible,
        style: {
            fill: '#fff',
            strokeColor: '#aaa',
            strokeWidth: DEFAULT_STROKE_WIDTH,
        },
        shape: 'Circle',
        height: 8,
        width: 8,
        constraints: PortConstraints.Draw | PortConstraints.OutConnect,
    };
};
export const getDefaultNode = () => ({
    shape: { type: 'HTML' },
    ports: [
        getDefaultInputPinPort(InputPin.INPUT),
        getDefaultOutputPinPort(OutputPin.OUTPUT),
    ],
    width: DEFAULT_NODE_WIDTH,
    height: DEFAULT_NODE_HEIGHT,
    annotations: [],
    constraints: NodeConstraints.Default -
        NodeConstraints.Rotate -
        NodeConstraints.Resize -
        NodeConstraints.HideThumbs -
        NodeConstraints.Delete,
    // constraints: NodeConstraints.Default,
});
// #endregion
// #region Workflow data utils
export const getWorkflowIdFromNodeId = (nodeId) => {
    return nodeId.replace(PREFIX_NODE, '');
};
export const getOutputSidePins = (pins) => {
    return pins.filter((pin) => OUTPUT_PIN_PAIR[pin] === InputPin.INPUT);
};
export const getOutputNonSidePins = (pins) => {
    return pins.filter((pin) => OUTPUT_PIN_PAIR[pin] !== InputPin.INPUT);
};
export const getMultipleOutputPorts = (pins) => {
    const sidePins = getOutputSidePins(pins);
    const nonSidePins = getOutputNonSidePins(pins);
    return sidePins
        .map((pin, index) => {
        const port = getDefaultOutputPinPort(pin);
        port.offset.y = (index + 1) / (sidePins.length + 1);
        return port;
    })
        .concat(nonSidePins.map(getDefaultOutputPinPort));
};
export const getNodePortsFromFactory = (factory) => {
    return [
        ...factory.inputPin.map((inputPin) => getDefaultInputPinPort(inputPin)),
        ...getMultipleOutputPorts(factory.outputPin),
    ].filter((port) => !!port);
};
export const getNodeFromCanvasControllerData = (data) => {
    const { coordinate, factory } = data;
    return {
        ...getDefaultNode(),
        id: `${PREFIX_NODE}${factory.getId()}`,
        offsetX: coordinate.x,
        offsetY: coordinate.y,
        ports: getNodePortsFromFactory(factory),
    };
};
export const getNodeAndConnectorsFromCanvasControllerData = (canvasItems) => ({
    nodes: canvasItems.map((data) => getNodeFromCanvasControllerData(data)),
    connectors: [
        ...getValidConnectorsFromWorkfowFactory(canvasItems.map(({ factory }) => factory)),
    ],
});
export const getWorkflowFactory = (type, data) => {
    const factory = getCanvasWorkflow(type);
    if (data) {
        try {
            factory.setWorkflow(data);
            objectKeys(data.custom_processes).forEach((processKey) => factory.setCustomProcess(processKey, data.custom_processes[processKey]));
        }
        catch (e) {
            console.error(e);
        }
    }
    return factory;
};
export const getWorkflowTypeArray = () => {
    return objectKeys(WorkflowType).reduce((result, data) => {
        const workflowType = WorkflowType[data];
        // eslint-disable-next-line eqeqeq
        if (workflowType != undefined) {
            result.push(workflowType);
        }
        return result;
    }, []);
};
export const workflowTypeArray = getWorkflowTypeArray();
export const getOutputPinFromConnector = (connector) => {
    const sourcePin = connector.sourcePortID;
    return sourcePin?.replace(`${PREFIX_PORT}_`, ``).replace('_pin', '');
};
export const reorderWorkflowsByPaletteCategory = (workflows) => {
    return {
        mainWorkflows: workflows
            .filter((workflow) => WORKFLOW_TYPE_CATEGORIES[workflow.type][0] !==
            'CANCELLATION_WORKFLOWS')
            .sort((workflowA, workflowB) => WORKFLOW_TYPE_ORDER[workflowA.type] -
            WORKFLOW_TYPE_ORDER[workflowB.type]),
        cancellationWorkflows: workflows
            .filter((workflow) => WORKFLOW_TYPE_CATEGORIES[workflow.type][0] ===
            'CANCELLATION_WORKFLOWS')
            .sort((workflowA, workflowB) => WORKFLOW_TYPE_ORDER[workflowA.type] -
            WORKFLOW_TYPE_ORDER[workflowB.type]),
    };
};
export const getOrderedIEventWorkflows = (workflows) => {
    const gap = 80;
    const { mainWorkflows, cancellationWorkflows } = reorderWorkflowsByPaletteCategory(workflows);
    const workflowToCanvasItem = (workflow, position) => ({
        canvas: {
            coordinate: {
                x: gap + position.x * (DEFAULT_NODE_WIDTH + gap),
                y: gap + position.y * (DEFAULT_NODE_HEIGHT + gap),
            },
            name: '',
            description: '',
        },
        workflow: {
            custom_processes: [],
            id: workflow.id,
            settings: workflow.settings,
            type: workflow.type,
        },
    });
    return [
        ...mainWorkflows.map((workflow, index) => workflowToCanvasItem(workflow, {
            x: index,
            y: 0,
        })),
        ...cancellationWorkflows.map((workflow, index) => workflowToCanvasItem(workflow, { x: index, y: 1 })),
    ];
};
// #endregion
// #region Forms utils
export const getFormDirtyValues = (form) => {
    const dirtyValues = {};
    objectKeys(form.controls).forEach((key) => {
        const abstractControl = form.controls[key];
        if (abstractControl.dirty) {
            if (abstractControl instanceof FormGroup) {
                dirtyValues[key] = getFormDirtyValues(abstractControl);
            }
            else {
                dirtyValues[key] = abstractControl.value;
            }
        }
    });
    return dirtyValues;
};
export function createFormGroupFromData(data) {
    if (Array.isArray(data)) {
        const formArray = new FormArray(data.map((row) => createFormGroupFromData(row)));
        return formArray;
    }
    if (typeof data === 'object' && !!data) {
        const formGroup = new FormGroup({});
        objectKeys(data).forEach((key) => {
            formGroup.addControl(key, 
            // eslint-disable-next-line @typescript-eslint/ban-ts-comment
            // @ts-ignore
            createFormGroupFromData(data[key]));
        });
        return formGroup;
    }
    return new FormControl(data);
}
// Palette Utils
export const getNodeModelForPaletteFromWorkflowType = (workflowType, sharedSvc) => {
    const factory = getCanvasWorkflow(workflowType);
    const outputPins = factory.outputPin;
    const sideOutputPins = getOutputSidePins(outputPins);
    return {
        ...getDefaultNode(),
        addInfo: { type: workflowType, label: workflowType },
        ports: getNodePortsFromFactory(factory) ?? [],
        id: workflowType,
        constraints: NodeConstraints.Default,
        padding: {
            left: 0,
            right: 0,
            bottom: 0,
            top: 0,
        },
        margin: {
            left: 0,
            right: 0,
            bottom: 0,
            top: 0,
        },
        shape: {
            type: 'HTML',
            content: `<div class="palette-item">
            <div class="palette-item__inner">
            <i class="material-icons-outlined palette-item__icon">dataset</i>
          ${factory.inputPin.map((inputPin) => 
            // eslint-disable-next-line prettier/prettier
            `<div class="palette-item__${inputPin}"></div>`)}${getOutputNonSidePins(outputPins).map((outputPin) => 
            // eslint-disable-next-line prettier/prettier
            `<div class="palette-item__${outputPin}"></div>`)}${sideOutputPins.map((outputPin, index) => {
                const top = ((index + 1) * 100) / (sideOutputPins.length + 1);
                return `<div class="palette-item__${outputPin} palette-item__output" style="top: ${Math.round(top)}%;"></div>`;
            })}
            </div>
            <div class="palette-item__title">${` ${sharedSvc.translate(WORKFLOW_NAME_TRANSLATIONS[workflowType])}`}</div>
          </div>`,
        },
    };
};
// eslint-disable-next-line max-len
export const nodeModelForPaletteCreateWorkBlock = {
    ...getDefaultNode(),
    addInfo: { type: 'create-work-block', label: 'CREATE_WORKBLOCK' },
    ports: [],
    id: 'create-work-block',
    constraints: NodeConstraints.None,
    shape: {
        type: 'HTML',
        content: `<div class="palette-item">
            <div class="palette-item__inner">
            <i class="material-icons-outlined palette-item__icon">post_add</i>
            </div>
          </div>`,
    },
};
export const getNodeModelForPalette = (paletteSymbol, sharedSvc) => {
    if (paletteSymbol === 'create-work-block') {
        return nodeModelForPaletteCreateWorkBlock;
    }
    return getNodeModelForPaletteFromWorkflowType(paletteSymbol, sharedSvc);
};
// local storage tools
const jsonParse = (jsonText) => {
    let myResponse;
    if (jsonText == null) {
        return undefined;
    }
    try {
        myResponse = JSON.parse(jsonText);
    }
    catch (e) {
        myResponse = undefined;
        throw new Error('Error occured: ', e);
    }
    return myResponse;
};
const getBuilderWorkflowLocalStorageKey = (eventId) => `azavista-workflow-builder-${eventId}`;
export const getBuilderWorkflowFromLocalStorage = (eventId) => {
    const content = localStorage.getItem(getBuilderWorkflowLocalStorageKey(eventId));
    return jsonParse(content);
};
export const saveBuilderWorkflowToLocalStorage = (eventId, data) => {
    localStorage.setItem(getBuilderWorkflowLocalStorageKey(eventId), JSON.stringify(data));
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9hemF2aXN0YS93b3JrZmxvdy1idWlsZGVyL3NyYy9saWIvdXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7R0FJRztBQUVILE9BQU8sRUFDSCxvQkFBb0IsRUFDcEIsZUFBZSxFQUdmLGVBQWUsRUFDZixjQUFjLEdBQ2pCLE1BQU0sa0NBQWtDLENBQUM7QUFDMUMsT0FBTyxFQUdILFFBQVEsRUFDUixTQUFTLEVBR1QsWUFBWSxHQUNmLE1BQU0sbUNBQW1DLENBQUM7QUFDM0MsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sK0NBQStDLENBQUM7QUFDbEYsT0FBTyxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFNbkUsT0FBTyxFQUlILGlCQUFpQixFQUNqQixtQkFBbUIsRUFDbkIsa0JBQWtCLEVBQ2xCLG9CQUFvQixFQUNwQixlQUFlLEVBQ2YsZ0JBQWdCLEVBQ2hCLFdBQVcsRUFDWCxXQUFXLEVBR1gsMEJBQTBCLEVBQzFCLHdCQUF3QixFQUN4QixtQkFBbUIsR0FDdEIsTUFBTSxTQUFTLENBQUM7QUFFakIsd0JBQXdCO0FBQ3hCLE1BQU0sQ0FBQyxNQUFNLElBQUksR0FBRyxDQUNoQixJQUFPLEVBQ1AsVUFBYSxFQUNLLEVBQUU7SUFDcEIsTUFBTSxNQUFNLEdBQUcsRUFBRSxHQUFHLElBQUksRUFBRSxDQUFDO0lBQzNCLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLE9BQU8sTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDaEQsT0FBTyxNQUFNLENBQUM7QUFDbEIsQ0FBQyxDQUFDO0FBRUYsTUFBTSxDQUFDLE1BQU0sVUFBVSxHQUFHLENBQWUsQ0FBSSxFQUFrQixFQUFFO0lBQzdELE9BQU8sTUFBTSxDQUFDLElBQUksQ0FB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QUFDLE9BQWUsRUFBRSxFQUFFLENBQzFELDZCQUE2QixPQUFPLEVBQUUsQ0FBQztBQUMzQyxNQUFNLENBQUMsTUFBTSxrQ0FBa0MsR0FBRyxDQUFDLE9BQWUsRUFBRSxFQUFFO0lBQ2xFLE1BQU0sT0FBTyxHQUFHLFlBQVksQ0FBQyxPQUFPLENBQ2hDLGlDQUFpQyxDQUFDLE9BQU8sQ0FBQyxDQUM3QyxDQUFDO0lBQ0YsT0FBTyxTQUFTLENBQWtCLE9BQU8sQ0FBQyxDQUFDO0FBQy9DLENBQUMsQ0FBQztBQUVGLE1BQU0sQ0FBQyxNQUFNLGlDQUFpQyxHQUFHLENBQzdDLE9BQWUsRUFDZixJQUFxQixFQUN2QixFQUFFO0lBQ0EsWUFBWSxDQUFDLE9BQU8sQ0FDaEIsaUNBQWlDLENBQUMsT0FBTyxDQUFDLEVBQzFDLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQ3ZCLENBQUM7QUFDTixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogUGxlYXNlIHBsYWNlIHRoZSBjb2RlIGFjY29yZGluZyB0byB0aGUgYC8vICNyZWdpb25gIGNvbW1lbnQgdGFnXHJcbiAqXHJcbiAqIEZvciBleGFtcGxlIGAvLyAjcmVnaW9uIEdlbmVyYWwgdXRpbHNgIGAvLyAjcmVnaW9uIERpYWdyYW0gdXRpbHNgXHJcbiAqL1xyXG5cclxuaW1wb3J0IHtcclxuICAgIENvbm5lY3RvckNvbnN0cmFpbnRzLFxyXG4gICAgTm9kZUNvbnN0cmFpbnRzLFxyXG4gICAgUGF0aEFubm90YXRpb25Nb2RlbCxcclxuICAgIFBvaW50TW9kZWwsXHJcbiAgICBQb3J0Q29uc3RyYWludHMsXHJcbiAgICBQb3J0VmlzaWJpbGl0eSxcclxufSBmcm9tICdAc3luY2Z1c2lvbi9lajItYW5ndWxhci1kaWFncmFtcyc7XHJcbmltcG9ydCB7XHJcbiAgICBDYW52YXNJdGVtLFxyXG4gICAgQ2FudmFzV29ya2Zsb3dJdGVtLFxyXG4gICAgSW5wdXRQaW4sXHJcbiAgICBPdXRwdXRQaW4sXHJcbiAgICBXb3JrZmxvd0J1aWxkZXIsXHJcbiAgICBXb3JrZmxvd1Byb3BlcnR5LFxyXG4gICAgV29ya2Zsb3dUeXBlLFxyXG59IGZyb20gJ0BhemF2aXN0YS93b3JrZmxvdy1idWlsZGVyLXNoYXJlZCc7XHJcbmltcG9ydCB7IGdldENhbnZhc1dvcmtmbG93IH0gZnJvbSAnQGF6YXZpc3RhL3dvcmtmbG93LWJ1aWxkZXItc2hhcmVkL2xpYi9mYWN0b3J5JztcclxuaW1wb3J0IHsgRm9ybUFycmF5LCBGb3JtQ29udHJvbCwgRm9ybUdyb3VwIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQge1xyXG4gICAgQXphdmlzdGFTaGFyZWRTZXJ2aWNlLFxyXG4gICAgSUF0dHJpYnV0ZVRyYW5zbGF0aW9uLFxyXG59IGZyb20gJ0BhemF2aXN0YS9jb21wb25lbnRzL3NoYXJlZCc7XHJcbmltcG9ydCB7IElFdmVudFdvcmtmbG93IH0gZnJvbSAnQGF6YXZpc3RhL3NlcnZpY2VsaWInO1xyXG5pbXBvcnQge1xyXG4gICAgQ2FudmFzQ29udHJvbGxlckRhdGEsXHJcbiAgICBDYW52YXNXb3JrZmxvd0ZhY3RvcnksXHJcbiAgICBDdXN0b21QYWxldHRlVHlwZSxcclxuICAgIERFRkFVTFRfQ09OTkVDVE9SLFxyXG4gICAgREVGQVVMVF9OT0RFX0hFSUdIVCxcclxuICAgIERFRkFVTFRfTk9ERV9XSURUSCxcclxuICAgIERFRkFVTFRfU1RST0tFX1dJRFRILFxyXG4gICAgT1VUUFVUX1BJTl9QQUlSLFxyXG4gICAgUFJFRklYX0NPTk5FQ1RPUixcclxuICAgIFBSRUZJWF9OT0RFLFxyXG4gICAgUFJFRklYX1BPUlQsXHJcbiAgICBQYWxldHRlU3ltYm9sLFxyXG4gICAgVmFsaWRDb25uZWN0b3JNb2RlbCxcclxuICAgIFdPUktGTE9XX05BTUVfVFJBTlNMQVRJT05TLFxyXG4gICAgV09SS0ZMT1dfVFlQRV9DQVRFR09SSUVTLFxyXG4gICAgV09SS0ZMT1dfVFlQRV9PUkRFUixcclxufSBmcm9tICcuL3R5cGVzJztcclxuXHJcbi8vICNyZWdpb24gR2VuZXJhbCB1dGlsc1xyXG5leHBvcnQgY29uc3Qgb21pdCA9IDxUIGV4dGVuZHMge30sIFAgZXh0ZW5kcyBBcnJheTxrZXlvZiBUPj4oXHJcbiAgICBkYXRhOiBULFxyXG4gICAgcHJvcGVydGllczogUCxcclxuKTogT21pdDxULCBQW251bWJlcl0+ID0+IHtcclxuICAgIGNvbnN0IHJlc3VsdCA9IHsgLi4uZGF0YSB9O1xyXG4gICAgcHJvcGVydGllcy5mb3JFYWNoKChrZXkpID0+IGRlbGV0ZSByZXN1bHRba2V5XSk7XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IG9iamVjdEtleXMgPSA8TyBleHRlbmRzIHt9PihvOiBPKTogQXJyYXk8a2V5b2YgTz4gPT4ge1xyXG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKG8pIGFzIGFueVtdO1xyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGRlbGF5ID0gKG1pbGxpU2Vjb25kczogbnVtYmVyKSA9PiB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcclxuICAgICAgICBzZXRUaW1lb3V0KHJlc29sdmUsIG1pbGxpU2Vjb25kcyk7XHJcbiAgICB9KTtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBnZXRHcm91cEJ5VmFsdWUgPSA8XHJcbiAgICBUIGV4dGVuZHMgeyBba2V5IGluIHN0cmluZ106IGFueSB9LFxyXG4gICAgSyBleHRlbmRzIGtleW9mIFQsXHJcbj4oXHJcbiAgICByb3dzOiBUW10sXHJcbiAgICBmaWVsZE5hbWU6IEssXHJcbik6IHsgW2tleSBpbiBUW0tdXT86IFRbXSB9ID0+IHtcclxuICAgIHJldHVybiByb3dzLnJlZHVjZShcclxuICAgICAgICAoZ3JvdXAsIHJvdykgPT4ge1xyXG4gICAgICAgICAgICBncm91cFtyb3dbZmllbGROYW1lXV0gPSBbLi4uKGdyb3VwW3Jvd1tmaWVsZE5hbWVdXSA/PyBbXSksIHJvd107XHJcbiAgICAgICAgICAgIHJldHVybiBncm91cDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHt9IGFzIHsgW2tleSBpbiBUW0tdXT86IFRbXSB9LFxyXG4gICAgKTtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBnZXRNYXBCeVZhbHVlID0gPFxyXG4gICAgVCBleHRlbmRzIHsgW2tleSBpbiBzdHJpbmddOiBhbnkgfSxcclxuICAgIEsgZXh0ZW5kcyBrZXlvZiBULFxyXG4+KFxyXG4gICAgcm93czogVFtdLFxyXG4gICAgZmllbGROYW1lOiBLLFxyXG4pOiB7IFtrZXkgaW4gVFtLXV0/OiBUIH0gPT4ge1xyXG4gICAgcmV0dXJuIHJvd3MucmVkdWNlKFxyXG4gICAgICAgIChncm91cCwgcm93KSA9PiB7XHJcbiAgICAgICAgICAgIGdyb3VwW3Jvd1tmaWVsZE5hbWVdXSA9IHJvdztcclxuICAgICAgICAgICAgcmV0dXJuIGdyb3VwO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAge30gYXMgeyBba2V5IGluIFRbS11dPzogVCB9LFxyXG4gICAgKTtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBpc09iamVjdCA9IDxUPihpdGVtOiBUKSA9PiB7XHJcbiAgICByZXR1cm4gaXRlbSAmJiB0eXBlb2YgaXRlbSA9PT0gJ29iamVjdCcgJiYgIUFycmF5LmlzQXJyYXkoaXRlbSk7XHJcbn07XHJcblxyXG4vKipcclxuICpcclxuICogQHBhcmFtIHRhcmdldFxyXG4gKiBAcGFyYW0gc291cmNlXHJcbiAqIEByZXR1cm5zIG5ldyBvYmplY3QgdGhhdCBtZXJnZWQgYm90aCBgdGFyZ2V0YCAmIGBzb3VyY2VgIHdpdGggcHJvcGVydGllcyBmcm9tIGBzb3VyY2VgIHJlcGxhY2luZyBleGlzdGluZyBgdGFyZ2V0YCdzIHByb3BlcnRpZXNcclxuICovXHJcbmV4cG9ydCBjb25zdCBtZXJnZURlZXAgPSA8VCBleHRlbmRzIHt9LCBTIGV4dGVuZHMge30+KFxyXG4gICAgdGFyZ2V0OiBULFxyXG4gICAgc291cmNlOiBTLFxyXG4pOiBUICYgUyA9PiB7XHJcbiAgICBjb25zdCBvdXRwdXQ6IFQgJiBTID0geyAuLi50YXJnZXQgfSBhcyBhbnk7XHJcbiAgICBpZiAoaXNPYmplY3QodGFyZ2V0KSAmJiBpc09iamVjdChzb3VyY2UpKSB7XHJcbiAgICAgICAgb2JqZWN0S2V5cyhzb3VyY2UpLmZvckVhY2goKGtleSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoaXNPYmplY3Qoc291cmNlW2tleV0pKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIShrZXkgaW4gdGFyZ2V0KSlcclxuICAgICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKG91dHB1dCwgeyBba2V5XTogc291cmNlW2tleV0gfSk7XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgb3V0cHV0W2tleV0gPSBtZXJnZURlZXAoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICh0YXJnZXQgYXMgYW55KVtrZXldLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAoc291cmNlIGFzIGFueSlba2V5XSxcclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihvdXRwdXQsIHsgW2tleV06IHNvdXJjZVtrZXldIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gb3V0cHV0O1xyXG59O1xyXG4vLyAjZW5kcmVnaW9uXHJcblxyXG4vLyAjcmVnaW9uIEhUTUwgdGVtcGxhdGUgdXRpbHNcclxuZXhwb3J0IGNvbnN0IHRyYWNrQnlXb3JrZmxvd1Byb3BlcnR5ID0gKFxyXG4gICAgaW5kZXg6IG51bWJlcixcclxuICAgIGl0ZW06IFdvcmtmbG93UHJvcGVydHksXHJcbikgPT4ge1xyXG4gICAgcmV0dXJuIGl0ZW0uYXR0cmlidXRlO1xyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IHRyYWNrQnkgPVxyXG4gICAgPFQgZXh0ZW5kcyB7fT4oYXR0cmlidXRlOiBrZXlvZiBUKSA9PlxyXG4gICAgKGluZGV4OiBudW1iZXIsIGl0ZW06IFQpID0+XHJcbiAgICAgICAgaXRlbVthdHRyaWJ1dGVdO1xyXG5cclxuZXhwb3J0IGNvbnN0IHRyYWNrQnlBdHRyaWJ1dGVUcmFuc2xhdGlvbnMgPSAoXHJcbiAgICBpbmRleDogbnVtYmVyLFxyXG4gICAgaXRlbTogSUF0dHJpYnV0ZVRyYW5zbGF0aW9uLFxyXG4pID0+IHtcclxuICAgIHJldHVybiBpdGVtLnZhbHVlO1xyXG59O1xyXG4vLyAjZW5kcmVnaW9uXHJcblxyXG4vLyAjcmVnaW9uIERpYWdyYW0gdXRpbHNcclxuZXhwb3J0IGNvbnN0IGdldENvbm5lY3RvckFubm90YXRpb24gPSAoXHJcbiAgICBvdXRwdXRQaW46IE91dHB1dFBpbixcclxuKTogUGF0aEFubm90YXRpb25Nb2RlbFtdID0+IHtcclxuICAgIHJldHVybiBvdXRwdXRQaW4gIT09IE91dHB1dFBpbi5PVVRQVVRcclxuICAgICAgICA/IFtcclxuICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IG91dHB1dFBpbi5zcGxpdCgnLScpWzBdLFxyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICBdXHJcbiAgICAgICAgOiBbXTtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBnZXRWYWxpZENvbm5lY3RvcnNGcm9tV29ya2Zvd0ZhY3RvcnkgPSAoXHJcbiAgICB3b3JrZmxvd3M6IENhbnZhc1dvcmtmbG93RmFjdG9yeTxXb3JrZmxvd1R5cGU+W10sXHJcbikgPT5cclxuICAgIHdvcmtmbG93cy5yZWR1Y2UoXHJcbiAgICAgICAgKHJlc3VsdCwgd29ya2Zsb3cpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbmV4dFdvcmtmbG93cyA9IHdvcmtmbG93LmdldE5leHRXb3JrZmxvd3MoKTtcclxuICAgICAgICAgICAgb2JqZWN0S2V5cyhuZXh0V29ya2Zsb3dzKS5mb3JFYWNoKChvdXRwdXRUeXBlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBuZXh0X3dvcmtmbG93X2lkcyA9IG5leHRXb3JrZmxvd3Nbb3V0cHV0VHlwZV07XHJcbiAgICAgICAgICAgICAgICBpZiAobmV4dF93b3JrZmxvd19pZHMpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLkRFRkFVTFRfQ09OTkVDVE9SLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogYCR7UFJFRklYX0NPTk5FQ1RPUn0ke3dvcmtmbG93LmdldElkKCl9XyR7b3V0cHV0VHlwZX1gLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VJRDogYCR7UFJFRklYX05PREV9JHt3b3JrZmxvdy5nZXRJZCgpfWAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZVBvcnRJRDogYCR7UFJFRklYX1BPUlR9XyR7b3V0cHV0VHlwZX1fcGluYCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0SUQ6IGAke1BSRUZJWF9OT0RFfSR7bmV4dF93b3JrZmxvd19pZHN9YCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0UG9ydElEOiBgJHtQUkVGSVhfUE9SVH1fJHtPVVRQVVRfUElOX1BBSVJbb3V0cHV0VHlwZV19X3BpbmAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFubm90YXRpb25zOiBnZXRDb25uZWN0b3JBbm5vdGF0aW9uKG91dHB1dFR5cGUpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdHJhaW50czpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbm5lY3RvckNvbnN0cmFpbnRzLkRlZmF1bHQgLVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29ubmVjdG9yQ29uc3RyYWludHMuRHJhZ1NvdXJjZUVuZCxcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBbXSBhcyBWYWxpZENvbm5lY3Rvck1vZGVsPE91dHB1dFBpbiwgc3RyaW5nLCBzdHJpbmc+W10sXHJcbiAgICApO1xyXG5cclxuZXhwb3J0IGNvbnN0IGdldERlZmF1bHRJbnB1dFBpblBvcnQgPSAodHlwZTogSW5wdXRQaW4pOiBQb2ludFBvcnRNb2RlbCA9PiB7XHJcbiAgICBjb25zdCBpbnB1dFBpbk9mZnNldE1hcDogUmVjb3JkPElucHV0UGluLCBQb2ludE1vZGVsPiA9IHtcclxuICAgICAgICBbSW5wdXRQaW4uSU5QVVRdOiB7IHg6IDAsIHk6IDAuNSB9LFxyXG4gICAgICAgIFtJbnB1dFBpbi5DQU5DRUxMQVRJT05fSU5QVVRdOiB7IHg6IDAuNSwgeTogMCB9LFxyXG4gICAgICAgIFtJbnB1dFBpbi5ERUNMSU5FX0lOUFVUXTogeyB4OiAwLjUsIHk6IDAgfSxcclxuICAgIH07XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGlkOiBgJHtQUkVGSVhfUE9SVH1fJHt0eXBlfV9waW5gLFxyXG4gICAgICAgIG9mZnNldDogaW5wdXRQaW5PZmZzZXRNYXBbdHlwZV0sXHJcbiAgICAgICAgdmlzaWJpbGl0eTogUG9ydFZpc2liaWxpdHkuVmlzaWJsZSxcclxuICAgICAgICBjb25zdHJhaW50czogUG9ydENvbnN0cmFpbnRzLkluQ29ubmVjdCxcclxuICAgICAgICBzdHlsZToge1xyXG4gICAgICAgICAgICBmaWxsOiAnI2ZmZicsXHJcbiAgICAgICAgICAgIHN0cm9rZUNvbG9yOiAnI2NjYycsXHJcbiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiBERUZBVUxUX1NUUk9LRV9XSURUSCxcclxuICAgICAgICAgICAgb3BhY2l0eTogMC44LFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc2hhcGU6ICdDaXJjbGUnLFxyXG4gICAgICAgIGhlaWdodDogOCxcclxuICAgICAgICB3aWR0aDogOCxcclxuICAgIH07XHJcbn07XHJcbmV4cG9ydCBjb25zdCBnZXREZWZhdWx0T3V0cHV0UGluUG9ydCA9ICh0eXBlOiBPdXRwdXRQaW4pOiBQb2ludFBvcnRNb2RlbCA9PiB7XHJcbiAgICBjb25zdCBvdXRwdXRQaW5PZmZzZXRNYXA6IFJlY29yZDxPdXRwdXRQaW4sIFBvaW50TW9kZWw+ID0ge1xyXG4gICAgICAgIFtPdXRwdXRQaW4uT1VUUFVUXTogeyB4OiAxLCB5OiAwLjUgfSxcclxuICAgICAgICBbT3V0cHV0UGluLkVYSVNUSU5HX0NPTlRBQ1RdOiB7IHg6IDEsIHk6IDAuNSB9LFxyXG4gICAgICAgIFtPdXRwdXRQaW4uSU5WSVRFRF9DT05UQUNUXTogeyB4OiAxLCB5OiAwLjUgfSxcclxuICAgICAgICBbT3V0cHV0UGluLk5FV19DT05UQUNUXTogeyB4OiAxLCB5OiAwLjUgfSxcclxuICAgICAgICBbT3V0cHV0UGluLkNBTkNFTExBVElPTl9PVVRQVVRdOiB7IHg6IDAuNSwgeTogMSB9LFxyXG4gICAgICAgIFtPdXRwdXRQaW4uREVDTElORV9PVVRQVVRdOiB7IHg6IDAuNSwgeTogMSB9LFxyXG4gICAgfTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgaWQ6IGAke1BSRUZJWF9QT1JUfV8ke3R5cGV9X3BpbmAsXHJcbiAgICAgICAgb2Zmc2V0OiBvdXRwdXRQaW5PZmZzZXRNYXBbdHlwZV0sXHJcbiAgICAgICAgdmlzaWJpbGl0eTogUG9ydFZpc2liaWxpdHkuVmlzaWJsZSxcclxuICAgICAgICBzdHlsZToge1xyXG4gICAgICAgICAgICBmaWxsOiAnI2ZmZicsXHJcbiAgICAgICAgICAgIHN0cm9rZUNvbG9yOiAnI2FhYScsXHJcbiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiBERUZBVUxUX1NUUk9LRV9XSURUSCxcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNoYXBlOiAnQ2lyY2xlJyxcclxuICAgICAgICBoZWlnaHQ6IDgsXHJcbiAgICAgICAgd2lkdGg6IDgsXHJcbiAgICAgICAgY29uc3RyYWludHM6IFBvcnRDb25zdHJhaW50cy5EcmF3IHwgUG9ydENvbnN0cmFpbnRzLk91dENvbm5lY3QsXHJcbiAgICB9O1xyXG59O1xyXG5leHBvcnQgY29uc3QgZ2V0RGVmYXVsdE5vZGUgPSAoKTogT21pdDxOb2RlTW9kZWwsICdpZCc+ID0+ICh7XHJcbiAgICBzaGFwZTogeyB0eXBlOiAnSFRNTCcgfSxcclxuICAgIHBvcnRzOiBbXHJcbiAgICAgICAgZ2V0RGVmYXVsdElucHV0UGluUG9ydChJbnB1dFBpbi5JTlBVVCksXHJcbiAgICAgICAgZ2V0RGVmYXVsdE91dHB1dFBpblBvcnQoT3V0cHV0UGluLk9VVFBVVCksXHJcbiAgICBdLFxyXG4gICAgd2lkdGg6IERFRkFVTFRfTk9ERV9XSURUSCxcclxuICAgIGhlaWdodDogREVGQVVMVF9OT0RFX0hFSUdIVCxcclxuICAgIGFubm90YXRpb25zOiBbXSxcclxuICAgIGNvbnN0cmFpbnRzOlxyXG4gICAgICAgIE5vZGVDb25zdHJhaW50cy5EZWZhdWx0IC1cclxuICAgICAgICBOb2RlQ29uc3RyYWludHMuUm90YXRlIC1cclxuICAgICAgICBOb2RlQ29uc3RyYWludHMuUmVzaXplIC1cclxuICAgICAgICBOb2RlQ29uc3RyYWludHMuSGlkZVRodW1icyAtXHJcbiAgICAgICAgTm9kZUNvbnN0cmFpbnRzLkRlbGV0ZSxcclxuICAgIC8vIGNvbnN0cmFpbnRzOiBOb2RlQ29uc3RyYWludHMuRGVmYXVsdCxcclxufSk7XHJcblxyXG4vLyAjZW5kcmVnaW9uXHJcblxyXG4vLyAjcmVnaW9uIFdvcmtmbG93IGRhdGEgdXRpbHNcclxuZXhwb3J0IGNvbnN0IGdldFdvcmtmbG93SWRGcm9tTm9kZUlkID0gKG5vZGVJZDogTm9kZU1vZGVsWydpZCddKSA9PiB7XHJcbiAgICByZXR1cm4gbm9kZUlkLnJlcGxhY2UoUFJFRklYX05PREUsICcnKTtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBnZXRPdXRwdXRTaWRlUGlucyA9IChwaW5zOiBPdXRwdXRQaW5bXSkgPT4ge1xyXG4gICAgcmV0dXJuIHBpbnMuZmlsdGVyKChwaW4pID0+IE9VVFBVVF9QSU5fUEFJUltwaW5dID09PSBJbnB1dFBpbi5JTlBVVCk7XHJcbn07XHJcbmV4cG9ydCBjb25zdCBnZXRPdXRwdXROb25TaWRlUGlucyA9IChwaW5zOiBPdXRwdXRQaW5bXSkgPT4ge1xyXG4gICAgcmV0dXJuIHBpbnMuZmlsdGVyKChwaW4pID0+IE9VVFBVVF9QSU5fUEFJUltwaW5dICE9PSBJbnB1dFBpbi5JTlBVVCk7XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgZ2V0TXVsdGlwbGVPdXRwdXRQb3J0cyA9IChwaW5zOiBPdXRwdXRQaW5bXSk6IFBvaW50UG9ydE1vZGVsW10gPT4ge1xyXG4gICAgY29uc3Qgc2lkZVBpbnMgPSBnZXRPdXRwdXRTaWRlUGlucyhwaW5zKTtcclxuICAgIGNvbnN0IG5vblNpZGVQaW5zID0gZ2V0T3V0cHV0Tm9uU2lkZVBpbnMocGlucyk7XHJcbiAgICByZXR1cm4gc2lkZVBpbnNcclxuICAgICAgICAubWFwKChwaW4sIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBvcnQgPSBnZXREZWZhdWx0T3V0cHV0UGluUG9ydChwaW4pO1xyXG4gICAgICAgICAgICBwb3J0Lm9mZnNldCEueSA9IChpbmRleCArIDEpIC8gKHNpZGVQaW5zLmxlbmd0aCArIDEpO1xyXG4gICAgICAgICAgICByZXR1cm4gcG9ydDtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jb25jYXQobm9uU2lkZVBpbnMubWFwKGdldERlZmF1bHRPdXRwdXRQaW5Qb3J0KSk7XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgZ2V0Tm9kZVBvcnRzRnJvbUZhY3RvcnkgPSA8VyBleHRlbmRzIFdvcmtmbG93VHlwZT4oXHJcbiAgICBmYWN0b3J5OiBDYW52YXNXb3JrZmxvd0ZhY3Rvcnk8Vz4sXHJcbik6IFBvaW50UG9ydE1vZGVsW10gPT4ge1xyXG4gICAgcmV0dXJuIFtcclxuICAgICAgICAuLi5mYWN0b3J5LmlucHV0UGluLm1hcCgoaW5wdXRQaW4pID0+IGdldERlZmF1bHRJbnB1dFBpblBvcnQoaW5wdXRQaW4pKSxcclxuICAgICAgICAuLi5nZXRNdWx0aXBsZU91dHB1dFBvcnRzKGZhY3Rvcnkub3V0cHV0UGluKSxcclxuICAgIF0uZmlsdGVyKChwb3J0KSA9PiAhIXBvcnQpO1xyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGdldE5vZGVGcm9tQ2FudmFzQ29udHJvbGxlckRhdGEgPSA8VyBleHRlbmRzIFdvcmtmbG93VHlwZT4oXHJcbiAgICBkYXRhOiBDYW52YXNDb250cm9sbGVyRGF0YTxXPixcclxuKTogTm9kZU1vZGVsID0+IHtcclxuICAgIGNvbnN0IHsgY29vcmRpbmF0ZSwgZmFjdG9yeSB9ID0gZGF0YTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgLi4uZ2V0RGVmYXVsdE5vZGUoKSxcclxuICAgICAgICBpZDogYCR7UFJFRklYX05PREV9JHtmYWN0b3J5LmdldElkKCl9YCxcclxuICAgICAgICBvZmZzZXRYOiBjb29yZGluYXRlLngsXHJcbiAgICAgICAgb2Zmc2V0WTogY29vcmRpbmF0ZS55LFxyXG4gICAgICAgIHBvcnRzOiBnZXROb2RlUG9ydHNGcm9tRmFjdG9yeShmYWN0b3J5KSxcclxuICAgIH07XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgZ2V0Tm9kZUFuZENvbm5lY3RvcnNGcm9tQ2FudmFzQ29udHJvbGxlckRhdGEgPSAoXHJcbiAgICBjYW52YXNJdGVtczogQ2FudmFzQ29udHJvbGxlckRhdGE8V29ya2Zsb3dUeXBlPltdLFxyXG4pOiBQaWNrPERpYWdyYW0sICdub2RlcycgfCAnY29ubmVjdG9ycyc+ID0+ICh7XHJcbiAgICBub2RlczogY2FudmFzSXRlbXMubWFwKChkYXRhKSA9PiBnZXROb2RlRnJvbUNhbnZhc0NvbnRyb2xsZXJEYXRhKGRhdGEpKSxcclxuICAgIGNvbm5lY3RvcnM6IFtcclxuICAgICAgICAuLi5nZXRWYWxpZENvbm5lY3RvcnNGcm9tV29ya2Zvd0ZhY3RvcnkoXHJcbiAgICAgICAgICAgIGNhbnZhc0l0ZW1zLm1hcCgoeyBmYWN0b3J5IH0pID0+IGZhY3RvcnkpLFxyXG4gICAgICAgICksXHJcbiAgICBdLFxyXG59KTtcclxuXHJcbmV4cG9ydCBjb25zdCBnZXRXb3JrZmxvd0ZhY3RvcnkgPSA8VyBleHRlbmRzIFdvcmtmbG93VHlwZT4oXHJcbiAgICB0eXBlOiBXLFxyXG4gICAgZGF0YT86IENhbnZhc1dvcmtmbG93SXRlbSxcclxuKSA9PiB7XHJcbiAgICBjb25zdCBmYWN0b3J5ID0gZ2V0Q2FudmFzV29ya2Zsb3codHlwZSk7XHJcbiAgICBpZiAoZGF0YSkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGZhY3Rvcnkuc2V0V29ya2Zsb3coZGF0YSk7XHJcbiAgICAgICAgICAgIG9iamVjdEtleXMoZGF0YS5jdXN0b21fcHJvY2Vzc2VzKS5mb3JFYWNoKChwcm9jZXNzS2V5KSA9PlxyXG4gICAgICAgICAgICAgICAgZmFjdG9yeS5zZXRDdXN0b21Qcm9jZXNzKFxyXG4gICAgICAgICAgICAgICAgICAgIHByb2Nlc3NLZXksXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jdXN0b21fcHJvY2Vzc2VzW3Byb2Nlc3NLZXldLFxyXG4gICAgICAgICAgICAgICAgKSxcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhY3Rvcnk7XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgZ2V0V29ya2Zsb3dUeXBlQXJyYXkgPSAoKTogV29ya2Zsb3dUeXBlW10gPT4ge1xyXG4gICAgcmV0dXJuIG9iamVjdEtleXMoV29ya2Zsb3dUeXBlKS5yZWR1Y2UoKHJlc3VsdCwgZGF0YSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHdvcmtmbG93VHlwZTogV29ya2Zsb3dUeXBlIHwgdW5kZWZpbmVkID0gKFdvcmtmbG93VHlwZSBhcyBhbnkpW1xyXG4gICAgICAgICAgICBkYXRhXHJcbiAgICAgICAgXTtcclxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXFlcWVxXHJcbiAgICAgICAgaWYgKHdvcmtmbG93VHlwZSAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgcmVzdWx0LnB1c2god29ya2Zsb3dUeXBlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH0sIFtdIGFzIFdvcmtmbG93VHlwZVtdKTtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCB3b3JrZmxvd1R5cGVBcnJheSA9IGdldFdvcmtmbG93VHlwZUFycmF5KCk7XHJcblxyXG5leHBvcnQgY29uc3QgZ2V0T3V0cHV0UGluRnJvbUNvbm5lY3RvciA9IDxPIGV4dGVuZHMgT3V0cHV0UGluPihcclxuICAgIGNvbm5lY3RvcjogQ29ubmVjdG9yTW9kZWw8Tz4sXHJcbik6IE8gPT4ge1xyXG4gICAgY29uc3Qgc291cmNlUGluID0gY29ubmVjdG9yLnNvdXJjZVBvcnRJRDtcclxuICAgIHJldHVybiBzb3VyY2VQaW4/LnJlcGxhY2UoYCR7UFJFRklYX1BPUlR9X2AsIGBgKS5yZXBsYWNlKCdfcGluJywgJycpIGFzIE87XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgcmVvcmRlcldvcmtmbG93c0J5UGFsZXR0ZUNhdGVnb3J5ID0gKFxyXG4gICAgd29ya2Zsb3dzOiBJRXZlbnRXb3JrZmxvd1tdLFxyXG4pOiB7XHJcbiAgICBtYWluV29ya2Zsb3dzOiBJRXZlbnRXb3JrZmxvd1tdO1xyXG4gICAgY2FuY2VsbGF0aW9uV29ya2Zsb3dzOiBJRXZlbnRXb3JrZmxvd1tdO1xyXG59ID0+IHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgbWFpbldvcmtmbG93czogd29ya2Zsb3dzXHJcbiAgICAgICAgICAgIC5maWx0ZXIoXHJcbiAgICAgICAgICAgICAgICAod29ya2Zsb3cpID0+XHJcbiAgICAgICAgICAgICAgICAgICAgV09SS0ZMT1dfVFlQRV9DQVRFR09SSUVTW3dvcmtmbG93LnR5cGVdWzBdICE9PVxyXG4gICAgICAgICAgICAgICAgICAgICdDQU5DRUxMQVRJT05fV09SS0ZMT1dTJyxcclxuICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAuc29ydChcclxuICAgICAgICAgICAgICAgICh3b3JrZmxvd0EsIHdvcmtmbG93QikgPT5cclxuICAgICAgICAgICAgICAgICAgICBXT1JLRkxPV19UWVBFX09SREVSW3dvcmtmbG93QS50eXBlXSAtXHJcbiAgICAgICAgICAgICAgICAgICAgV09SS0ZMT1dfVFlQRV9PUkRFUlt3b3JrZmxvd0IudHlwZV0sXHJcbiAgICAgICAgICAgICksXHJcbiAgICAgICAgY2FuY2VsbGF0aW9uV29ya2Zsb3dzOiB3b3JrZmxvd3NcclxuICAgICAgICAgICAgLmZpbHRlcihcclxuICAgICAgICAgICAgICAgICh3b3JrZmxvdykgPT5cclxuICAgICAgICAgICAgICAgICAgICBXT1JLRkxPV19UWVBFX0NBVEVHT1JJRVNbd29ya2Zsb3cudHlwZV1bMF0gPT09XHJcbiAgICAgICAgICAgICAgICAgICAgJ0NBTkNFTExBVElPTl9XT1JLRkxPV1MnLFxyXG4gICAgICAgICAgICApXHJcbiAgICAgICAgICAgIC5zb3J0KFxyXG4gICAgICAgICAgICAgICAgKHdvcmtmbG93QSwgd29ya2Zsb3dCKSA9PlxyXG4gICAgICAgICAgICAgICAgICAgIFdPUktGTE9XX1RZUEVfT1JERVJbd29ya2Zsb3dBLnR5cGVdIC1cclxuICAgICAgICAgICAgICAgICAgICBXT1JLRkxPV19UWVBFX09SREVSW3dvcmtmbG93Qi50eXBlXSxcclxuICAgICAgICAgICAgKSxcclxuICAgIH07XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgZ2V0T3JkZXJlZElFdmVudFdvcmtmbG93cyA9IChcclxuICAgIHdvcmtmbG93czogSUV2ZW50V29ya2Zsb3dbXSxcclxuKTogQ2FudmFzSXRlbVtdID0+IHtcclxuICAgIGNvbnN0IGdhcCA9IDgwO1xyXG4gICAgY29uc3QgeyBtYWluV29ya2Zsb3dzLCBjYW5jZWxsYXRpb25Xb3JrZmxvd3MgfSA9XHJcbiAgICAgICAgcmVvcmRlcldvcmtmbG93c0J5UGFsZXR0ZUNhdGVnb3J5KHdvcmtmbG93cyk7XHJcbiAgICBjb25zdCB3b3JrZmxvd1RvQ2FudmFzSXRlbSA9IChcclxuICAgICAgICB3b3JrZmxvdzogSUV2ZW50V29ya2Zsb3csXHJcbiAgICAgICAgcG9zaXRpb246IHsgeDogbnVtYmVyOyB5OiBudW1iZXIgfSxcclxuICAgICk6IENhbnZhc0l0ZW0gPT4gKHtcclxuICAgICAgICBjYW52YXM6IHtcclxuICAgICAgICAgICAgY29vcmRpbmF0ZToge1xyXG4gICAgICAgICAgICAgICAgeDogZ2FwICsgcG9zaXRpb24ueCAqIChERUZBVUxUX05PREVfV0lEVEggKyBnYXApLFxyXG4gICAgICAgICAgICAgICAgeTogZ2FwICsgcG9zaXRpb24ueSAqIChERUZBVUxUX05PREVfSEVJR0hUICsgZ2FwKSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgbmFtZTogJycsXHJcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnJyxcclxuICAgICAgICB9LFxyXG4gICAgICAgIHdvcmtmbG93OiB7XHJcbiAgICAgICAgICAgIGN1c3RvbV9wcm9jZXNzZXM6IFtdLFxyXG4gICAgICAgICAgICBpZDogd29ya2Zsb3cuaWQhLFxyXG4gICAgICAgICAgICBzZXR0aW5nczogd29ya2Zsb3cuc2V0dGluZ3MgYXMgYW55LFxyXG4gICAgICAgICAgICB0eXBlOiB3b3JrZmxvdy50eXBlIGFzIGFueSxcclxuICAgICAgICB9LFxyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIFtcclxuICAgICAgICAuLi5tYWluV29ya2Zsb3dzLm1hcCgod29ya2Zsb3csIGluZGV4KSA9PlxyXG4gICAgICAgICAgICB3b3JrZmxvd1RvQ2FudmFzSXRlbSh3b3JrZmxvdywge1xyXG4gICAgICAgICAgICAgICAgeDogaW5kZXgsXHJcbiAgICAgICAgICAgICAgICB5OiAwLFxyXG4gICAgICAgICAgICB9KSxcclxuICAgICAgICApLFxyXG4gICAgICAgIC4uLmNhbmNlbGxhdGlvbldvcmtmbG93cy5tYXAoKHdvcmtmbG93LCBpbmRleCkgPT5cclxuICAgICAgICAgICAgd29ya2Zsb3dUb0NhbnZhc0l0ZW0od29ya2Zsb3csIHsgeDogaW5kZXgsIHk6IDEgfSksXHJcbiAgICAgICAgKSxcclxuICAgIF07XHJcbn07XHJcblxyXG4vLyAjZW5kcmVnaW9uXHJcblxyXG4vLyAjcmVnaW9uIEZvcm1zIHV0aWxzXHJcbmV4cG9ydCBjb25zdCBnZXRGb3JtRGlydHlWYWx1ZXMgPSA8RiBleHRlbmRzIEZvcm1Hcm91cD4oZm9ybTogRikgPT4ge1xyXG4gICAgY29uc3QgZGlydHlWYWx1ZXM6IFBhcnRpYWw8RlsndmFsdWUnXT4gPSB7fTtcclxuXHJcbiAgICBvYmplY3RLZXlzKGZvcm0uY29udHJvbHMpLmZvckVhY2goKGtleToga2V5b2YgRlsnY29udHJvbHMnXSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGFic3RyYWN0Q29udHJvbCA9IGZvcm0uY29udHJvbHNba2V5IGFzIGFueV07XHJcblxyXG4gICAgICAgIGlmIChhYnN0cmFjdENvbnRyb2wuZGlydHkpIHtcclxuICAgICAgICAgICAgaWYgKGFic3RyYWN0Q29udHJvbCBpbnN0YW5jZW9mIEZvcm1Hcm91cCkge1xyXG4gICAgICAgICAgICAgICAgZGlydHlWYWx1ZXNba2V5XSA9IGdldEZvcm1EaXJ0eVZhbHVlcyhhYnN0cmFjdENvbnRyb2wpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZGlydHlWYWx1ZXNba2V5XSA9IGFic3RyYWN0Q29udHJvbC52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBkaXJ0eVZhbHVlcztcclxufTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVGb3JtR3JvdXBGcm9tRGF0YTxUIGV4dGVuZHMge30+KFxyXG4gICAgZGF0YTogVCxcclxuKTogVCBleHRlbmRzIGFueVtdID8gRm9ybUFycmF5IDogRm9ybUdyb3VwIHtcclxuICAgIGlmIChBcnJheS5pc0FycmF5KGRhdGEpKSB7XHJcbiAgICAgICAgY29uc3QgZm9ybUFycmF5ID0gbmV3IEZvcm1BcnJheShcclxuICAgICAgICAgICAgZGF0YS5tYXAoKHJvdykgPT4gY3JlYXRlRm9ybUdyb3VwRnJvbURhdGEocm93KSksXHJcbiAgICAgICAgKTtcclxuICAgICAgICByZXR1cm4gZm9ybUFycmF5IGFzIGFueTtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2YgZGF0YSA9PT0gJ29iamVjdCcgJiYgISFkYXRhKSB7XHJcbiAgICAgICAgY29uc3QgZm9ybUdyb3VwID0gbmV3IEZvcm1Hcm91cCh7fSk7XHJcbiAgICAgICAgb2JqZWN0S2V5cyhkYXRhKS5mb3JFYWNoKChrZXkpID0+IHtcclxuICAgICAgICAgICAgZm9ybUdyb3VwLmFkZENvbnRyb2woXHJcbiAgICAgICAgICAgICAgICBrZXkgYXMgYW55LFxyXG4gICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHMtY29tbWVudFxyXG4gICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICAgICAgY3JlYXRlRm9ybUdyb3VwRnJvbURhdGEoKGRhdGEgYXMgYW55KVtrZXldKSBhcyBhbnksXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGZvcm1Hcm91cCBhcyBhbnk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbmV3IEZvcm1Db250cm9sKGRhdGEpIGFzIGFueTtcclxufVxyXG5cclxuLy8gUGFsZXR0ZSBVdGlsc1xyXG5leHBvcnQgY29uc3QgZ2V0Tm9kZU1vZGVsRm9yUGFsZXR0ZUZyb21Xb3JrZmxvd1R5cGUgPSAoXHJcbiAgICB3b3JrZmxvd1R5cGU6IFdvcmtmbG93VHlwZSxcclxuICAgIHNoYXJlZFN2YzogQXphdmlzdGFTaGFyZWRTZXJ2aWNlLFxyXG4pID0+IHtcclxuICAgIGNvbnN0IGZhY3RvcnkgPSBnZXRDYW52YXNXb3JrZmxvdyh3b3JrZmxvd1R5cGUpO1xyXG4gICAgY29uc3Qgb3V0cHV0UGlucyA9IGZhY3Rvcnkub3V0cHV0UGluO1xyXG4gICAgY29uc3Qgc2lkZU91dHB1dFBpbnMgPSBnZXRPdXRwdXRTaWRlUGlucyhvdXRwdXRQaW5zKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgLi4uZ2V0RGVmYXVsdE5vZGUoKSxcclxuICAgICAgICBhZGRJbmZvOiB7IHR5cGU6IHdvcmtmbG93VHlwZSwgbGFiZWw6IHdvcmtmbG93VHlwZSB9LFxyXG4gICAgICAgIHBvcnRzOiBnZXROb2RlUG9ydHNGcm9tRmFjdG9yeShmYWN0b3J5KSA/PyBbXSxcclxuICAgICAgICBpZDogd29ya2Zsb3dUeXBlLFxyXG4gICAgICAgIGNvbnN0cmFpbnRzOiBOb2RlQ29uc3RyYWludHMuRGVmYXVsdCxcclxuICAgICAgICBwYWRkaW5nOiB7XHJcbiAgICAgICAgICAgIGxlZnQ6IDAsXHJcbiAgICAgICAgICAgIHJpZ2h0OiAwLFxyXG4gICAgICAgICAgICBib3R0b206IDAsXHJcbiAgICAgICAgICAgIHRvcDogMCxcclxuICAgICAgICB9LFxyXG4gICAgICAgIG1hcmdpbjoge1xyXG4gICAgICAgICAgICBsZWZ0OiAwLFxyXG4gICAgICAgICAgICByaWdodDogMCxcclxuICAgICAgICAgICAgYm90dG9tOiAwLFxyXG4gICAgICAgICAgICB0b3A6IDAsXHJcbiAgICAgICAgfSxcclxuICAgICAgICBzaGFwZToge1xyXG4gICAgICAgICAgICB0eXBlOiAnSFRNTCcsXHJcbiAgICAgICAgICAgIGNvbnRlbnQ6IGA8ZGl2IGNsYXNzPVwicGFsZXR0ZS1pdGVtXCI+XHJcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJwYWxldHRlLWl0ZW1fX2lubmVyXCI+XHJcbiAgICAgICAgICAgIDxpIGNsYXNzPVwibWF0ZXJpYWwtaWNvbnMtb3V0bGluZWQgcGFsZXR0ZS1pdGVtX19pY29uXCI+ZGF0YXNldDwvaT5cclxuICAgICAgICAgICR7ZmFjdG9yeS5pbnB1dFBpbi5tYXAoXHJcbiAgICAgICAgICAgICAgKGlucHV0UGluKSA9PlxyXG4gICAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJldHRpZXIvcHJldHRpZXJcclxuICAgICAgYDxkaXYgY2xhc3M9XCJwYWxldHRlLWl0ZW1fXyR7aW5wdXRQaW59XCI+PC9kaXY+YFxyXG4gICAgICAgICAgKX0ke2dldE91dHB1dE5vblNpZGVQaW5zKG91dHB1dFBpbnMpLm1hcChcclxuICAgICAgICAgICAgICAob3V0cHV0UGluKSA9PlxyXG4gICAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJldHRpZXIvcHJldHRpZXJcclxuICAgICAgYDxkaXYgY2xhc3M9XCJwYWxldHRlLWl0ZW1fXyR7b3V0cHV0UGlufVwiPjwvZGl2PmBcclxuICAgICAgICAgICl9JHtzaWRlT3V0cHV0UGlucy5tYXAoKG91dHB1dFBpbiwgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgICBjb25zdCB0b3AgPSAoKGluZGV4ICsgMSkgKiAxMDApIC8gKHNpZGVPdXRwdXRQaW5zLmxlbmd0aCArIDEpO1xyXG4gICAgICAgICAgICAgIHJldHVybiBgPGRpdiBjbGFzcz1cInBhbGV0dGUtaXRlbV9fJHtvdXRwdXRQaW59IHBhbGV0dGUtaXRlbV9fb3V0cHV0XCIgc3R5bGU9XCJ0b3A6ICR7TWF0aC5yb3VuZChcclxuICAgICAgICAgICAgICAgICAgdG9wLFxyXG4gICAgICAgICAgICAgICl9JTtcIj48L2Rpdj5gO1xyXG4gICAgICAgICAgfSl9XHJcbiAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwicGFsZXR0ZS1pdGVtX190aXRsZVwiPiR7YCAke3NoYXJlZFN2Yy50cmFuc2xhdGUoXHJcbiAgICAgICAgICAgICAgICBXT1JLRkxPV19OQU1FX1RSQU5TTEFUSU9OU1t3b3JrZmxvd1R5cGVdLFxyXG4gICAgICAgICAgICApfWB9PC9kaXY+XHJcbiAgICAgICAgICA8L2Rpdj5gLFxyXG4gICAgICAgIH0sXHJcbiAgICB9IGFzIE5vZGVNb2RlbEZvclBhbGV0dGU7XHJcbn07XHJcblxyXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LWxlblxyXG5leHBvcnQgY29uc3Qgbm9kZU1vZGVsRm9yUGFsZXR0ZUNyZWF0ZVdvcmtCbG9jazogTm9kZU1vZGVsRm9yUGFsZXR0ZTxDdXN0b21QYWxldHRlVHlwZT4gPVxyXG4gICAge1xyXG4gICAgICAgIC4uLmdldERlZmF1bHROb2RlKCksXHJcbiAgICAgICAgYWRkSW5mbzogeyB0eXBlOiAnY3JlYXRlLXdvcmstYmxvY2snLCBsYWJlbDogJ0NSRUFURV9XT1JLQkxPQ0snIH0sXHJcbiAgICAgICAgcG9ydHM6IFtdLFxyXG4gICAgICAgIGlkOiAnY3JlYXRlLXdvcmstYmxvY2snLFxyXG4gICAgICAgIGNvbnN0cmFpbnRzOiBOb2RlQ29uc3RyYWludHMuTm9uZSxcclxuICAgICAgICBzaGFwZToge1xyXG4gICAgICAgICAgICB0eXBlOiAnSFRNTCcsXHJcbiAgICAgICAgICAgIGNvbnRlbnQ6IGA8ZGl2IGNsYXNzPVwicGFsZXR0ZS1pdGVtXCI+XHJcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJwYWxldHRlLWl0ZW1fX2lubmVyXCI+XHJcbiAgICAgICAgICAgIDxpIGNsYXNzPVwibWF0ZXJpYWwtaWNvbnMtb3V0bGluZWQgcGFsZXR0ZS1pdGVtX19pY29uXCI+cG9zdF9hZGQ8L2k+XHJcbiAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgPC9kaXY+YCxcclxuICAgICAgICB9LFxyXG4gICAgfTtcclxuXHJcbmV4cG9ydCBjb25zdCBnZXROb2RlTW9kZWxGb3JQYWxldHRlID0gKFxyXG4gICAgcGFsZXR0ZVN5bWJvbDogUGFsZXR0ZVN5bWJvbCxcclxuICAgIHNoYXJlZFN2YzogQXphdmlzdGFTaGFyZWRTZXJ2aWNlLFxyXG4pID0+IHtcclxuICAgIGlmIChwYWxldHRlU3ltYm9sID09PSAnY3JlYXRlLXdvcmstYmxvY2snKSB7XHJcbiAgICAgICAgcmV0dXJuIG5vZGVNb2RlbEZvclBhbGV0dGVDcmVhdGVXb3JrQmxvY2s7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZ2V0Tm9kZU1vZGVsRm9yUGFsZXR0ZUZyb21Xb3JrZmxvd1R5cGUocGFsZXR0ZVN5bWJvbCwgc2hhcmVkU3ZjKTtcclxufTtcclxuXHJcbi8vIGxvY2FsIHN0b3JhZ2UgdG9vbHNcclxuY29uc3QganNvblBhcnNlID0gPFQ+KGpzb25UZXh0OiBzdHJpbmcgfCBudWxsKTogVCB8IHVuZGVmaW5lZCA9PiB7XHJcbiAgICBsZXQgbXlSZXNwb25zZTogVCB8IHVuZGVmaW5lZDtcclxuICAgIGlmIChqc29uVGV4dCA9PSBudWxsKSB7XHJcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgIH1cclxuICAgIHRyeSB7XHJcbiAgICAgICAgbXlSZXNwb25zZSA9IEpTT04ucGFyc2UoanNvblRleHQpO1xyXG4gICAgfSBjYXRjaCAoZTogYW55KSB7XHJcbiAgICAgICAgbXlSZXNwb25zZSA9IHVuZGVmaW5lZDtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Vycm9yIG9jY3VyZWQ6ICcsIGUpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG15UmVzcG9uc2U7XHJcbn07XHJcblxyXG5jb25zdCBnZXRCdWlsZGVyV29ya2Zsb3dMb2NhbFN0b3JhZ2VLZXkgPSAoZXZlbnRJZDogc3RyaW5nKSA9PlxyXG4gICAgYGF6YXZpc3RhLXdvcmtmbG93LWJ1aWxkZXItJHtldmVudElkfWA7XHJcbmV4cG9ydCBjb25zdCBnZXRCdWlsZGVyV29ya2Zsb3dGcm9tTG9jYWxTdG9yYWdlID0gKGV2ZW50SWQ6IHN0cmluZykgPT4ge1xyXG4gICAgY29uc3QgY29udGVudCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFxyXG4gICAgICAgIGdldEJ1aWxkZXJXb3JrZmxvd0xvY2FsU3RvcmFnZUtleShldmVudElkKSxcclxuICAgICk7XHJcbiAgICByZXR1cm4ganNvblBhcnNlPFdvcmtmbG93QnVpbGRlcj4oY29udGVudCk7XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3Qgc2F2ZUJ1aWxkZXJXb3JrZmxvd1RvTG9jYWxTdG9yYWdlID0gKFxyXG4gICAgZXZlbnRJZDogc3RyaW5nLFxyXG4gICAgZGF0YTogV29ya2Zsb3dCdWlsZGVyLFxyXG4pID0+IHtcclxuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFxyXG4gICAgICAgIGdldEJ1aWxkZXJXb3JrZmxvd0xvY2FsU3RvcmFnZUtleShldmVudElkKSxcclxuICAgICAgICBKU09OLnN0cmluZ2lmeShkYXRhKSxcclxuICAgICk7XHJcbn07XHJcbiJdfQ==